(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4352:(e,t,s)=>{Promise.resolve().then(s.bind(s,4696))},4696:(e,t,s)=>{"use strict";s.d(t,{default:()=>eq});var r=s(5155),a=s(2115),n=s(8629),o=s(3463),l=s(9795);function i(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,l.QP)((0,o.$)(t))}let c=n.bL,d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.B8,{ref:t,className:i("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...a})});d.displayName=n.B8.displayName;let u=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.l9,{ref:t,className:i("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...a})});u.displayName=n.l9.displayName;let p=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.UC,{ref:t,className:i("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...a})});p.displayName=n.UC.displayName;var m=s(6710),x=s(2317),f=s(1027);let h=(0,f.F)("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background",{variants:{variant:{default:"bg-primary/90 text-primary-foreground hover:bg-primary/60",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"underline-offset-4 hover:underline text-primary"},size:{default:"h-10 py-2 px-4",sm:"h-9 px-3 rounded-md",lg:"h-11 px-8 rounded-md",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),g=a.forwardRef((e,t)=>{let{className:s,variant:a,size:n,asChild:o=!1,...l}=e,c=o?x.DX:"button";return(0,r.jsx)(c,{className:i(h({variant:a,size:n,className:s})),ref:t,...l})});g.displayName="Button";var v=s(5565),y=s(4521),b=s(767),j=s(1406),w=s(8283),N=s(3608);let k=["image/jpeg","image/png","image/gif","image/webp"],A=["application/pdf"],C=["applications/javascript","application/typescript","application/x-httpd-php","application/x-sh","application/x-powershell","application/json","application/xml","application/yaml","application/toml","application/x-tex","application/sql","application/x-python","application/x-ruby","application/x-diff","application/x-patch","application/typescript","application/x-properties"],R=e=>{let{onFileSelect:t,onUploadComplete:s}=e,n=(0,a.useRef)(null),o=(0,a.useCallback)(async e=>{if(!(k.includes(e.type)||A.includes(e.type)||e.type.startsWith("text/")||C.includes(e.type))){alert("Unsupported file type. Please upload an image (JPEG, PNG, GIF, WebP), a PDF, or a plaintext document.");return}let r=new FileReader;r.onload=async()=>{let a=r.result.split(",")[1];if(e.type.startsWith("text/")||C.includes(e.type)){t({type:"text",text:function(e){try{let t=atob(e),s=new Uint8Array(t.length);for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);return new TextDecoder("utf-8").decode(s)}catch(e){throw Error("Failed to decode base64 string: "+e.message)}}(a)}),null==s||s();return}k.includes(e.type)?(t({type:"image",source:{type:"base64",media_type:e.type,data:a},fileName:e.name}),null==s||s()):"application/pdf"===e.type&&(t({type:"document",source:{type:"base64",media_type:"application/pdf",data:a},fileName:e.name}),null==s||s())},r.readAsDataURL(e)},[t,s]),l=(0,a.useCallback)(async e=>{for(let t of(e.preventDefault(),Array.from(e.dataTransfer.files)))await o(t)},[o]),i=(0,a.useCallback)(async e=>{for(let t of Array.from(e.target.files||[]))await o(t)},[o]);return(0,r.jsxs)("div",{onDrop:l,onDragOver:e=>{e.preventDefault()},className:"relative",children:[(0,r.jsx)("input",{type:"file",ref:n,onChange:i,accept:[...k,...A].join(","),className:"hidden",multiple:!0}),(0,r.jsx)(g,{onClick:()=>{var e;null===(e=n.current)||void 0===e||e.click()},variant:"ghost",size:"icon",className:"h-8 w-8",title:"Upload files (Images or PDFs)",children:(0,r.jsx)(N.A,{className:"h-5 w-5"})})]})};var _=s(8867),S=s(7341);let P=e=>{let{text:t,className:s=""}=e,[n,o]=(0,a.useState)(!1),l=async e=>{e.preventDefault(),e.stopPropagation();try{await navigator.clipboard.writeText(t),o(!0),setTimeout(()=>o(!1),2e3)}catch(e){console.error("Failed to copy text:",e)}};return(0,r.jsxs)("button",{onClick:l,className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-sm hover:bg-kinode-orange/10 ".concat(s),children:[n?(0,r.jsx)(_.A,{className:"h-4 w-4"}):(0,r.jsx)(S.A,{className:"h-4 w-4"}),n?"Copied":"Copy"]})},I=a.forwardRef((e,t)=>{let{className:s,maxRows:n=8,onChange:o,...l}=e,c=a.useRef(null),d=a.useCallback(e=>{let t=c.current;if(t){t.style.height="auto";let e=Math.min(t.scrollHeight,n*parseInt(getComputedStyle(t).lineHeight));t.style.height=t.value?"".concat(e,"px"):"2.5em"}null==o||o(e)},[n,o]);return a.useEffect(()=>{c.current&&(c.current.style.height="2.5em")},[]),(0,r.jsx)("textarea",{className:i("flex h-[2.5em] w-full rounded-md border border-input bg-transparent px-3 py-2 text-[16px] ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 overflow-y-auto resize-none transition-height duration-150",s),ref:e=>{c.current=e,"function"==typeof t?t(e):t&&(t.current=e)},onChange:d,...l})});I.displayName="Textarea";let D=(0,f.F)("relative w-full rounded-lg border p-4 [&>svg]:absolute [&>svg]:text-foreground [&>svg]:left-4 [&>svg]:top-4 [&>svg+div]:translate-y-[-3px] [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"text-destructive border-destructive/50 dark:border-destructive [&>svg]:text-destructive text-destructive"}},defaultVariants:{variant:"default"}}),z=a.forwardRef((e,t)=>{let{className:s,variant:a,...n}=e;return(0,r.jsx)("div",{ref:t,role:"alert",className:i(D({variant:a}),s),...n})});z.displayName="Alert",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("h5",{ref:t,className:i("mb-1 font-medium leading-none tracking-tight",s),...a})}).displayName="AlertTitle";let T=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:i("text-sm [&_p]:leading-relaxed",s),...a})});T.displayName="AlertDescription";var E=s(3550),O=s(6246);class K{async acquire(){if(this.isSupported)try{this.wakeLock=await navigator.wakeLock.request("screen"),console.log("Screen wake lock acquired")}catch(e){console.warn("Failed to acquire wake lock:",e)}}async release(){if(this.wakeLock)try{await this.wakeLock.release(),this.wakeLock=null,console.log("Screen wake lock released")}catch(e){console.warn("Failed to release wake lock:",e)}}isActive(){return null!==this.wakeLock}constructor(){this.wakeLock=null,this.isSupported=!1,this.isSupported="undefined"!=typeof navigator&&"wakeLock"in navigator&&/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase())}}let F=new K;var U=s(6217);let q=U.bL;U.l9;let L=U.ZL,M=a.forwardRef(function(e,t){return(0,r.jsx)(U.hJ,{ref:t,className:i("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e.className),...e})}),G=a.forwardRef(function(e,t){return(0,r.jsxs)(L,{children:[(0,r.jsx)(M,{}),(0,r.jsxs)(U.UC,{ref:t,className:i("fixed left-[50%] top-[50%] z-50 grid w-full translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg","max-w-[90%] sm:max-w-[85%] md:max-w-[80%] lg:max-w-[75%]","max-h-[85vh] overflow-y-auto",e.className),...e,children:[e.children,(0,r.jsxs)(U.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(b.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}),H=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:i("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})},J=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:i("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})},Y=a.forwardRef(function(e,t){return(0,r.jsx)(U.hE,{ref:t,className:i("text-lg font-semibold leading-none tracking-tight",e.className),...e})});var V=s(314),Z=s(4504);let Q=e=>{let{toolCall:t,onClose:s}=e,[n,o]=(0,a.useState)(!1);return(0,r.jsx)(q,{open:!0,onOpenChange:s,children:(0,r.jsxs)(G,{children:[(0,r.jsx)(H,{className:"mb-4 shrink-0",children:(0,r.jsxs)("div",{className:"flex justify-between items-center gap-4",children:[(0,r.jsx)(Y,{className:"truncate",children:"Tool Call: ".concat(t.name)}),(0,r.jsx)(g,{variant:"ghost",size:"icon",onClick:()=>o(!n),children:n?(0,r.jsx)(V.A,{className:"h-4 w-4"}):(0,r.jsx)(Z.A,{className:"h-4 w-4"})})]})}),(0,r.jsxs)("div",{className:i("space-y-4 overflow-hidden flex-grow",n?"overflow-y-auto pr-2":"max-h-[240px] sm:max-h-[280px]"),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium mb-2",children:"Input:"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("pre",{className:i("bg-muted p-2 sm:p-4 rounded-md whitespace-pre-wrap break-all text-sm sm:text-base",!n&&"max-h-[100px] sm:max-h-[120px] overflow-hidden"),children:JSON.stringify(t.input,null,2)}),!n&&(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-muted to-transparent pointer-events-none"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium mb-2",children:"Result:"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("pre",{className:i("bg-muted p-2 sm:p-4 rounded-md whitespace-pre-wrap break-all text-sm sm:text-base",!n&&"max-h-[100px] sm:max-h-[120px] overflow-hidden"),children:t.result||"No result available"}),!n&&(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-muted to-transparent pointer-events-none"})]})]})]})]})})};var B=s(9434),W=s(6164);let X=()=>(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-[3px] border-current/30 border-t-current"}),$=e=>{let{onTranscriptionComplete:t}=e,[s,n]=(0,a.useState)(!1),[o,l]=(0,a.useState)(!1),i=(0,a.useRef)(null),c=(0,a.useRef)([]),{projects:d,activeProjectId:u}=(0,B.P)(),p=d.find(e=>e.id===u),m=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);i.current=t,c.current=[],t.ondataavailable=e=>{e.data.size>0&&c.current.push(e.data)},t.onstop=async()=>{let t=new Blob(c.current,{type:"audio/webm"});l(!0),await x(t),l(!1),e.getTracks().forEach(e=>e.stop())},t.start(),n(!0)}catch(e){console.error("Error accessing microphone:",e),alert("Error accessing microphone. Please ensure microphone permissions are granted.")}},x=async e=>{if(!(null==p?void 0:p.settings.groqApiKey)){alert("Please set your GROQ API key in settings first");return}let s=new FormData;s.append("file",e,"recording.webm"),s.append("model","whisper-large-v3");try{let e=await fetch("https://api.groq.com/openai/v1/audio/transcriptions",{method:"POST",headers:{Authorization:"Bearer ".concat(p.settings.groqApiKey)},body:s});if(!e.ok)throw Error("Error transcribing audio: ".concat(e.statusText));let r=await e.json();r.text&&t(r.text)}catch(e){console.error("Error transcribing audio:",e),l(!1),alert("Error transcribing audio. Please check your GROQ API key and try again.")}};return(0,r.jsx)(g,{variant:"ghost",size:"icon",className:"".concat(s?"text-red-500":""," hover:bg-accent hover:text-accent-foreground"),onClick:s?()=>{i.current&&s&&(i.current.stop(),n(!1))}:m,disabled:!(null==p?void 0:p.settings.groqApiKey),title:(null==p?void 0:p.settings.groqApiKey)?s?"Stop Recording":"Start Recording":"Set GROQ API key in settings to enable voice recording",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(W.A,{className:"h-4 w-4"}),o&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsx)(X,{})})]})})},ee=()=>{let{projects:e,activeProjectId:t,createConversation:s,setActiveConversation:r,activeConversationId:n}=(0,B.P)(),o=e.find(e=>e.id===t),l=(0,a.useCallback)(t=>{let a=e.find(e=>e.id===t);if(!a)return;if(0===a.conversations.length){s(t);return}let n=a.conversations[a.conversations.length-1];if(0===n.messages.length){r(n.id);return}s(t)},[e,s,r]);return(0,a.useEffect)(()=>{if(t&&!n){let a=e.find(e=>e.id===t);if(a){if(0===a.conversations.length)s(t);else{let e=a.conversations[a.conversations.length-1];0===e.messages.length?r(e.id):s(t)}}}},[t,n,e,s,r]),{handleProjectFocus:l,activeProject:o}},et="claude-3-5-sonnet-20241022",es=a.forwardRef((e,t)=>{var s,n,o;let[l,i]=(0,a.useState)([]),{projects:c,activeProjectId:d,activeConversationId:u,updateProjectSettings:p,renameConversation:m,servers:x,executeTool:f}=(0,B.P)(),h=c.find(e=>e.id===d),N=null==h?void 0:h.conversations.find(e=>e.id===u),[k,A]=(0,a.useState)(""),[C,_]=(0,a.useState)(!1),[S,D]=(0,a.useState)(null),K=(0,a.useRef)(!1),U=(0,a.useRef)(null),q=(0,a.useRef)(null),L=(0,a.useRef)(null),M=(0,a.useRef)(null),[G,H]=(0,a.useState)(null);ee(),(0,a.useImperativeHandle)(t,()=>({focus:()=>{M.current&&M.current.focus()}}),[]),(0,a.useEffect)(()=>{M.current&&N&&M.current.focus()},[N]),(0,a.useEffect)(()=>{if(!L.current)return;let e=L.current;e.scrollTop=e.scrollHeight},[]),(0,a.useEffect)(()=>{if(!L.current||!(null==N?void 0:N.messages.length))return;let e=N.messages[N.messages.length-1];("assistant"===e.role||"user"===e.role)&&requestAnimationFrame(()=>{var e;null===(e=q.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})},[null==N?void 0:N.messages,null==N?void 0:N.lastUpdated]);let J=e=>{var t;if(!(null==h?void 0:null===(t=h.settings.mcpServerIds)||void 0===t?void 0:t.length))return[];let s=new Map;x.filter(e=>h.settings.mcpServerIds.includes(e.id)).flatMap(e=>e.tools||[]).forEach(e=>{s.has(e.name)||s.set(e.name,{name:e.name,description:e.description,input_schema:e.input_schema})});let r=Array.from(s.values());return e?r.map((e,t,s)=>t!=s.length-1?e:{...e,cache_control:{type:"ephemeral"}}):r},Y=(e,t,s)=>{let r=null==h?void 0:h.conversations.find(e=>e.id===t);r&&p(e,{conversations:h.conversations.map(e=>e.id===t?{...r,messages:s,lastUpdated:new Date}:e)})},V=(0,a.useCallback)(()=>{K.current=!0,U.current&&U.current.abort(),_(!1),D("Operation cancelled")},[]),Z=async()=>{if(K.current=!1,!k.trim()&&0===l.length||!h||!u)return;D(null),_(!0);let e="openrouter"===h.settings.provider?h.settings.openRouterApiKey:h.settings.anthropicApiKey||h.settings.apiKey;if(!(null==e?void 0:e.trim())){D("API key not found. Please set your ".concat("openrouter"===h.settings.provider?"OpenRouter":"Anthropic"," API key in the Settings panel.")),_(!1);return}M.current&&(M.current.style.height="2.5em"),await F.acquire();try{var t;let e=l.map(e=>(e.type,{...e,fileName:void 0}));k.trim()&&e.push({type:"text",text:k});let s={role:"user",content:e,timestamp:new Date},r=[...(null==N?void 0:N.messages)||[],s];Y(h.id,u,r),A(""),i([]);let a=new y.NB({apiKey:h.settings.anthropicApiKey||h.settings.apiKey||"",dangerouslyAllowBrowser:!0,maxRetries:12}),n=new Set,o=J(!0),c=J(!1),d=null===(t=h.settings.systemPrompt)||void 0===t?void 0:t.trim(),p=d?[{type:"text",text:d}]:void 0;for(;;){let e=r.filter((e,t,s)=>{if("string"==typeof e.content)return!0;let r=e.content;if(!r.some(e=>"tool_use"===e.type))return!0;let a=s[t+1];if(!a||"string"==typeof a.content)return!1;let n=a.content;return r.every(e=>{if("tool_use"!==e.type||!("id"in e))return!0;let t=e.id;return n.some(e=>"tool_result"===e.type&&"tool_use_id"in e&&e.tool_use_id===t)})}).map((e,t,s)=>t<s.length-3?{role:e.role,content:e.content,toolInput:e.toolInput?e.toolInput:void 0}:{role:e.role,content:"string"==typeof e.content?[{type:"text",text:e.content,cache_control:{type:"ephemeral"}}]:e.content.map((e,t,s)=>t!=s.length-1?e:{...e,cache_control:{type:"ephemeral"}}),toolInput:e.toolInput?e.toolInput:void 0}),t=r.filter(e=>Array.isArray(e.content)).flatMap(e=>e.content).filter(e=>"tool_use_id"in e&&"tool_result"===e.type).map(e=>e.tool_use_id).pop();if(h.settings.elideToolResults&&"tool_result"===e[e.length-1].content[0].type){let t=await a.messages.create({model:et,max_tokens:8192,messages:[...e.filter(e=>!!Array.isArray(e.content)&&e.content.find(e=>"tool_use"===e.type||"tool_result"===e.type)).map(e=>e.content.find(e=>"tool_result"===e.type)?{...e,content:[{type:"text",text:"".concat(JSON.stringify({...e.content[0],content:"elided"}))}]}:{...e,content:[e.content[0],{type:"text",text:"".concat(JSON.stringify(e.content[1]))}]}),{role:"user",content:[{type:"text",text:"Rate each `message`: will the `type: tool_result` be required by `assistant` to serve the next response? Reply ONLY with `<tool_use_id>: Yes` or `<tool_use_id>: No` for each tool_result. DO NOT reply with code, prose, or commentary of any kind.\nExample output:\ntoolu_014huykAonadokihkrboFfqn: Yes\ntoolu_01APhxfkQZ1nT7Ayt8Vtyuz8: Yes\ntoolu_01PcgSwHbHinNrn3kdFaD82w: No\ntoolu_018Qosa8PHAZjUa312TXRwou: Yes",cache_control:{type:"ephemeral"}}]}],system:[{type:"text",text:"Rate each `message`: will the `type: tool_result` be required by `assistant` to serve the next response? Reply ONLY with `<tool_use_id>: Yes` or `<tool_use_id>: No` for each tool_result. DO NOT reply with code, prose, or commentary of any kind.\nExample output:\ntoolu_014huykAonadokihkrboFfqn: Yes\ntoolu_01APhxfkQZ1nT7Ayt8Vtyuz8: Yes\ntoolu_01PcgSwHbHinNrn3kdFaD82w: No\ntoolu_018Qosa8PHAZjUa312TXRwou: Yes",cache_control:{type:"ephemeral"}}]});if("text"===t.content[0].type)for(let e of(console.log("a"),t.content[0].text.split("\n"))){let[t,s]=e.split(": ");"Yes"===s.trim()?(console.log("b"),n.add(t)):"No"===s.trim()&&(console.log("c"),n.delete(t))}console.log("keepToolResponse: ".concat(JSON.stringify(t),"\n").concat(JSON.stringify(n)))}let s=h.settings.elideToolResults?e.map(e=>{if(!Array.isArray(e.content))return e;let s=e.content.find(e=>"tool_result"===e.type);if(!s)return e;let r=s.tool_use_id;return r===t||n.has(r)?e:{...e,content:[{...e.content[0],content:"elided"}]}}):e,l={role:"assistant",content:[],timestamp:new Date},i={type:"text",text:""};l.content.push(i);let d=await a.messages.stream({model:h.settings.model||et,max_tokens:8192,messages:s,...p&&p.length>0&&{system:p},...c.length>0&&{tools:o}});if(U.current=d,K.current)break;d.on("text",e=>{i.text+=e;let t=[...r,l];Y(h.id,u,t)});let g=await d.finalMessage(),v=g.content.map(e=>e.type&&"text"===e.type&&0===e.text.trim().length&&1===g.content.length?{...e,text:"empty"}:e).filter(e=>{if(!e.type||"text"!==e.type)return!0;let t=0===e.text.trim().length;return t&&1===g.content.length?(console.log("got unexpected whitespace case from assistant: ".concat(JSON.stringify(g))),e.text="empty",!0):!t}),y={...g,content:v};r.push(y),Y(h.id,u,r);let b=null==h?void 0:h.conversations.find(e=>e.id===u);if(b&&2===r.length&&"(New Chat)"===b.name){let e=null==h?void 0:h.conversations.find(e=>e.id===u);if((null==e?void 0:e.name)!=="(New Chat)"){console.log("Title already changed, skipping generation");return}let t=r[0].content,s=r[1].content,n=await a.messages.create({model:h.settings.model||et,max_tokens:20,messages:[{role:"user",content:"Generate a concise, specific title (3-4 words max) that accurately captures the main topic or purpose of this conversation. Use key technical terms when relevant. Avoid generic words like 'conversation', 'chat', or 'help'.\n\nUser message: ".concat(JSON.stringify(t),"\nAssistant response: ").concat(Array.isArray(s)?s.filter(e=>"text"===e.type).map(e=>"text"===e.type?e.text:"").join(" "):s,"\n\nFormat: Only output the title, no quotes or explanation\nExample good titles:\n- React Router Setup\n- Python Script Optimization\n- Database Schema Design\n- ML Model Training\n- Docker Container Networking")}]}),o=n.content[0].type;if("text"==o){let e=n.content[0].text.replace(/["']/g,"").replace("title:","").replace("Title:","").replace("title","").replace("Title","").trim();e&&m(h.id,u,e)}}let j=g.content.find(e=>"tool_use"===e.type);if(j&&"tool_use"===j.type)try{if(K.current)break;let e=x.find(e=>{var t;return null===(t=e.tools)||void 0===t?void 0:t.some(e=>e.name===j.name)});if(!e)throw Error("No server found for tool ".concat(j.name));let t=await f(e.id,j.name,j.input);if(K.current)break;let s={role:"user",content:[{type:"tool_result",tool_use_id:j.id,content:t}],timestamp:new Date};if(r.push(s),Y(h.id,u,r),!K.current)continue;break}catch(t){let e={role:"user",content:[{type:"tool_result",tool_use_id:j.id,content:"Error: ".concat(t instanceof Error?t.message:"Unknown error"),is_error:!0}],timestamp:new Date};r.push(e),Y(h.id,u,r)}if(K.current||!j)break}}catch(e){e&&"object"==typeof e&&"message"in e&&"Request was aborted."===e.message?console.log("Request was cancelled by user"):(console.error("Failed to send message:",e),K.current||D(e instanceof Error?e.message:"An error occurred"))}finally{K.current=!1,_(!1),U.current=null,await F.release(),M.current&&(M.current.focus(),M.current.style.height="2.5em")}},W=(e,t)=>Array.isArray(e.content)?e.content.map((s,a)=>{if("text"===s.type)return(0,r.jsx)("div",{className:"flex max-w-full pt-6",children:(0,r.jsxs)("div",{className:"relative group w-full max-w-full overflow-x-auto",children:[!s.text.match(/```[\s\S]*```/)&&(0,r.jsx)("div",{className:"absolute right-2 top-0 z-10",children:(0,r.jsx)(P,{text:s.text.trim(),className:"opacity-0 group-hover:opacity-100 transition-opacity"})}),(0,r.jsx)("div",{className:"w-full max-w-full rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-accent !text-accent-foreground":"bg-muted text-foreground"),children:(0,r.jsx)(E.o,{className:"prose dark:prose-invert break-words max-w-full ".concat("user"===e.role?"[&_p]:!text-accent-foreground [&_code]:!text-accent-foreground":""),components:{p:e=>{let{children:t}=e;return(0,r.jsx)("p",{className:"break-words whitespace-pre-wrap overflow-hidden",children:t})},pre(e){let{children:t,...s}=e,a=e=>{if("string"==typeof e)return e;if(!e)return"";if(Array.isArray(e))return e.map(a).join("\n");if("object"==typeof e&&null!==e&&"props"in e){var t,s,r;if((null===(s=e.props)||void 0===s?void 0:null===(t=s.className)||void 0===t?void 0:t.includes("language-"))||(null===(r=e.props)||void 0===r?void 0:r.children))return a(e.props.children)}return""},n=a(t).trim();return(0,r.jsxs)("div",{className:"group/code relative max-w-full",children:[(0,r.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,r.jsx)(P,{text:n,className:"opacity-0 group-hover/code:opacity-100 transition-opacity"})}),(0,r.jsx)("pre",{className:"overflow-x-auto max-w-full whitespace-pre",...s,children:t})]})},code(e){let{inline:t,children:s,...a}=e;return t?(0,r.jsx)("code",{className:"text-inherit whitespace-nowrap inline",...a,children:s}):(0,r.jsx)("code",{className:"block overflow-x-auto whitespace-pre-wrap",...a,children:s})},a:e=>{let{href:t,children:s}=e;return(0,r.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:s})}},remarkPlugins:[O.A],children:s.text})})]})},"text-".concat(t,"-").concat(a));if("image"===s.type)return(0,r.jsx)("div",{className:"flex",children:(0,r.jsx)("div",{className:"w-full rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,r.jsx)(v.default,{src:"data:".concat(s.source.media_type,";base64,").concat(s.source.data),alt:"User uploaded image",className:"max-h-[150px] max-w-[300px] w-auto h-auto rounded object-contain",width:300,height:150})})},"image-".concat(t,"-").concat(a));if("document"===s.type)return(0,r.jsx)("div",{className:"flex",children:(0,r.jsx)("div",{className:"w-full rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,r.jsx)("embed",{src:"data:".concat(s.source.media_type,";base64,").concat(s.source.data),type:s.source.media_type,width:"100%",height:"600px",className:"rounded"})})},"document-".concat(t,"-").concat(a));if("tool_use"===s.type){let n=null==N?void 0:N.messages[t+1],o=null;if(n&&Array.isArray(n.content)){let e=n.content.find(e=>"tool_result"===e.type&&e.tool_use_id===s.id);e&&"tool_result"===e.type&&(o=e.content)}return(0,r.jsx)("div",{className:"flex",children:(0,r.jsx)("div",{className:"w-full rounded-lg px-4 py-2 relative group ".concat("user"===e.role?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,r.jsxs)("button",{onClick:()=>H({name:s.name,input:s.input,result:o}),className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 underline",children:["Use tool: ",s.name]})},"message-".concat(t,"-content-").concat(a))},"tool_use-".concat(t,"-").concat(a))}return null}):(0,r.jsx)("div",{className:"flex",children:(0,r.jsx)("div",{className:"w-full rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,r.jsx)(E.o,{className:"prose dark:prose-invert break-words overflow-hidden whitespace-pre-wrap max-w-full",components:{a:e=>{let{href:t,children:s}=e;return(0,r.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:s})}},remarkPlugins:[O.A],children:e.content})})},"string-".concat(t));return N?(0,r.jsxs)("div",{className:"flex flex-col h-full relative",children:[(0,r.jsx)("div",{ref:L,className:"h-[calc(100vh-4rem)] overflow-y-auto p-4",children:(0,r.jsxs)("div",{className:"space-y-4 mb-4",children:[N.messages.map((e,t)=>W(e,t)),(0,r.jsx)("div",{ref:q})]})}),S&&(0,r.jsx)("div",{className:"px-4 py-2 text-sm text-red-500",children:S}),(null==h?void 0:h.settings.provider)==="openrouter"&&(0,r.jsx)("div",{className:"px-4",children:(0,r.jsx)(z,{children:(0,r.jsx)(T,{children:"OpenRouter support is coming soon. Please switch to Anthropic provider in settings to chat."})})}),(0,r.jsxs)("div",{className:"flex flex-col gap-2 p-2 bg-background fixed bottom-0 left-0 right-0 z-50 md:left-[280px] md:w-[calc(100%-280px)]",children:[l.length>0&&(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:l.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center gap-2 bg-muted rounded px-2 py-1",children:[(0,r.jsx)("span",{className:"text-sm",children:"text"===e.type?"Text file":e.fileName||"Untitled"}),(0,r.jsx)("button",{onClick:()=>{i(e=>e.filter((e,s)=>s!==t))},className:"hover:text-destructive",children:(0,r.jsx)(b.A,{className:"h-4 w-4"})})]},t))}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("div",{className:"flex items-end gap-1",children:[(0,r.jsx)(R,{onFileSelect:e=>{i(t=>[...t,{...e}])},onUploadComplete:()=>{M.current&&M.current.focus()}}),(0,r.jsx)($,{onTranscriptionComplete:e=>{A(t=>t.trim()?"".concat(t,"\n").concat(e):e)}})]}),(0,r.jsx)(I,{value:k,onChange:e=>A(e.target.value),placeholder:(null==h?void 0:h.settings.provider)==="openrouter"?"⚠️ OpenRouter support coming soon":(null==h?void 0:null===(s=h.settings.apiKey)||void 0===s?void 0:s.trim())?C?"Processing response...":"Type your message":"⚠️ Set your API key in Settings to start chatting",onKeyDown:e=>{let t=window.matchMedia("(max-width: 768px)").matches;"Enter"!==e.key||e.shiftKey||C||t||(e.preventDefault(),Z())},ref:M,className:"flex-1 ".concat((null==h?void 0:null===(n=h.settings.apiKey)||void 0===n?void 0:n.trim())?"":"placeholder:text-red-500/90 dark:placeholder:text-red-400/90 placeholder:font-medium"),maxRows:8,disabled:C||!(null==h?void 0:null===(o=h.settings.apiKey)||void 0===o?void 0:o.trim())||(null==h?void 0:h.settings.provider)==="openrouter"}),(0,r.jsx)(g,{onClick:C?V:Z,disabled:!d||!u||(null==h?void 0:h.settings.provider)==="openrouter",className:"self-end relative",children:C?(0,r.jsx)(j.A,{className:"w-4 h-4"}):(0,r.jsx)(w.A,{className:"w-4 h-4"})})]})]}),G&&(0,r.jsx)(Q,{toolCall:G,onClose:()=>H(null)})]}):(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsx)(X,{})})});es.displayName="ChatView";let er=a.memo(es),ea=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:i("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a})});ea.displayName="Card",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:i("flex flex-col space-y-1.5 p-6",s),...a})}).displayName="CardHeader",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("h3",{ref:t,className:i("text-lg font-semibold leading-none tracking-tight",s),...a})}).displayName="CardTitle",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("p",{ref:t,className:i("text-sm text-muted-foreground",s),...a})}).displayName="CardDescription";let en=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:i("p-6 pt-0",s),...a})});en.displayName="CardContent",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:i(" flex items-center p-6 pt-0",s),...a})}).displayName="CardFooter";let eo=a.forwardRef((e,t)=>{let{className:s,type:a,...n}=e;return(0,r.jsx)("input",{type:a,className:i("flex h-10 w-full rounded-md border border-input bg-transparent px-3 py-2 text-[16px] ring-offset-background file:border-0 file:bg-transparent file:text-[16px] file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...n})});eo.displayName="Input";var el=s(3572);let ei=el.bL;el.l9;let ec=el.ZL,ed=a.forwardRef(function(e,t){return(0,r.jsx)(el.hJ,{className:i("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e.className),...e,ref:t})}),eu=a.forwardRef(function(e,t){return(0,r.jsxs)(ec,{children:[(0,r.jsx)(ed,{}),(0,r.jsx)(el.UC,{ref:t,className:i("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e.className),...e})]})}),ep=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:i("flex flex-col space-y-2 text-center sm:text-left",t),...s})},em=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:i("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})},ex=a.forwardRef(function(e,t){return(0,r.jsx)(el.hE,{ref:t,className:i("text-lg font-semibold",e.className),...e})}),ef=a.forwardRef(function(e,t){return(0,r.jsx)(el.VY,{ref:t,className:i("text-sm text-muted-foreground",e.className),...e})}),eh=a.forwardRef(function(e,t){return(0,r.jsx)(el.rc,{ref:t,className:i(h(),e.className),autoFocus:e.autoFocus,...e})}),eg=a.forwardRef(function(e,t){return(0,r.jsx)(el.ZD,{ref:t,className:i(h({variant:"outline"}),"mt-2 sm:mt-0",e.className),...e})});var ev=s(6714),ey=s(1773),eb=s(5686);let ej=e=>{let{serverIds:t=[],onServerIdsChange:s}=e,[n,o]=(0,a.useState)({name:"",uri:""}),{addServer:l,removeServer:i,reconnectServer:c,servers:d}=(0,B.P)(),u=async()=>{let e={id:Math.random().toString(36).substring(7),name:n.name,uri:n.uri,status:"connecting"};try{if(await l(e)){let r=Array.isArray(t)?[...t,e.id]:[e.id];s(r)}}catch(e){console.error("Failed to connect to server:",e)}o({name:"",uri:""})},p=e=>{i(e),s(t.filter(t=>t!==e))},m=e=>{switch(e){case"connected":return"text-green-500";case"connecting":return"text-yellow-500";case"error":return"text-red-500";default:return"text-gray-500"}};return(0,r.jsx)(ea,{children:(0,r.jsxs)(en,{className:"p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-4",children:"WebSocket MCP Servers"}),(0,r.jsx)("div",{className:"space-y-3 mb-4",children:Array.isArray(t)&&t.map(e=>{let t=d.find(t=>t.id===e);return t?(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"font-medium",children:t.name}),(0,r.jsxs)("span",{className:"text-sm ".concat(m(t.status)),children:["(",t.status,")"]})]}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:t.uri}),t.error&&(0,r.jsx)("div",{className:"text-sm text-red-500 mt-1",children:t.error})]}),(0,r.jsxs)("div",{className:"flex gap-2 ml-2",children:["connected"!==t.status&&(0,r.jsx)(g,{variant:"ghost",size:"sm",onClick:()=>c(t.id),children:(0,r.jsx)(ey.A,{className:"h-4 w-4"})}),(0,r.jsx)(g,{variant:"ghost",size:"sm",onClick:()=>p(t.id),children:(0,r.jsx)(eb.A,{className:"h-4 w-4"})})]})]},t.id):null})}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(eo,{placeholder:"Server name",value:n.name,onChange:e=>o({...n,name:e.target.value}),className:"mb-2"}),(0,r.jsx)(eo,{placeholder:"WebSocket URI (e.g. ws://localhost:3000)",value:n.uri,onChange:e=>o({...n,uri:e.target.value})})]}),(0,r.jsx)(g,{onClick:u,disabled:!n.name||!n.uri,className:"w-full",children:"Add Server"})]}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(z,{children:(0,r.jsx)(T,{children:"Connect to WebSocket MCP servers to extend Claude's capabilities with custom tools. Each server should implement the MCP protocol."})})})]})})};var ew=s(7725),eN=s(2104),ek=s(8321),eA=s(6967),eC=s(3565);let eR=ek.bL,e_=ek.l9;ek.YJ,ek.ZL,ek.Pb,ek.z6,a.forwardRef((e,t)=>{let{className:s,inset:a,children:n,...o}=e;return(0,r.jsxs)(ek.ZP,{ref:t,className:i("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",a&&"pl-8",s),...o,children:[n,(0,r.jsx)(eA.A,{className:"ml-auto h-4 w-4"})]})}).displayName=ek.ZP.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(ek.G5,{ref:t,className:i("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in data-[side=bottom]:slide-in-from-top-1 data-[side=left]:slide-in-from-right-1 data-[side=right]:slide-in-from-left-1 data-[side=top]:slide-in-from-bottom-1",s),...a})}).displayName=ek.G5.displayName;let eS=a.forwardRef((e,t)=>{let{className:s,sideOffset:a=4,...n}=e;return(0,r.jsx)(ek.ZL,{children:(0,r.jsx)(ek.UC,{ref:t,sideOffset:a,className:i("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})})});eS.displayName=ek.UC.displayName;let eP=a.forwardRef((e,t)=>{let{className:s,inset:a,...n}=e;return(0,r.jsx)(ek.q7,{ref:t,className:i("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",s),...n})});eP.displayName=ek.q7.displayName,a.forwardRef((e,t)=>{let{className:s,children:a,checked:n,...o}=e;return(0,r.jsxs)(ek.H_,{ref:t,className:i("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:n,...o,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(ek.VF,{children:(0,r.jsx)(_.A,{className:"h-4 w-4"})})}),a]})}).displayName=ek.H_.displayName,a.forwardRef((e,t)=>{let{className:s,children:a,...n}=e;return(0,r.jsxs)(ek.hN,{ref:t,className:i("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(ek.VF,{children:(0,r.jsx)(eC.A,{className:"h-2 w-2 fill-current"})})}),a]})}).displayName=ek.hN.displayName,a.forwardRef((e,t)=>{let{className:s,inset:a,...n}=e;return(0,r.jsx)(ek.JU,{ref:t,className:i("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",s),...n})}).displayName=ek.JU.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(ek.wv,{ref:t,className:i("-mx-1 my-1 h-px bg-muted",s),...a})}).displayName=ek.wv.displayName;var eI=s(7113);function eD(){let{setTheme:e}=(0,eI.D)();return(0,r.jsxs)(eR,{children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsxs)(g,{variant:"outline",size:"icon",className:"h-10 w-10 rounded-full shadow-lg bg-background/80 backdrop-blur-sm hover:bg-background/90",children:[(0,r.jsx)(ew.A,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),(0,r.jsx)(eN.A,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),(0,r.jsx)("span",{className:"sr-only",children:"Toggle theme"})]})}),(0,r.jsxs)(eS,{align:"end",children:[(0,r.jsx)(eP,{onClick:()=>e("light"),children:"Light"}),(0,r.jsx)(eP,{onClick:()=>e("dark"),children:"Dark"}),(0,r.jsx)(eP,{onClick:()=>e("system"),children:"System"})]})]})}let ez=()=>{var e,t,s;let{projects:n,activeProjectId:o,updateProjectSettings:l,servers:i}=(0,B.P)(),[c,d]=(0,a.useState)(!1),u=n.find(e=>e.id===o);if((0,a.useEffect)(()=>{if(!u)return;let e=u.settings.mcpServerIds||[],t=i.filter(e=>"connected"===e.status).map(e=>e.id);e.every(e=>t.includes(e))&&t.every(t=>e.includes(t))||p({mcpServerIds:t})},[o,i]),!u)return(0,r.jsx)("div",{className:"text-center text-muted-foreground",children:"Select a project to configure settings"});let p=e=>{void 0!==e.provider&&e.provider!==u.settings.provider?l(u.id,{settings:{...u.settings,...e,anthropicApiKey:u.settings.anthropicApiKey||u.settings.apiKey,openRouterApiKey:u.settings.openRouterApiKey||"",apiKey:"anthropic"===e.provider&&u.settings.anthropicApiKey||u.settings.apiKey}}):l(u.id,{settings:{...u.settings,...e}})};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"fixed right-4 bottom-4 z-50",children:(0,r.jsx)(eD,{})}),(0,r.jsx)(ea,{children:(0,r.jsxs)(en,{className:"p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-4",children:"API Settings"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Provider"}),(0,r.jsxs)("select",{value:u.settings.provider||"anthropic",onChange:e=>p({provider:e.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[(0,r.jsx)("option",{value:"anthropic",children:"Anthropic (Claude)"}),(0,r.jsx)("option",{value:"openrouter",children:"OpenRouter (Coming Soon)"}),(0,r.jsx)("option",{value:"openai",children:"OpenAI"})]})]}),("openrouter"===u.settings.provider||"openai"===u.settings.provider)&&(0,r.jsx)(z,{children:(0,r.jsx)(T,{children:"openrouter"===u.settings.provider?"OpenRouter support is coming soon. Please use Anthropic for now.":"OpenAI support is coming soon. Please use Anthropic for now."})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["API Key ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Required to chat. Get yours at"," ",(()=>{switch(u.settings.provider){case"openrouter":return(0,r.jsx)("a",{href:"https://openrouter.ai/keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"openrouter.ai"});case"openai":return(0,r.jsx)("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"platform.openai.com"});default:return(0,r.jsx)("a",{href:"https://console.anthropic.com/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"console.anthropic.com"})}})()]}),(0,r.jsx)(eo,{type:"password",value:"openrouter"===u.settings.provider?u.settings.openRouterApiKey||"":"openai"===u.settings.provider?u.settings.openaiApiKey||"":u.settings.anthropicApiKey||u.settings.apiKey||"",onChange:e=>{let t=e.target.value.trim();switch(u.settings.provider){case"openrouter":p({openRouterApiKey:t});break;case"openai":p({openaiApiKey:t});break;default:p({anthropicApiKey:t,apiKey:t})}},placeholder:"openrouter"===u.settings.provider?"⚠️ OpenRouter support coming soon":"openai"===u.settings.provider?"⚠️ OpenAI support coming soon":"⚠️ Enter your Anthropic API key to use the chat",className:"openrouter"===u.settings.provider?"":(null===(e=u.settings.anthropicApiKey)||void 0===e?void 0:e.trim())||(null===(t=u.settings.apiKey)||void 0===t?void 0:t.trim())?"":"border-red-500 dark:border-red-400 placeholder:text-red-500/90 dark:placeholder:text-red-400/90 placeholder:font-medium",disabled:"openrouter"===u.settings.provider||"openai"===u.settings.provider})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"GROQ API Key"}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Required for voice transcription. Get yours at"," ",(0,r.jsx)("a",{href:"https://console.groq.com/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"console.groq.com"})]}),(0,r.jsx)(eo,{type:"password",value:u.settings.groqApiKey||"",onChange:e=>{p({groqApiKey:e.target.value.trim()})},placeholder:"Enter your GROQ API key for voice transcription"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Model"}),(0,r.jsx)("select",{value:u.settings.model,onChange:e=>p({model:e.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:(0,ev.SM)(u.settings.provider||"anthropic").map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"System Prompt"}),(0,r.jsx)(I,{value:u.settings.systemPrompt,onChange:e=>p({systemPrompt:e.target.value}),placeholder:"Enter a system prompt...",className:"min-h-[100px]"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("input",{type:"checkbox",id:"elideToolResults",checked:null!==(s=u.settings.elideToolResults)&&void 0!==s&&s,onChange:e=>p({elideToolResults:e.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),(0,r.jsx)("label",{htmlFor:"elideToolResults",className:"text-sm font-medium",children:"Use Claude to elide tool results from previous messages"})]})]})]})}),(0,r.jsx)(ej,{serverIds:u.settings.mcpServerIds||[],onServerIdsChange:e=>p({mcpServerIds:e})}),(0,r.jsx)(ea,{className:"mt-6",children:(0,r.jsxs)(en,{className:"p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Advanced Settings"}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground mb-4",children:"Database Version: 5"}),(0,r.jsx)(g,{variant:"destructive",onClick:()=>d(!0),children:"Reset state"}),(0,r.jsx)(ei,{open:c,onOpenChange:d,children:(0,r.jsxs)(eu,{children:[(0,r.jsxs)(ep,{children:[(0,r.jsx)(ex,{children:"Reset Application State"}),(0,r.jsx)(ef,{children:"Are you sure you want to reset the application state? This will delete all projects, conversations, and settings. This action cannot be undone."})]}),(0,r.jsxs)(em,{children:[(0,r.jsx)(eg,{children:"Cancel"}),(0,r.jsx)(eh,{onClick:async()=>{let e=async()=>Promise.all((await window.indexedDB.databases()).map(e=>new Promise((t,s)=>{let r=window.indexedDB.deleteDatabase(e.name);r.onsuccess=()=>t(),r.onerror=()=>s(r.error)})));try{await e(),window.location.reload()}catch(e){console.error("Error clearing databases:",e)}},children:"Reset"})]})]})})]})})]})};var eT=s(4024),eE=s(4857),eO=s(1719),eK=s(2060),eF=s(872);let eU=e=>{let{onExportConversation:t,isMobileMenuOpen:s=!0,onMobileMenuToggle:n,onConversationSelect:o}=e,{projects:l,activeProjectId:i,activeConversationId:c,createProject:d,deleteProject:u,createConversation:p,deleteConversation:x,renameConversation:f,renameProject:h,setActiveProject:v,setActiveConversation:y}=(0,B.P)(),[b,j]=(0,a.useState)(new Set),[w,N]=(0,a.useState)(!1);(0,a.useEffect)(()=>{i&&j(e=>{let t=new Set(e);return t.add(i),t})},[i]);let[k,A]=(0,a.useState)(!1),[C,R]=(0,a.useState)(null),[_,S]=(0,a.useState)(null),[P,I]=(0,a.useState)(""),D=e=>{j(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[z]=(0,a.useState)({}),T=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=l.find(t=>t.id===e);if(null==s?void 0:s.conversations){if(t&&0===s.conversations.length)p(e);else if(s.conversations.length>0){let t=z[e];t&&s.conversations.some(e=>e.id===t)?y(t):y(s.conversations[0].id)}v(e)}};(0,a.useEffect)(()=>{i&&c&&(z[i]=c)},[i,c]);let E=[...l].sort((e,t)=>(e.order||0)-(t.order||0));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g,{variant:"secondary",size:"icon",className:"fixed left-4 top-4 z-[100] md:hidden rounded-full shadow-lg hover:shadow-xl bg-background",onClick:n,"aria-label":"Toggle mobile menu",children:(0,r.jsx)(m.A,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{className:"\n        fixed inset-y-0 left-0\n        md:sticky md:top-0 md:left-auto\n        w-[280px] max-w-[85vw]\n        bg-background border-r\n        transition-transform duration-200 ease-in-out\n        ".concat(s?"translate-x-0":"-translate-x-full","\n        md:translate-x-0\n        z-40\n        flex flex-col\n        h-screen\n      "),children:[(0,r.jsxs)("div",{className:"flex gap-2 mb-2 p-4 pt-16 md:pt-4",children:[(0,r.jsxs)(g,{onClick:()=>{d("New Project")},className:"flex-1",variant:"outline",children:[(0,r.jsx)(eT.A,{className:"w-4 h-4 mr-2"}),"New Project"]}),(0,r.jsx)(g,{onClick:()=>i&&t(i),variant:"outline",disabled:!i,children:(0,r.jsx)(eE.A,{className:"w-4 h-4"})})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0 px-4",children:E.map((e,t)=>(0,r.jsxs)("div",{className:"mb-2 ".concat(t>0?"mt-2 pt-2 border-t border-accent/35":""),children:[(0,r.jsxs)("div",{className:"p-2 rounded-lg flex items-center gap-2 transition-colors cursor-pointer\n                ".concat(e.id===i?"bg-accent text-accent-foreground":"hover:bg-muted","\n                text-base font-medium"),onClick:t=>{t.stopPropagation(),D(e.id),e.id!==i&&(T(e.id,!0),null==n||n())},children:[(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),t.preventDefault(),D(e.id)},className:"p-1 hover:bg-muted-foreground/10 rounded",children:b.has(e.id)?(0,r.jsx)(eO.A,{className:"w-4 h-4"}):(0,r.jsx)(eA.A,{className:"w-4 h-4"})}),(0,r.jsx)("span",{className:"truncate flex-1",title:e.name,children:e.name}),(0,r.jsx)(g,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:t=>{t.stopPropagation(),v(e.id),p(e.id),j(t=>{let s=new Set(t);return s.add(e.id),s}),null==o||o(),null==n||n()},title:"New chat",children:(0,r.jsx)(eK.A,{className:"w-4 h-4 opacity-100 transition-all duration-200 hover:scale-125 hover:opacity-75"})}),(0,r.jsx)(g,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:t=>{t.stopPropagation(),S({type:"project",projectId:e.id,currentName:e.name}),I(e.name),A(!0)},children:(0,r.jsx)(eF.A,{className:"w-4 h-4 opacity-100 transition-all duration-200 hover:scale-125 hover:opacity-75"})}),(0,r.jsx)(g,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:t=>{t.stopPropagation(),R({type:"project",projectId:e.id}),N(!0)},children:(0,r.jsx)(eb.A,{className:"w-4 h-4 text-destructive opacity-100 transition-all duration-200 hover:scale-125 hover:opacity-75"})})]}),b.has(e.id)&&(0,r.jsx)("div",{className:"ml-4 mt-1 space-y-1",children:e.conversations.sort((e,t)=>{let s=e=>e?e instanceof Date?e.getTime():new Date(e).getTime():Date.now(),r=s(e.createdAt||e.lastUpdated);return s(t.createdAt||t.lastUpdated)-r}).map(t=>(0,r.jsxs)("div",{className:"p-2 rounded-lg cursor-pointer flex items-center gap-2 transition-colors\n                      ".concat(t.id===c?"bg-accent text-accent-foreground":"hover:bg-muted","\n                      text-sm truncate max-w-[250px]"),onClick:()=>{T(e.id),y(t.id),null==o||o(),null==n||n()},children:[(0,r.jsx)("span",{className:"truncate flex-1",title:t.name,children:t.name}),(0,r.jsx)(g,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:s=>{s.stopPropagation(),S({type:"conversation",projectId:e.id,conversationId:t.id,currentName:t.name}),I(t.name),A(!0)},children:(0,r.jsx)(eF.A,{className:"w-4 h-4 opacity-100 transition-opacity duration-200 hover:opacity-75"})}),(0,r.jsx)(g,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:s=>{s.stopPropagation(),R({type:"conversation",projectId:e.id,conversationId:t.id}),N(!0)},children:(0,r.jsx)(eb.A,{className:"w-4 h-4 text-destructive opacity-100 transition-opacity duration-200 hover:opacity-75"})})]},t.id))})]},e.id))}),(0,r.jsx)(ei,{open:w,onOpenChange:N,children:(0,r.jsxs)(eu,{children:[(0,r.jsxs)(ep,{children:[(0,r.jsxs)(ex,{children:["Delete ",(null==C?void 0:C.type)==="project"?"Project":"Conversation"]}),(0,r.jsxs)(ef,{children:["Are you sure you want to delete this ",null==C?void 0:C.type,"? This action cannot be undone.",(null==C?void 0:C.type)==="project"&&" All conversations in this project will be deleted."]})]}),(0,r.jsxs)(em,{children:[(0,r.jsx)(eg,{onClick:()=>N(!1),children:"Cancel"}),(0,r.jsx)(eh,{onClick:()=>{C&&("project"===C.type?u(C.projectId):C.conversationId&&x(C.projectId,C.conversationId),N(!1),R(null))},autoFocus:!0,children:"Delete"})]})]})}),(0,r.jsx)(q,{open:k,onOpenChange:A,children:(0,r.jsx)(G,{children:(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),_&&P.trim()&&("project"===_.type?h(_.projectId,P.trim()):_.conversationId&&f(_.projectId,_.conversationId,P.trim()),A(!1),S(null),I(""))},children:[(0,r.jsx)(H,{children:(0,r.jsxs)(Y,{children:["Rename ",(null==_?void 0:_.type)==="project"?"Project":"Conversation"]})}),(0,r.jsx)(eo,{value:P,onChange:e=>I(e.target.value),placeholder:"Enter new name",className:"my-4"}),(0,r.jsxs)(J,{children:[(0,r.jsx)(g,{type:"button",variant:"outline",onClick:()=>{A(!1),S(null),I("")},children:"Cancel"}),(0,r.jsx)(g,{type:"submit",variant:"default",children:"Save"})]})]})})})]})]})},eq=()=>{let[e,t]=(0,a.useState)(!1),[s,n]=(0,a.useState)("chat"),o=(0,a.useRef)(null);return a.useEffect(()=>{t(window.innerWidth>=768)},[]),(0,r.jsxs)("div",{className:"min-h-screen bg-background text-foreground flex relative overflow-x-hidden",children:[e&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 md:hidden z-40 backdrop-blur-sm transition-opacity duration-200",onClick:()=>t(!1)}),(0,r.jsx)(eU,{onExportConversation:(e,t)=>{console.log("Export",{projectId:e,conversationId:t})},isMobileMenuOpen:e,onMobileMenuToggle:()=>t(!e),onConversationSelect:()=>n("chat")}),(0,r.jsx)(g,{variant:"outline",size:"icon",className:"fixed left-4 top-4 z-50 md:hidden shadow-lg ".concat(e?"hidden":"flex"," w-9 h-9 rounded-full"),onClick:()=>t(!0),children:(0,r.jsx)(m.A,{className:"w-4 h-4"})}),(0,r.jsxs)("div",{className:"flex-1 relative",children:[(0,r.jsx)("div",{className:"absolute right-4 top-4 z-50 flex items-center gap-4 transition-opacity duration-200\n              ".concat(e?"opacity-100":"md:opacity-100 opacity-0 pointer-events-none md:pointer-events-auto"),children:(0,r.jsx)(c,{value:s,onValueChange:e=>{n(e),window.innerWidth<768&&t(!1),"chat"===e&&setTimeout(()=>{var e;null===(e=o.current)||void 0===e||e.focus()},0)},children:(0,r.jsx)("div",{className:"flex items-center gap-4 bg-background/80 backdrop-blur-sm rounded-lg shadow-lg p-1",children:(0,r.jsxs)(d,{className:"bg-transparent",children:[(0,r.jsx)(u,{value:"chat",children:"Chat"}),(0,r.jsx)(u,{value:"settings",children:"Settings"})]})})})}),(0,r.jsx)("div",{className:"flex flex-col h-full",children:(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"settings"===s?"hidden":"",children:(0,r.jsx)(c,{value:s,children:(0,r.jsx)(p,{value:"chat",forceMount:!0,children:(0,r.jsx)(er,{ref:o})})})}),(0,r.jsx)("div",{className:"chat"===s?"hidden":"",children:(0,r.jsx)(c,{value:s,children:(0,r.jsx)(p,{value:"settings",forceMount:!0,children:(0,r.jsx)(ez,{})})})})]})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[359,434,441,517,358],()=>t(4352)),_N_E=e.O()}]);