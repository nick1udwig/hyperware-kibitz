(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4352:(e,t,s)=>{Promise.resolve().then(s.bind(s,5461))},5461:(e,t,s)=>{"use strict";s.d(t,{default:()=>e6});var r=s(5155),n=s(2115),a=s(8629),o=s(3463),l=s(9795);function i(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,l.QP)((0,o.$)(t))}let c=a.bL,d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(a.B8,{ref:t,className:i("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...n})});d.displayName=a.B8.displayName;let u=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(a.l9,{ref:t,className:i("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...n})});u.displayName=a.l9.displayName;let m=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(a.UC,{ref:t,className:i("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...n})});m.displayName=a.UC.displayName;var p=s(6710),h=s(2317),x=s(1027);let f=(0,x.F)("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background",{variants:{variant:{default:"bg-primary/90 text-primary-foreground hover:bg-primary/60",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"underline-offset-4 hover:underline text-primary"},size:{default:"h-10 py-2 px-4",sm:"h-9 px-3 rounded-md",lg:"h-11 px-8 rounded-md",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),g=n.forwardRef((e,t)=>{let{className:s,variant:n,size:a,asChild:o=!1,...l}=e,c=o?h.DX:"button";return(0,r.jsx)(c,{className:i(f({variant:n,size:a,className:s})),ref:t,...l})});g.displayName="Button";let v=()=>(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-[3px] border-current/30 border-t-current"});var y=s(3950);let j=()=>{let{projects:e,activeProjectId:t,createConversation:s,setActiveConversation:r,activeConversationId:a}=(0,y.P)(),o=e.find(e=>e.id===t),l=(0,n.useCallback)(t=>{let n=e.find(e=>e.id===t);if(!n)return;if(0===n.conversations.length){s(t);return}let a=n.conversations[n.conversations.length-1];if(0===a.messages.length){r(a.id);return}s(t)},[e,s,r]);return(0,n.useEffect)(()=>{if(t&&!a){let n=e.find(e=>e.id===t);if(n){if(0===n.conversations.length)s(t);else{let e=n.conversations[n.conversations.length-1];0===e.messages.length?r(e.id):s(t)}}}},[t,a,e,s,r]),{handleProjectFocus:l,activeProject:o}};var b=s(6217),w=s(767);let N=b.bL;b.l9;let k=b.ZL,C=n.forwardRef(function(e,t){return(0,r.jsx)(b.hJ,{ref:t,className:i("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e.className),...e})}),A=n.forwardRef(function(e,t){return(0,r.jsxs)(k,{children:[(0,r.jsx)(C,{}),(0,r.jsxs)(b.UC,{ref:t,className:i("fixed left-[50%] top-[50%] z-50 grid w-full translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg","max-w-[90%] sm:max-w-[85%] md:max-w-[80%] lg:max-w-[75%]","max-h-[85vh] overflow-y-auto",e.className),...e,children:[e.children,(0,r.jsxs)(b.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(w.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}),S=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:i("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})},R=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:i("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})},_=n.forwardRef(function(e,t){return(0,r.jsx)(b.hE,{ref:t,className:i("text-lg font-semibold leading-none tracking-tight",e.className),...e})});var P=s(314),I=s(4504);let E=e=>{let{toolCall:t,onClose:s}=e,[a,o]=(0,n.useState)(!1);return(0,r.jsx)(N,{open:!0,onOpenChange:s,children:(0,r.jsxs)(A,{children:[(0,r.jsx)(S,{className:"mb-4 shrink-0",children:(0,r.jsxs)("div",{className:"flex justify-between items-center gap-4",children:[(0,r.jsx)(_,{className:"truncate",children:"Tool Call: ".concat(t.name)}),(0,r.jsx)(g,{variant:"ghost",size:"icon",onClick:()=>o(!a),children:a?(0,r.jsx)(P.A,{className:"h-4 w-4"}):(0,r.jsx)(I.A,{className:"h-4 w-4"})})]})}),(0,r.jsxs)("div",{className:i("space-y-4 overflow-hidden flex-grow overflow-y-auto pr-2",a&&"h-[75vh]"),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium mb-2",children:"Input:"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("pre",{className:i("bg-muted p-2 sm:p-4 rounded-md whitespace-pre-wrap break-all text-sm sm:text-base",!a&&"max-h-[100px] sm:max-h-[120px] overflow-hidden"),children:JSON.stringify(t.input,null,2)}),!a&&(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-muted to-transparent pointer-events-none"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium mb-2",children:"Result:"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("pre",{className:i("bg-muted p-2 sm:p-4 rounded-md whitespace-pre-wrap break-all text-sm sm:text-base",!a&&"max-h-[100px] sm:max-h-[120px] overflow-hidden"),children:t.result||"No result available"}),!a&&(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-muted to-transparent pointer-events-none"})]})]})]})]})})};var z=s(5565),T=s(3550),D=s(6246),M=s(8867),O=s(7341);let U=e=>{let{text:t,className:s="",light:a=!1}=e,[o,l]=(0,n.useState)(!1),i=async e=>{e.preventDefault(),e.stopPropagation();try{await navigator.clipboard.writeText(t),l(!0),setTimeout(()=>l(!1),2e3)}catch(e){console.error("Failed to copy text:",e)}};return(0,r.jsxs)("button",{onClick:i,className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-sm ".concat(a?"text-accent-foreground hover:bg-accent-foreground/10":"hover:bg-kinode-orange/10"," ").concat(s),children:[o?(0,r.jsx)(M.A,{className:"h-4 w-4"}):(0,r.jsx)(O.A,{className:"h-4 w-4"}),o?"Copied":"Copy"]})},K=e=>{let{content:t,isUserMessage:s,onToolClick:n,toolResult:a,contentIndex:o,messageIndex:l}=e;return"text"===t.type?(0,r.jsx)("div",{className:"flex max-w-full pt-6",children:(0,r.jsxs)("div",{className:"relative group w-full max-w-full overflow-x-auto",children:[!t.text.match(/```[\s\S]*```/)&&(0,r.jsx)("div",{className:"absolute right-2 top-0 z-10",children:(0,r.jsx)(U,{text:t.text.trim(),light:s,className:"opacity-0 group-hover:opacity-100 transition-opacity"})}),(0,r.jsx)("div",{className:"w-full max-w-full rounded-lg px-4 py-2 ".concat(s?"bg-accent !text-accent-foreground":"bg-muted text-foreground"),children:(0,r.jsx)(T.o,{className:"prose dark:prose-invert break-words max-w-full ".concat(s?"[&_p]:!text-accent-foreground [&_code]:!text-accent-foreground":""),components:{p:e=>{let{children:t}=e;return(0,r.jsx)("p",{className:"break-words whitespace-pre-wrap overflow-hidden",children:t})},pre(e){let{children:t,...n}=e,a=e=>{if("string"==typeof e)return e;if(!e)return"";if(Array.isArray(e))return e.map(a).join("\n");if("object"==typeof e&&null!==e&&"props"in e){var t,s,r;if((null===(s=e.props)||void 0===s?void 0:null===(t=s.className)||void 0===t?void 0:t.includes("language-"))||(null===(r=e.props)||void 0===r?void 0:r.children))return a(e.props.children)}return""},o=a(t).trim();return(0,r.jsxs)("div",{className:"group/code relative max-w-full",children:[(0,r.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,r.jsx)(U,{text:o,light:s,className:"opacity-0 group-hover/code:opacity-100 transition-opacity"})}),(0,r.jsx)("pre",{className:"overflow-x-auto max-w-full whitespace-pre",...n,children:t})]})},code(e){let{className:t,children:s}=e;return(null==t?void 0:t.includes("language-"))===!1?(0,r.jsx)("code",{className:"text-inherit whitespace-nowrap inline",children:s}):(0,r.jsx)("code",{className:"block overflow-x-auto whitespace-pre-wrap",children:s})},a:e=>{let{href:t,children:s}=e;return(0,r.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:s})}},remarkPlugins:[D.A],children:t.text})})]})},"text-".concat(l,"-").concat(o)):"image"===t.type?(0,r.jsx)("div",{className:"flex",children:(0,r.jsx)("div",{className:"w-full rounded-lg px-4 py-2 ".concat(s?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,r.jsx)(z.default,{src:"data:".concat(t.source.media_type,";base64,").concat(t.source.data),alt:"User uploaded image",className:"max-h-[150px] max-w-[300px] w-auto h-auto rounded object-contain",width:300,height:150})})},"image-".concat(l,"-").concat(o)):"document"===t.type?(0,r.jsx)("div",{className:"flex",children:(0,r.jsx)("div",{className:"w-full rounded-lg px-4 py-2 ".concat(s?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,r.jsx)("embed",{src:"data:".concat(t.source.media_type,";base64,").concat(t.source.data),type:t.source.media_type,width:"100%",height:"600px",className:"rounded"})})},"document-".concat(l,"-").concat(o)):"tool_use"===t.type?(0,r.jsx)("div",{className:"flex",children:(0,r.jsx)("div",{className:"w-full rounded-lg px-4 py-2 relative group ".concat(s?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,r.jsx)("div",{className:"space-y-2",children:(0,r.jsxs)("button",{onClick:()=>null==n?void 0:n(t.name,t.input,a),className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 underline group",children:["\uD83D\uDEE0️: ",t.name]})})})},"tool_use-".concat(l,"-").concat(o)):null},F=e=>{let{files:t,onRemove:s}=e;return 0===t.length?null:(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:t.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center gap-2 bg-muted rounded px-2 py-1",children:[(0,r.jsx)("span",{className:"text-sm",children:"text"===e.type?"Text file":"fileName"in e&&e.fileName||"Untitled"}),(0,r.jsx)("button",{onClick:()=>s(t),className:"hover:text-destructive",children:(0,r.jsx)(w.A,{className:"h-4 w-4"})})]},t))})},q=n.forwardRef((e,t)=>{let{className:s,maxRows:a=8,onChange:o,...l}=e,c=n.useRef(null),d=n.useCallback(e=>{let t=c.current;if(t&&(t.style.height="2.5em",t.scrollHeight>t.clientHeight)){let e=Math.min(t.scrollHeight,a*parseInt(getComputedStyle(t).lineHeight));t.style.height="".concat(e,"px")}null==o||o(e)},[a,o]);return n.useEffect(()=>{c.current&&(c.current.style.height="2.5em",c.current.style.lineHeight="1em")},[]),(0,r.jsx)("textarea",{className:i("flex h-[2.5em] w-full rounded-md border border-input bg-transparent px-3 py-2 text-[12px] ring-offset-background placeholder:text-muted-foreground placeholder:text-[12px] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 overflow-y-auto resize-none transition-height duration-150",s),ref:e=>{c.current=e,"function"==typeof t?t(e):t&&(t.current=e)},onChange:d,...l})});q.displayName="Textarea";var L=s(3608);let H=["image/jpeg","image/png","image/gif","image/webp"],G=["application/pdf"],J=["applications/javascript","application/typescript","application/x-httpd-php","application/x-sh","application/x-powershell","application/json","application/xml","application/yaml","application/toml","application/x-tex","application/sql","application/x-python","application/x-ruby","application/x-diff","application/x-patch","application/typescript","application/x-properties"],B=e=>{let{onFileSelect:t,onUploadComplete:s}=e,a=(0,n.useRef)(null),o=(0,n.useCallback)(async e=>{if(!(H.includes(e.type)||G.includes(e.type)||e.type.startsWith("text/")||J.includes(e.type))){alert("Unsupported file type. Please upload an image (JPEG, PNG, GIF, WebP), a PDF, or a plaintext document.");return}let r=new FileReader;r.onload=async()=>{let n=r.result.split(",")[1];if(e.type.startsWith("text/")||J.includes(e.type)){t({type:"text",text:function(e){try{let t=atob(e),s=new Uint8Array(t.length);for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);return new TextDecoder("utf-8").decode(s)}catch(e){throw Error("Failed to decode base64 string: "+e.message)}}(n)}),null==s||s();return}H.includes(e.type)?(t({type:"image",source:{type:"base64",media_type:e.type,data:n},fileName:e.name}),null==s||s()):"application/pdf"===e.type&&(t({type:"document",source:{type:"base64",media_type:"application/pdf",data:n},fileName:e.name}),null==s||s())},r.readAsDataURL(e)},[t,s]),l=(0,n.useCallback)(async e=>{for(let t of Array.from(e.target.files||[]))await o(t)},[o]),i=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation()},[]),c=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer&&Array.from(e.dataTransfer.files).forEach(o)},[o]);return n.useEffect(()=>{let e=document.querySelector("textarea");return e&&(e.addEventListener("dragover",i),e.addEventListener("drop",c)),()=>{e&&(e.removeEventListener("dragover",i),e.removeEventListener("drop",c))}},[i,c]),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"file",ref:a,onChange:l,accept:[...H,...G].join(","),className:"hidden",multiple:!0}),(0,r.jsx)(g,{onClick:()=>{var e;null===(e=a.current)||void 0===e||e.click()},variant:"ghost",size:"icon",className:"h-7 w-7",title:"Upload files (Images or PDFs)",children:(0,r.jsx)(L.A,{className:"h-4 w-4"})})]})};var W=s(6164);let V=e=>{let{onTranscriptionComplete:t}=e,[s,a]=(0,n.useState)(!1),[o,l]=(0,n.useState)(!1),i=(0,n.useRef)(null),c=(0,n.useRef)([]),{projects:d,activeProjectId:u}=(0,y.P)(),m=d.find(e=>e.id===u),p=(0,n.useRef)(null),h=(0,n.useRef)(null),x=(0,n.useRef)(null),f=(0,n.useRef)(null),j=async e=>{e.preventDefault(),e.stopPropagation(),s?w():await b()},b=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new AudioContext,s=t.createAnalyser();t.createMediaStreamSource(e).connect(s),s.fftSize=128,s.smoothingTimeConstant=.8,x.current=s,f.current=t;let r=new MediaRecorder(e);i.current=r,c.current=[],r.ondataavailable=e=>{e.data.size>0&&c.current.push(e.data)},r.onstop=async()=>{let t=new Blob(c.current,{type:"audio/webm"});l(!0),await R(t),l(!1),e.getTracks().forEach(e=>e.stop())},r.start(),a(!0)}catch(e){console.error("Error accessing microphone:",e),alert("Error accessing microphone. Please ensure microphone permissions are granted.")}},w=()=>{i.current&&s&&(i.current.stop(),a(!1),f.current&&f.current.close(),h.current&&cancelAnimationFrame(h.current))},k=n.useCallback(()=>{if(!p.current)return;let e=p.current,t=window.devicePixelRatio||1,s=e.getBoundingClientRect();e.width=s.width*t,e.height=s.height*t;let r=e.getContext("2d");r&&r.scale(t,t)},[]),C=n.useCallback(()=>{if(!x.current||!p.current)return;let e=p.current,t=e.getContext("2d");if(!t)return;let r=e.getBoundingClientRect(),n=x.current.frequencyBinCount,a=new Uint8Array(n),o=[];for(let e=0;e<=255;e+=8){let t=e/255;o.push("rgba(59, 130, 246, ".concat(t,")"))}let l=0,i=()=>{var c;if(!s)return;let d=performance.now();if(d-l<33.333333333333336){h.current=requestAnimationFrame(i);return}l=d,null===(c=x.current)||void 0===c||c.getByteFrequencyData(a);let u=window.devicePixelRatio||1;t.clearRect(0,0,e.width,e.height);let m=r.width,p=r.height,f=m/32*.8,g=0;for(let e=0;e<32;e++){let s=Math.floor(e/32*(n/4)),r=a[s]/255*p,l=Math.floor(a[s]/255*(o.length-1));t.fillStyle=o[l],t.fillRect(g*u,(p-r)*u,f*u,r*u),g+=f+2}};i()},[s]);(0,n.useEffect)(()=>{let e;return s&&(k(),C(),e=new ResizeObserver(()=>{k()}),p.current&&e.observe(p.current),h.current=requestAnimationFrame(function e(){C(),s&&(h.current=requestAnimationFrame(e))})),()=>{h.current&&cancelAnimationFrame(h.current),e&&e.disconnect()}},[s,C,k]);let R=async e=>{if(!(null==m?void 0:m.settings.groqApiKey)){alert("Please set your GROQ API key in settings first");return}let s=new FormData;s.append("file",e,"recording.webm"),s.append("model","whisper-large-v3");try{let e=await fetch("https://api.groq.com/openai/v1/audio/transcriptions",{method:"POST",headers:{Authorization:"Bearer ".concat(m.settings.groqApiKey)},body:s});if(!e.ok)throw Error("Error transcribing audio: ".concat(e.statusText));let r=await e.json();r.text&&t(r.text)}catch(e){console.error("Error transcribing audio:",e),l(!1),alert("Error transcribing audio. Please check your GROQ API key and try again.")}};return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{children:[(0,r.jsx)(g,{variant:"ghost",size:"icon",className:"h-7 w-7 ".concat(s?"text-red-500":""," hover:bg-accent hover:text-accent-foreground"),onClick:j,disabled:!(null==m?void 0:m.settings.groqApiKey)||o,title:(null==m?void 0:m.settings.groqApiKey)?s?"Stop Recording":"Start Recording":"Set GROQ API key in settings to enable voice recording",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(W.A,{className:"h-4 w-4"}),o&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsx)(v,{})})]})}),(0,r.jsx)(N,{open:s,onOpenChange:e=>{!e&&s&&w()},children:(0,r.jsxs)(A,{children:[(0,r.jsxs)(S,{className:"pb-2",children:[(0,r.jsx)(_,{className:"sr-only",children:"Voice Recording in Progress"}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Listening"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Tap anywhere to transcribe"})]})]}),(0,r.jsx)("div",{className:"mt-2",onClick:w,children:(0,r.jsx)("canvas",{ref:p,className:"w-full h-24 sm:h-32 bg-background border rounded-md",style:{touchAction:"none"}})})]})})]})})};var Q=s(1406),Z=s(8283);let Y=e=>{let{value:t,onChange:s,onSend:a,onStop:o,isLoading:l,isDisabled:i,onFileSelect:c,placeholder:d="Type your message"}=e,u=(0,n.useRef)(null);return n.useEffect(()=>{l&&u.current&&(u.current.style.height="auto")},[l]),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsx)(q,{value:l?"Processing...":t,onChange:e=>s(e.target.value),placeholder:d,readOnly:l,onKeyDown:e=>{let t=window.matchMedia("(max-width: 768px)").matches;"Enter"!==e.key||e.shiftKey||l||t||(e.preventDefault(),a())},ref:u,className:"pr-20 transition-colors ".concat(l?"bg-muted text-muted-foreground resize-none":""),maxRows:8,disabled:i||l}),(0,r.jsx)("div",{className:"absolute right-2 bottom-2 flex gap-1",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(B,{onFileSelect:c,onUploadComplete:()=>{u.current&&u.current.focus()}}),(0,r.jsx)(V,{onTranscriptionComplete:e=>{s(t.trim()?"".concat(t,"\n").concat(e):e)}})]})})]}),(0,r.jsx)(g,{onClick:l?o:a,disabled:i||l&&!o,className:"self-end relative ".concat(l?"bg-destructive hover:bg-destructive/90":""),children:l?(0,r.jsx)(Q.A,{className:"w-4 h-4"}):(0,r.jsx)(Z.A,{className:"w-4 h-4"})})]})};var X=s(1719);let $=e=>{let{onClick:t,visible:s}=e;return s?(0,r.jsx)("button",{onClick:t,className:"fixed bottom-[60px] right-2 md:right-8 z-[100] bg-primary/70 text-primary-foreground rounded-full p-3 shadow-lg hover:bg-primary/90 transition-all hover:scale-110 animate-in fade-in slide-in-from-right-2","aria-label":"Scroll to bottom",children:(0,r.jsx)(X.A,{className:"w-6 h-6"})}):null};var ee=s(2920);let et=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(ee.bL,{className:i("peer inline-flex h-3 w-6 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-accent data-[state=unchecked]:bg-input scale-90",s),...n,ref:t,children:(0,r.jsx)(ee.zi,{className:i("pointer-events-none block h-2 w-2 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-3 data-[state=unchecked]:translate-x-0")})})});et.displayName=ee.bL.displayName;let es=e=>{let{checked:t,onChange:s}=e;return(0,r.jsxs)("div",{className:"fixed right-4 bottom-16 z-[60] flex items-center gap-1.5 bg-background/80 backdrop-blur-sm rounded-lg px-1.5 py-1 shadow-lg border border-input",children:[(0,r.jsx)(et,{checked:t,onCheckedChange:s}),(0,r.jsx)("span",{className:"text-[10px] text-muted-foreground leading-none",children:"History"})]})};var er=s(4521),en=s(6440);class ea{async acquire(){if(this.isSupported)try{this.wakeLock=await navigator.wakeLock.request("screen"),console.log("Screen wake lock acquired")}catch(e){console.warn("Failed to acquire wake lock:",e)}}async release(){if(this.wakeLock)try{await this.wakeLock.release(),this.wakeLock=null,console.log("Screen wake lock released")}catch(e){console.warn("Failed to release wake lock:",e)}}isActive(){return null!==this.wakeLock}constructor(){this.wakeLock=null,this.isSupported=!1,this.isSupported="undefined"!=typeof navigator&&"wakeLock"in navigator&&/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase())}}let eo=new ea;var el=s(1491);let ei="claude-3-5-sonnet-20241022",ec=()=>{let[e,t]=(0,n.useState)(!1),[s,r]=(0,n.useState)(null),a=(0,n.useRef)(!1),o=(0,n.useRef)(null),{projects:l,activeProjectId:i,activeConversationId:c,updateProjectSettings:d,renameConversation:u,servers:m,executeTool:p}=(0,y.P)(),h=l.find(e=>e.id===i),x=(0,n.useCallback)(e=>{var t;if(!(null==h?void 0:null===(t=h.settings.mcpServerIds)||void 0===t?void 0:t.length))return[];let s=new Map;m.filter(e=>h.settings.mcpServerIds.includes(e.id)).flatMap(e=>e.tools||[]).forEach(e=>{s.has(e.name)||s.set(e.name,{name:e.name,description:e.description||"Tool ".concat(e.name),input_schema:e.input_schema})});let r=Array.from(s.values());return e?r.map((e,t,s)=>t!=s.length-1?e:{...e,cache_control:{type:"ephemeral"}}):r},[null==h?void 0:h.settings.mcpServerIds,m]),f=(0,n.useCallback)((e,t,s)=>{let r=null==h?void 0:h.conversations.find(e=>e.id===t);r&&d(e,{conversations:h.conversations.map(e=>e.id===t?{...r,messages:s,lastUpdated:new Date}:e)})},[h,d]);return{isLoading:e,error:s,handleSendMessage:async(e,s)=>{var n,l,i,d,g,v,y,j,b;if(a.current=!1,!e.trim()&&0===s.length||!h||!c)return;r(null),t(!0);let w="openrouter"===h.settings.provider?h.settings.openRouterApiKey:h.settings.anthropicApiKey||h.settings.apiKey;if(!(null==w?void 0:w.trim())){r("API key not found. Please set your ".concat("openrouter"===h.settings.provider?"OpenRouter":"Anthropic"," API key in the Settings panel.")),t(!1);return}await eo.acquire();try{let b=s.map(e=>(e.type,{...e,fileName:void 0}));e.trim()&&b.push({type:"text",text:e});let w=h.conversations.find(e=>e.id===c),N={role:"user",content:b,timestamp:new Date},k=[...(null==w?void 0:w.messages)||[],N];f(h.id,c,k);let C=new er.NB({apiKey:h.settings.anthropicApiKey||h.settings.apiKey||"",dangerouslyAllowBrowser:!0,maxRetries:12}),A=x(!0),S=x(!1),R=null===(n=h.settings.systemPrompt)||void 0===n?void 0:n.trim(),_=R?[{type:"text",text:R}]:void 0;console.log("Using provider:",h.settings.provider);let P=async e=>{let t;for(let r=0;r<12;r++)try{return await C.messages.stream(e)}catch(e){if(t=e,"object"==typeof e&&null!==e){var s;if(((null===(s=e.error)||void 0===s?void 0:s.type)==="overloaded_error"||429===e.status)&&r<11){await new Promise(e=>setTimeout(e,5e3));continue}}throw e}throw t};for(;!a.current;){let e=k.filter((e,t,s)=>{if("string"==typeof e.content)return!0;let r=e.content;if(!r.some(e=>"tool_use"===e.type))return!0;let n=s[t+1];if(!n||"string"==typeof n.content)return!1;let a=n.content;return r.every(e=>{if("tool_use"!==e.type||!("id"in e))return!0;let t=e.id;return a.some(e=>"tool_result"===e.type&&"tool_use_id"in e&&e.tool_use_id===t)})}).map((e,t,s)=>"anthropic"!==h.settings.provider||t<s.length-3?{role:e.role,content:e.content,toolInput:e.toolInput?e.toolInput:void 0}:{role:e.role,content:"string"==typeof e.content?[{type:"text",text:e.content,cache_control:{type:"ephemeral"}}]:e.content.map((e,t,s)=>t!=s.length-1?e:{...e,cache_control:{type:"ephemeral"}}),toolInput:e.toolInput?e.toolInput:void 0}).map(e=>({role:e.role,content:e.content,name:e.toolInput})),s={role:"assistant",content:[],timestamp:new Date},n={type:"text",text:""};if(s.content.push(n),"openai"===h.settings.provider||"openrouter"===h.settings.provider){let o="openrouter"===h.settings.provider?"https://openrouter.ai/api/v1":void 0,x="openrouter"===h.settings.provider?h.settings.openRouterApiKey:h.settings.openaiApiKey,b=new en.Ay({baseURL:o,apiKey:x,dangerouslyAllowBrowser:!0});try{let t=(0,el.NQ)(e,S),r=await b.chat.completions.create({model:h.settings.model||"gpt-4",messages:t.messages,tools:t.tools,stream:!0}),o=null;for await(let e of r){if(a.current)break;let t=null==e?void 0:null===(d=e.choices)||void 0===d?void 0:null===(i=d[0])||void 0===i?void 0:null===(l=i.delta)||void 0===l?void 0:l.content,r=null==e?void 0:null===(y=e.choices)||void 0===y?void 0:null===(v=y[0])||void 0===v?void 0:null===(g=v.delta)||void 0===g?void 0:g.tool_calls;if(r){let e=r[0];if(o){if(e.function){let t=(null==o?void 0:o.name)||"",s=(null==o?void 0:o.arguments)||"";o={name:t||e.function.name||"",arguments:s+(e.function.arguments||"")}}}else e.function&&(o={name:e.function.name||"",arguments:e.function.arguments||""})}if(t){n.text+=t;let e=[...k,s];f(h.id,c,e)}}if(o){let e=o.name,t=JSON.parse(o.arguments||"{}"),r=m.find(t=>{var s;return null===(s=t.tools)||void 0===s?void 0:s.some(t=>(0,el.nJ)(t.name)===e)}),n=null==r?void 0:null===(j=r.tools)||void 0===j?void 0:j.find(t=>(0,el.nJ)(t.name)===e);if(!r||!n)throw Error("No server found for tool ".concat(e));let a={type:"tool_use",id:"tool_use_".concat(Date.now()),name:n.name,input:t};1==s.content.length&&"text"===s.content[0].type&&""===s.content[0].text?s.content=[a]:s.content.push(a),f(h.id,c,[...k,s]);let l=null==h?void 0:h.conversations.find(e=>e.id===c);if(l&&3===k.length&&"(New Chat)"===l.name){let e=k[0].content,t=k[1].content,s=await b.chat.completions.create({model:h.settings.model||"gpt-4",messages:[{role:"user",content:"Generate a concise, specific title (3-4 words max) that accurately captures the main topic or purpose of this conversation. Use key technical terms when relevant. Avoid generic words like 'conversation', 'chat', or 'help'.\n\nUser message: ".concat(JSON.stringify(e),"\nAssistant response: ").concat(Array.isArray(t)?t.filter(e=>"text"===e.type).map(e=>"text"===e.type?e.text:"").join(" "):t,"\n\nFormat: Only output the title, no quotes or explanation")}],max_tokens:20});if(s.choices[0].message.content){let e=s.choices[0].message.content.replace(/["']/g,"").replace(/title:?\s*/i,"").trim();e&&u(h.id,c,e)}}try{let e=await p(r.id,n.name,t),o={role:"user",content:[{type:"tool_result",tool_use_id:a.id,content:e}],timestamp:new Date};k.push(s),k.push(o),f(h.id,c,k)}catch(r){let e={role:"user",content:[{type:"tool_result",tool_use_id:a.id,content:"Error: ".concat(r instanceof Error?r.message:"Unknown error"),is_error:!0}],timestamp:new Date},t=[...k,s,e];f(h.id,c,t)}}else{k.push(s),f(h.id,c,k);let e=null==h?void 0:h.conversations.find(e=>e.id===c);if(e&&3===k.length&&"(New Chat)"===e.name){let e=k[0].content,t=k[1].content,s=await b.chat.completions.create({model:h.settings.model||"gpt-4",messages:[{role:"user",content:"Generate a concise, specific title (3-4 words max) that accurately captures the main topic or purpose of this conversation. Use key technical terms when relevant. Avoid generic words like 'conversation', 'chat', or 'help'.\n\nUser message: ".concat(JSON.stringify(e),"\nAssistant response: ").concat(Array.isArray(t)?t.filter(e=>"text"===e.type).map(e=>"text"===e.type?e.text:"").join(" "):t,"\n\nFormat: Only output the title, no quotes or explanation")}],max_tokens:20});if(s.choices[0].message.content){let e=s.choices[0].message.content.replace(/["']/g,"").replace(/title:?\s*/i,"").trim();e&&u(h.id,c,e)}}break}}catch(e){console.error("OpenAI API error:",e),r("OpenAI API error: ".concat(e instanceof Error?e.message:"Unknown error")),t(!1),eo.release();return}}else if("anthropic"===h.settings.provider){let t=(0,el.HG)(e,R),r=await P({model:h.settings.model||ei,max_tokens:8192,messages:t.messages,...t.system&&{system:t.system},..._&&_.length>0&&{system:_},...S.length>0&&{tools:A}});if(r.on("text",e=>{n.text+=e;let t=[...k,s];f(h.id,c,t)}),o.current=r,a.current)break;let l=await r.finalMessage(),i=l.content.map(e=>e.type&&"text"===e.type&&0===e.text.trim().length&&1===l.content.length?{...e,text:"empty"}:e).filter(e=>{if(!e.type||"text"!==e.type)return!0;let t=0===e.text.trim().length;return t&&1===l.content.length?(console.log("got unexpected whitespace case from assistant: ".concat(JSON.stringify(l))),e.text="empty",!0):!t}),d={...l,content:i};k.push(d),f(h.id,c,k);let x=null==h?void 0:h.conversations.find(e=>e.id===c);if(x&&2===k.length&&"(New Chat)"===x.name){let e=k[0].content,t=k[1].content,s=await C.messages.create({model:h.settings.model||ei,max_tokens:20,messages:[{role:"user",content:"Generate a concise, specific title (3-4 words max) that accurately captures the main topic or purpose of this conversation. Use key technical terms when relevant. Avoid generic words like 'conversation', 'chat', or 'help'.\n\nUser message: ".concat(JSON.stringify(e),"\nAssistant response: ").concat(Array.isArray(t)?t.filter(e=>"text"===e.type).map(e=>"text"===e.type?e.text:"").join(" "):t,"\n\nFormat: Only output the title, no quotes or explanation")}]});if("text"===s.content[0].type){let e=s.content[0].text.replace(/["']/g,"").replace(/title:?\s*/i,"").trim();e&&u(h.id,c,e)}}let g=l.content.find(e=>"tool_use"===e.type);if(g&&"tool_use"===g.type)try{if(a.current)break;let e=m.find(e=>{var t;return null===(t=e.tools)||void 0===t?void 0:t.some(e=>e.name===g.name)});if(!e)throw Error("No server found for tool ".concat(g.name));let t=await p(e.id,g.name,g.input);if(a.current)break;let s={role:"user",content:[{type:"tool_result",tool_use_id:g.id,content:"string"==typeof t?t:JSON.stringify(t)}],timestamp:new Date};if(k.push(s),f(h.id,c,k),!a.current)continue;break}catch(t){let e={role:"user",content:[{type:"tool_result",tool_use_id:g.id,content:"Error: ".concat(t instanceof Error?t.message:"Unknown error"),is_error:!0}],timestamp:new Date};k.push(e),f(h.id,c,k)}if(!g)break}else{t(!1),eo.release();return}if(a.current)break}}catch(e){console.error("Failed to send message:",e),e instanceof Error&&"Request was aborted."===e.message?console.log("Request was cancelled by user"):"object"==typeof e&&null!==e&&((null===(b=e.error)||void 0===b?void 0:b.type)==="overloaded_error"||429===e.status)?(console.error("Server overloaded, all retries failed:",e),a.current||r("Server is currently overloaded. Message sending failed after multiple retries. Please try again later.")):a.current||r(e instanceof Error?e.message:"An error occurred")}finally{a.current=!1,t(!1),o.current=null,await eo.release()}},cancelCurrentCall:(0,n.useCallback)(()=>{a.current=!0,o.current&&o.current.abort(),t(!1),r("Operation cancelled")},[])}};var ed=s(8640),eu=s.n(ed);let em=e=>{let{messages:t}=e,s=(0,n.useRef)(null),[r,a]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{(async()=>{for(;!s.current;)await new Promise(e=>setTimeout(e,250));let e=s.current;0===e.scrollTop&&(e.scrollTop=e.scrollHeight);let t=eu()(()=>{let{scrollTop:t,scrollHeight:s,clientHeight:r}=e;a(e.scrollHeight<e.clientHeight||50>Math.abs(s-r-t))},100);return t(),e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)})()},[]),(0,n.useEffect)(()=>{if(!s.current||!t.length)return;let e=t[t.length-1],n=t.length<=1;("assistant"===e.role||"user"===e.role)&&(r||n)&&requestAnimationFrame(()=>{let e=s.current;e&&(e.scrollTop=e.scrollHeight)})},[t,r]),{chatContainerRef:s,isAtBottom:r,scrollToBottom:()=>{let e=s.current;e&&(e.scrollTop=e.scrollHeight)}}},ep=n.forwardRef((e,t)=>{var s,a;let[o,l]=(0,n.useState)([]),[i,c]=(0,n.useState)(""),[d,u]=(0,n.useState)(null),{projects:m,activeProjectId:p,activeConversationId:h,updateProjectSettings:x}=(0,y.P)(),f=m.find(e=>e.id===p),g=null==f?void 0:f.conversations.find(e=>e.id===h),b=null==g?void 0:g.messages.length,w=(0,n.useMemo)(()=>{var e;if(!(null==g?void 0:g.messages))return[];if(null==f?void 0:f.settings.showAllMessages)return g.messages;let t=null!==(e=null==f?void 0:f.settings.messageWindowSize)&&void 0!==e?e:30,s=g.messages.slice(b?b-t:0,b);return b&&b>t?[{role:"assistant",content:[{type:"text",text:"_Showing last ".concat(t,' messages. Enable "History" to see all ').concat(b," messages._")}],timestamp:new Date},...s]:s},[null==g?void 0:g.messages,null==f?void 0:f.settings.showAllMessages,null==f?void 0:f.settings.messageWindowSize,b]),N=(0,n.useRef)(null);j();let{isLoading:k,error:C,handleSendMessage:A,cancelCurrentCall:S}=ec(),{chatContainerRef:R,isAtBottom:_,scrollToBottom:P}=em({messages:(null==g?void 0:g.messages)||[]});(0,n.useImperativeHandle)(t,()=>({focus:()=>{N.current&&N.current.focus()}}),[]);let I=(e,t)=>{let s=null==g?void 0:g.messages[e+1],r=null;if(s&&Array.isArray(s.content)){let e=s.content.find(e=>"tool_result"===e.type&&e.tool_use_id===t);e&&"tool_result"===e.type&&(r=e.content)}return r},z=(e,t)=>Array.isArray(e.content)?e.content.map((s,n)=>(0,r.jsx)(K,{content:s,isUserMessage:"user"===e.role,onToolClick:(e,t,s)=>{u({name:e,input:t,result:s})},toolResult:Array.isArray(e.content)&&"object"==typeof e.content[n]&&"type"in e.content[n]&&"tool_use"===e.content[n].type?I(t,e.content[n].id):null,contentIndex:n,messageIndex:t},"".concat(s.type,"-").concat(t,"-").concat(n))):(0,r.jsx)(K,{content:{type:"text",text:e.content},isUserMessage:"user"===e.role,onToolClick:()=>{},toolResult:null,contentIndex:0,messageIndex:t},"string-".concat(t));if(!g)return(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsx)(v,{})});let T=async()=>{await A(i,o),c(""),l([])};return(0,r.jsxs)("div",{className:"flex flex-col h-full relative",children:[(0,r.jsx)("div",{ref:R,className:"h-[calc(100vh-4rem)] overflow-y-auto p-4",children:(0,r.jsx)("div",{className:"space-y-4 mb-4",children:null==w?void 0:w.map((e,t)=>z(e,t))})}),(0,r.jsx)($,{onClick:P,visible:!_}),(0,r.jsx)(es,{checked:null!==(a=null==f?void 0:f.settings.showAllMessages)&&void 0!==a&&a,onChange:e=>{f&&x(f.id,{settings:{...f.settings,showAllMessages:e}})}}),C&&(0,r.jsx)("div",{className:"px-4 py-2 text-sm text-red-500",children:C}),(0,r.jsxs)("div",{className:"flex flex-col gap-2 p-2 bg-background fixed bottom-0 left-0 right-0 z-50 md:left-[280px] md:w-[calc(100%-280px)]",children:[(0,r.jsx)(F,{files:o,onRemove:e=>{l(t=>t.filter((t,s)=>s!==e))}}),(0,r.jsx)(Y,{value:i,onChange:c,onSend:T,isLoading:k,onStop:S,isDisabled:!p||!h,onFileSelect:e=>{l(t=>[...t,{...e}])},placeholder:(null==f?void 0:null===(s=f.settings.apiKey)||void 0===s?void 0:s.trim())?k?"Processing response...":"Type your message":"⚠️ Set your API key in Settings to start chatting"})]}),d&&(0,r.jsx)(E,{toolCall:d,onClose:()=>u(null)})]})});ep.displayName="ChatView";let eh=n.memo(ep);var ex=s(9632),ef=s(1675),eg=s(6967),ev=s(3565);let ey=ef.bL,ej=ef.l9;ef.YJ,ef.ZL,ef.Pb,ef.z6,n.forwardRef((e,t)=>{let{className:s,inset:n,children:a,...o}=e;return(0,r.jsxs)(ef.ZP,{ref:t,className:i("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",n&&"pl-8",s),...o,children:[a,(0,r.jsx)(eg.A,{className:"ml-auto h-4 w-4"})]})}).displayName=ef.ZP.displayName,n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(ef.G5,{ref:t,className:i("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in data-[side=bottom]:slide-in-from-top-1 data-[side=left]:slide-in-from-right-1 data-[side=right]:slide-in-from-left-1 data-[side=top]:slide-in-from-bottom-1",s),...n})}).displayName=ef.G5.displayName;let eb=n.forwardRef((e,t)=>{let{className:s,sideOffset:n=4,...a}=e;return(0,r.jsx)(ef.ZL,{children:(0,r.jsx)(ef.UC,{ref:t,sideOffset:n,className:i("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a})})});eb.displayName=ef.UC.displayName;let ew=n.forwardRef((e,t)=>{let{className:s,inset:n,...a}=e;return(0,r.jsx)(ef.q7,{ref:t,className:i("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n&&"pl-8",s),...a})});ew.displayName=ef.q7.displayName,n.forwardRef((e,t)=>{let{className:s,children:n,checked:a,...o}=e;return(0,r.jsxs)(ef.H_,{ref:t,className:i("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:a,...o,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(ef.VF,{children:(0,r.jsx)(M.A,{className:"h-4 w-4"})})}),n]})}).displayName=ef.H_.displayName,n.forwardRef((e,t)=>{let{className:s,children:n,...a}=e;return(0,r.jsxs)(ef.hN,{ref:t,className:i("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(ef.VF,{children:(0,r.jsx)(ev.A,{className:"h-2 w-2 fill-current"})})}),n]})}).displayName=ef.hN.displayName,n.forwardRef((e,t)=>{let{className:s,inset:n,...a}=e;return(0,r.jsx)(ef.JU,{ref:t,className:i("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",s),...a})}).displayName=ef.JU.displayName,n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(ef.wv,{ref:t,className:i("-mx-1 my-1 h-px bg-muted",s),...n})}).displayName=ef.wv.displayName;var eN=s(5686),ek=s(7780);let eC=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:i("rounded-lg border bg-card text-card-foreground shadow-sm",s),...n})});eC.displayName="Card";let eA=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:i("flex flex-col space-y-1.5 p-6",s),...n})});eA.displayName="CardHeader";let eS=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("h3",{ref:t,className:i("text-lg font-semibold leading-none tracking-tight",s),...n})});eS.displayName="CardTitle";let eR=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("p",{ref:t,className:i("text-sm text-muted-foreground",s),...n})});eR.displayName="CardDescription";let e_=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:i("p-6 pt-0",s),...n})});e_.displayName="CardContent",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:i(" flex items-center p-6 pt-0",s),...n})}).displayName="CardFooter";let eP=n.forwardRef((e,t)=>{let{className:s,type:n,...a}=e;return(0,r.jsx)("input",{type:n,className:i("flex h-10 w-full rounded-md border border-input bg-transparent px-3 py-2 text-[16px] ring-offset-background file:border-0 file:bg-transparent file:text-[16px] file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...a})});eP.displayName="Input";var eI=s(3572);let eE=eI.bL;eI.l9;let ez=eI.ZL,eT=n.forwardRef(function(e,t){return(0,r.jsx)(eI.hJ,{className:i("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e.className),...e,ref:t})}),eD=n.forwardRef(function(e,t){return(0,r.jsxs)(ez,{children:[(0,r.jsx)(eT,{}),(0,r.jsx)(eI.UC,{ref:t,className:i("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e.className),...e})]})}),eM=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:i("flex flex-col space-y-2 text-center sm:text-left",t),...s})},eO=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:i("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})},eU=n.forwardRef(function(e,t){return(0,r.jsx)(eI.hE,{ref:t,className:i("text-lg font-semibold",e.className),...e})}),eK=n.forwardRef(function(e,t){return(0,r.jsx)(eI.VY,{ref:t,className:i("text-sm text-muted-foreground",e.className),...e})}),eF=n.forwardRef(function(e,t){return(0,r.jsx)(eI.rc,{ref:t,className:i(f(),e.className),autoFocus:e.autoFocus,...e})}),eq=n.forwardRef(function(e,t){return(0,r.jsx)(eI.ZD,{ref:t,className:i(f({variant:"outline"}),"mt-2 sm:mt-0",e.className),...e})});var eL=s(6714);let eH=(0,x.F)("relative w-full rounded-lg border p-4 [&>svg]:absolute [&>svg]:text-foreground [&>svg]:left-4 [&>svg]:top-4 [&>svg+div]:translate-y-[-3px] [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"text-destructive border-destructive/50 dark:border-destructive [&>svg]:text-destructive text-destructive"}},defaultVariants:{variant:"default"}}),eG=n.forwardRef((e,t)=>{let{className:s,variant:n,...a}=e;return(0,r.jsx)("div",{ref:t,role:"alert",className:i(eH({variant:n}),s),...a})});eG.displayName="Alert",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("h5",{ref:t,className:i("mb-1 font-medium leading-none tracking-tight",s),...n})}).displayName="AlertTitle";let eJ=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:i("text-sm [&_p]:leading-relaxed",s),...n})});eJ.displayName="AlertDescription";var eB=s(1773);let eW=e=>{let{serverIds:t=[],onServerIdsChange:s}=e,[a,o]=(0,n.useState)({name:"",uri:""}),{addServer:l,removeServer:i,reconnectServer:c,servers:d}=(0,y.P)(),u=async()=>{let e={id:Math.random().toString(36).substring(7),name:a.name,uri:a.uri,status:"connecting"};try{if(await l(e)){let r=Array.isArray(t)?[...t,e.id]:[e.id];s(r)}}catch(e){console.error("Failed to connect to server:",e)}o({name:"",uri:""})},m=e=>{i(e),s(t.filter(t=>t!==e))},p=e=>{switch(e){case"connected":return"text-green-500";case"connecting":return"text-yellow-500";case"error":return"text-red-500";default:return"text-gray-500"}};return(0,r.jsx)(eC,{children:(0,r.jsxs)(e_,{className:"p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-4",children:"WebSocket MCP Servers"}),(0,r.jsx)("div",{className:"space-y-3 mb-4",children:Array.isArray(t)&&t.map(e=>{let t=d.find(t=>t.id===e);return t?(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"font-medium",children:t.name}),(0,r.jsxs)("span",{className:"text-sm ".concat(p(t.status)),children:["(",t.status,")"]})]}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:t.uri}),t.error&&(0,r.jsx)("div",{className:"text-sm text-red-500 mt-1",children:t.error})]}),(0,r.jsxs)("div",{className:"flex gap-2 ml-2",children:["connected"!==t.status&&(0,r.jsx)(g,{variant:"ghost",size:"sm",onClick:()=>c(t.id),children:(0,r.jsx)(eB.A,{className:"h-4 w-4"})}),(0,r.jsx)(g,{variant:"ghost",size:"sm",onClick:()=>m(t.id),children:(0,r.jsx)(eN.A,{className:"h-4 w-4"})})]})]},t.id):null})}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(eP,{placeholder:"Server name",value:a.name,onChange:e=>o({...a,name:e.target.value}),className:"mb-2"}),(0,r.jsx)(eP,{placeholder:"WebSocket URI (e.g. ws://localhost:3000)",value:a.uri,onChange:e=>o({...a,uri:e.target.value})})]}),(0,r.jsx)(g,{onClick:u,disabled:!a.name||!a.uri,className:"w-full",children:"Add Server"})]}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(eG,{children:(0,r.jsx)(eJ,{children:"Connect to WebSocket MCP servers to extend Claude's capabilities with custom tools. Each server should implement the MCP protocol."})})})]})})};var eV=s(994);let eQ=()=>{let{servers:e}=(0,y.P)(),[t,s]=(0,n.useState)({});return(0,r.jsxs)("div",{className:"space-y-4 p-4",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Available Tools"}),0===e.length?(0,r.jsx)(eG,{children:(0,r.jsx)(eJ,{children:"No MCP servers connected. Tools will appear here when servers connect."})}):e.map(e=>(0,r.jsxs)(eC,{className:"mb-4",children:[(0,r.jsxs)(eA,{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(eV.A,{className:"h-5 w-5 ".concat("connected"===e.status?"text-green-500":"connecting"===e.status?"text-yellow-500":"text-red-500")}),(0,r.jsx)(eS,{children:e.name})]}),(0,r.jsxs)(eR,{children:[e.uri," - ",e.status,e.error&&(0,r.jsxs)("span",{className:"text-red-500",children:[" (",e.error,")"]})]})]}),(0,r.jsx)(e_,{children:e.tools&&0!==e.tools.length?(0,r.jsx)("div",{className:"space-y-4",children:e.tools.map(e=>(0,r.jsxs)("div",{className:"border rounded-lg",children:[(0,r.jsx)("button",{onClick:()=>{s(t=>({...t,[e.name]:!t[e.name]}))},className:"w-full p-4 flex items-center justify-between hover:bg-muted/50 transition-colors",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(eg.A,{className:"h-4 w-4 transition-transform ".concat(t[e.name]?"transform rotate-90":"")}),(0,r.jsx)("h3",{className:"font-semibold",children:e.name})]})}),t[e.name]&&(0,r.jsxs)("div",{className:"px-4 pb-4",children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:e.description}),e.input_schema&&(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("h4",{className:"text-sm font-medium mb-1",children:"Input Schema:"}),(0,r.jsx)("pre",{className:"text-xs bg-muted p-2 rounded overflow-x-auto",children:JSON.stringify(e.input_schema,null,2)})]})]})]},e.name))}):(0,r.jsx)("p",{className:"text-muted-foreground",children:"No tools available from this server"})})]},e.id))]})};var eZ=s(7725),eY=s(2104),eX=s(7113);function e$(){let{setTheme:e}=(0,eX.D)();return(0,r.jsxs)(ey,{children:[(0,r.jsx)(ej,{asChild:!0,children:(0,r.jsxs)(g,{variant:"outline",size:"icon",className:"h-10 w-10 rounded-full shadow-lg bg-background/80 backdrop-blur-sm hover:bg-background/90",children:[(0,r.jsx)(eZ.A,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),(0,r.jsx)(eY.A,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),(0,r.jsx)("span",{className:"sr-only",children:"Toggle theme"})]})}),(0,r.jsxs)(eb,{align:"end",children:[(0,r.jsx)(ew,{onClick:()=>e("light"),children:"Light"}),(0,r.jsx)(ew,{onClick:()=>e("dark"),children:"Dark"}),(0,r.jsx)(ew,{onClick:()=>e("system"),children:"System"})]})]})}let e0=()=>{var e,t,s,a,o,l;let{projects:i,activeProjectId:m,updateProjectSettings:p,servers:h}=(0,y.P)(),[x,f]=(0,n.useState)(!1),[v,j]=(0,n.useState)("config"),[b,w]=(0,n.useState)(!1),[k,C]=(0,n.useState)(""),P=i.find(e=>e.id===m);if((0,n.useEffect)(()=>{if(!P)return;let e=P.settings.mcpServerIds||[],t=h.filter(e=>"connected"===e.status).map(e=>e.id);e.every(e=>t.includes(e))&&t.every(t=>e.includes(t))||I({mcpServerIds:t})},[m,h]),!P)return(0,r.jsx)("div",{className:"text-center text-muted-foreground",children:"Select a project to configure settings"});let I=e=>{console.log("handleSettingsChange - settings received:",e),void 0!==e.provider&&e.provider!==P.settings.provider?p(P.id,{settings:{...P.settings,...e,anthropicApiKey:P.settings.anthropicApiKey||P.settings.apiKey,openRouterApiKey:P.settings.openRouterApiKey||"",apiKey:"anthropic"===e.provider&&P.settings.anthropicApiKey||P.settings.apiKey,model:(0,y.p)(e.provider)}}):p(P.id,{settings:{...P.settings,...e}})};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"fixed right-4 bottom-4 z-50",children:(0,r.jsx)(e$,{})}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(c,{value:v,onValueChange:j,children:(0,r.jsxs)(d,{children:[(0,r.jsx)(u,{value:"config",children:"Configuration"}),(0,r.jsx)(u,{value:"tools",children:"Tools"})]})})}),"tools"===v?(0,r.jsx)(eQ,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eC,{children:(0,r.jsxs)(e_,{className:"p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-4",children:"API Settings"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Provider"}),(0,r.jsxs)("select",{value:null!==(a=P.settings.provider)&&void 0!==a?a:"anthropic",onChange:e=>I({provider:e.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[(0,r.jsx)("option",{value:"anthropic",children:"Anthropic (Claude)"}),(0,r.jsx)("option",{value:"openrouter",children:"OpenRouter"}),(0,r.jsx)("option",{value:"openai",children:"OpenAI"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["API Key ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Required to chat. Get yours at"," ",(()=>{switch(P.settings.provider){case"openrouter":return(0,r.jsx)("a",{href:"https://openrouter.ai/keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"openrouter.ai"});case"openai":return(0,r.jsx)("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"platform.openai.com"});default:return(0,r.jsx)("a",{href:"https://console.anthropic.com/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"console.anthropic.com"})}})()]}),(0,r.jsx)(eP,{type:"password",value:"openrouter"===P.settings.provider?P.settings.openRouterApiKey||"":"openai"===P.settings.provider?P.settings.openaiApiKey||"":P.settings.anthropicApiKey||P.settings.apiKey||"",onChange:e=>{let t=e.target.value.trim();switch(P.settings.provider){case"openrouter":I({openRouterApiKey:t});break;case"openai":I({openaiApiKey:t});break;default:I({anthropicApiKey:t,apiKey:t})}},placeholder:"openai"===P.settings.provider?"⚠️ Enter your OpenAI API key to use the chat":"openrouter"===P.settings.provider?"⚠️ Enter your OpenRouter API key to use the chat":"⚠️ Enter your Anthropic API key to use the chat",className:"openrouter"===P.settings.provider?"":(null===(e=P.settings.anthropicApiKey)||void 0===e?void 0:e.trim())||(null===(t=P.settings.apiKey)||void 0===t?void 0:t.trim())?"":"border-red-500 dark:border-red-400 placeholder:text-red-500/90 dark:placeholder:text-red-400/90 placeholder:font-medium"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"GROQ API Key"}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Required for voice transcription. Get yours at"," ",(0,r.jsx)("a",{href:"https://console.groq.com/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"console.groq.com"})]}),(0,r.jsx)(eP,{type:"password",value:P.settings.groqApiKey||"",onChange:e=>{I({groqApiKey:e.target.value.trim()})},placeholder:"Enter your GROQ API key for voice transcription"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Model"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("select",{value:"__CUSTOM__"!==P.settings.model&&(0,eL.SM)(P.settings.provider||"anthropic").includes(P.settings.model||"")?P.settings.model:"custom",onChange:e=>{console.log("Model dropdown onChange event:",e.target.value),"custom"===e.target.value?I({model:"__CUSTOM__"}):I({model:e.target.value})},className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[(0,eL.SM)(P.settings.provider||"anthropic").map(e=>(0,r.jsx)("option",{value:e,children:e},e)),(0,r.jsx)("option",{value:"custom",children:"Custom"})]}),("__CUSTOM__"===P.settings.model||!(0,eL.SM)(P.settings.provider||"anthropic").includes(P.settings.model||""))&&(0,r.jsx)(eP,{value:"__CUSTOM__"===P.settings.model?"":P.settings.model||"",onChange:e=>{I({model:e.target.value||"__CUSTOM__"})},placeholder:"Enter custom model name",className:"w-full"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,r.jsx)("label",{className:"block text-sm font-medium",children:"System Prompt"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(null===(s=P.settings.savedPrompts)||void 0===s?void 0:s.length)?(0,r.jsxs)(ey,{children:[(0,r.jsx)(ej,{asChild:!0,children:(0,r.jsxs)(g,{variant:"outline",size:"sm",children:["Load Prompt ",(0,r.jsx)(X.A,{className:"ml-2 h-4 w-4"})]})}),(0,r.jsx)(eb,{children:P.settings.savedPrompts.map(e=>(0,r.jsxs)(ew,{className:"flex justify-between items-center",children:[(0,r.jsx)("div",{onClick:()=>I({systemPrompt:e.content}),className:"flex-grow cursor-pointer",children:e.name}),(0,r.jsx)(g,{variant:"ghost",size:"icon",className:"h-4 w-4 ml-2 hover:text-destructive",onClick:t=>{var s;t.stopPropagation(),I({savedPrompts:(null===(s=P.settings.savedPrompts)||void 0===s?void 0:s.filter(t=>t.id!==e.id))||[]})},children:(0,r.jsx)(eN.A,{className:"h-3 w-3"})})]},e.id))})]}):null,(0,r.jsxs)(g,{variant:"outline",size:"sm",onClick:()=>{C(""),w(!0)},children:[(0,r.jsx)(ek.A,{className:"mr-2 h-4 w-4"}),"Save Prompt"]})]})]}),(0,r.jsx)(q,{value:P.settings.systemPrompt,onChange:e=>I({systemPrompt:e.target.value}),placeholder:"Enter a system prompt...",className:"min-h-[100px]"})]}),(0,r.jsx)(N,{open:b,onOpenChange:w,children:(0,r.jsx)(A,{children:(0,r.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),k.trim()){let e={id:crypto.randomUUID(),name:k.trim(),content:P.settings.systemPrompt,createdAt:new Date};I({savedPrompts:[...P.settings.savedPrompts||[],e]}),w(!1)}},children:[(0,r.jsx)(S,{children:(0,r.jsx)(_,{children:"Save System Prompt"})}),(0,r.jsxs)("div",{className:"py-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Name your prompt"}),(0,r.jsx)(eP,{value:k,onChange:e=>C(e.target.value),placeholder:"Enter a name for this prompt",autoFocus:!0})]}),(0,r.jsxs)(R,{children:[(0,r.jsx)(g,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancel"}),(0,r.jsx)(g,{type:"submit",children:"Save"})]})]})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Message Window Size"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Number of messages to show when History is disabled"}),(0,r.jsx)(eP,{type:"number",value:null!==(o=P.settings.messageWindowSize)&&void 0!==o?o:30,onChange:e=>{let t=parseInt(e.target.value);!isNaN(t)&&t>0&&I({messageWindowSize:t})},min:"1",className:"w-32"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("input",{type:"checkbox",id:"elideToolResults",checked:null!==(l=P.settings.elideToolResults)&&void 0!==l&&l,onChange:e=>I({elideToolResults:e.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),(0,r.jsx)("label",{htmlFor:"elideToolResults",className:"text-sm font-medium",children:"Use Claude to elide tool results from previous messages"})]})]})]})}),(0,r.jsx)(eW,{serverIds:P.settings.mcpServerIds||[],onServerIdsChange:e=>I({mcpServerIds:e})}),(0,r.jsx)(eC,{className:"mt-6",children:(0,r.jsxs)(e_,{className:"p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Advanced Settings"}),(0,r.jsxs)("div",{className:"text-xs text-muted-foreground mb-4",children:["Database Version: ",ex.G8]}),(0,r.jsx)(g,{variant:"destructive",onClick:()=>f(!0),children:"Reset state"}),(0,r.jsx)(eE,{open:x,onOpenChange:f,children:(0,r.jsxs)(eD,{children:[(0,r.jsxs)(eM,{children:[(0,r.jsx)(eU,{children:"Reset Application State"}),(0,r.jsx)(eK,{children:"Are you sure you want to reset the application state? This will delete all projects, conversations, and settings. This action cannot be undone."})]}),(0,r.jsxs)(eO,{children:[(0,r.jsx)(eq,{children:"Cancel"}),(0,r.jsx)(eF,{onClick:async()=>{let e=async()=>Promise.all((await window.indexedDB.databases()).map(e=>new Promise((t,s)=>{let r=window.indexedDB.deleteDatabase(e.name);r.onsuccess=()=>t(),r.onerror=()=>s(r.error)})));try{await e(),window.location.reload()}catch(e){console.error("Error clearing databases:",e)}},children:"Reset"})]})]})})]})})]})]})};var e1=s(4024),e2=s(4857),e4=s(2060),e5=s(872);let e3=e=>{let{onExportConversation:t,isMobileMenuOpen:s=!0,onMobileMenuToggle:a,onConversationSelect:o}=e,{projects:l,activeProjectId:i,activeConversationId:c,createProject:d,deleteProject:u,createConversation:m,deleteConversation:h,renameConversation:x,renameProject:f,setActiveProject:v,setActiveConversation:j}=(0,y.P)(),[b,w]=(0,n.useState)(new Set),[k,C]=(0,n.useState)(!1);(0,n.useEffect)(()=>{i&&w(e=>{let t=new Set(e);return t.add(i),t})},[i]);let[P,I]=(0,n.useState)(!1),[E,z]=(0,n.useState)(null),[T,D]=(0,n.useState)(null),[M,O]=(0,n.useState)(""),U=e=>{w(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[K]=(0,n.useState)({}),F=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=l.find(t=>t.id===e);if(null==s?void 0:s.conversations){if(t&&0===s.conversations.length)m(e);else if(s.conversations.length>0){let t=K[e];t&&s.conversations.some(e=>e.id===t)?j(t):j(s.conversations[0].id)}v(e)}};(0,n.useEffect)(()=>{i&&c&&(K[i]=c)},[i,c]);let q=[...l].sort((e,t)=>(e.order||0)-(t.order||0));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g,{variant:"secondary",size:"icon",className:"fixed left-4 top-4 z-[100] md:hidden rounded-full shadow-lg hover:shadow-xl bg-background",onClick:a,"aria-label":"Toggle mobile menu",children:(0,r.jsx)(p.A,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{className:"\n        fixed inset-y-0 left-0\n        md:sticky md:top-0 md:left-auto\n        w-[280px] max-w-[85vw]\n        bg-background border-r\n        transition-transform duration-200 ease-in-out\n        ".concat(s?"translate-x-0":"-translate-x-full","\n        md:translate-x-0\n        z-40\n        flex flex-col\n        h-screen\n      "),children:[(0,r.jsxs)("div",{className:"flex gap-2 mb-2 p-4 pt-16 md:pt-4",children:[(0,r.jsxs)(g,{onClick:()=>{d("New Project")},className:"flex-1",variant:"outline",children:[(0,r.jsx)(e1.A,{className:"w-4 h-4 mr-2"}),"New Project"]}),(0,r.jsx)(g,{onClick:()=>i&&t(i),variant:"outline",disabled:!i,children:(0,r.jsx)(e2.A,{className:"w-4 h-4"})})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0 px-4",children:q.map((e,t)=>(0,r.jsxs)("div",{className:"mb-2 ".concat(t>0?"mt-2 pt-2 border-t border-accent/35":""),children:[(0,r.jsxs)("div",{className:"p-2 rounded-lg flex items-center gap-2 transition-colors cursor-pointer\n                ".concat(e.id===i?"bg-accent text-accent-foreground":"hover:bg-muted","\n                text-sm font-medium"),onClick:t=>{t.stopPropagation(),U(e.id),e.id!==i&&(F(e.id,!0),null==a||a())},children:[(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),t.preventDefault(),U(e.id)},className:"p-1 hover:bg-muted-foreground/10 rounded",children:b.has(e.id)?(0,r.jsx)(X.A,{className:"w-4 h-4"}):(0,r.jsx)(eg.A,{className:"w-4 h-4"})}),(0,r.jsx)("span",{className:"truncate flex-1",title:e.name,children:e.name}),(0,r.jsx)(g,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:t=>{t.stopPropagation(),v(e.id),m(e.id),w(t=>{let s=new Set(t);return s.add(e.id),s}),null==o||o(),null==a||a()},title:"New chat",children:(0,r.jsx)(e4.A,{className:"w-4 h-4 opacity-100 transition-all duration-200 hover:scale-125 hover:opacity-75"})}),(0,r.jsx)(g,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:t=>{t.stopPropagation(),D({type:"project",projectId:e.id,currentName:e.name}),O(e.name),I(!0)},children:(0,r.jsx)(e5.A,{className:"w-4 h-4 opacity-100 transition-all duration-200 hover:scale-125 hover:opacity-75"})}),(0,r.jsx)(g,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:t=>{t.stopPropagation(),z({type:"project",projectId:e.id}),C(!0)},children:(0,r.jsx)(eN.A,{className:"w-4 h-4 text-destructive opacity-100 transition-all duration-200 hover:scale-125 hover:opacity-75"})})]}),b.has(e.id)&&(0,r.jsx)("div",{className:"ml-4 mt-1 space-y-1",children:e.conversations.sort((e,t)=>{let s=e=>e?e instanceof Date?e.getTime():new Date(e).getTime():Date.now(),r=s(e.createdAt||e.lastUpdated);return s(t.createdAt||t.lastUpdated)-r}).map(t=>(0,r.jsxs)("div",{className:"p-2 rounded-lg cursor-pointer flex items-center gap-2 transition-colors\n                      ".concat(t.id===c?"bg-accent text-accent-foreground":"hover:bg-muted","\n                      text-xs truncate max-w-[250px]"),onClick:()=>{F(e.id),j(t.id),null==o||o(),null==a||a()},children:[(0,r.jsx)("span",{className:"truncate flex-1",title:t.name,children:t.name}),(0,r.jsx)(g,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:s=>{s.stopPropagation(),D({type:"conversation",projectId:e.id,conversationId:t.id,currentName:t.name}),O(t.name),I(!0)},children:(0,r.jsx)(e5.A,{className:"w-4 h-4 opacity-100 transition-opacity duration-200 hover:opacity-75"})}),(0,r.jsx)(g,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:s=>{s.stopPropagation(),z({type:"conversation",projectId:e.id,conversationId:t.id}),C(!0)},children:(0,r.jsx)(eN.A,{className:"w-4 h-4 text-destructive opacity-100 transition-opacity duration-200 hover:opacity-75"})})]},t.id))})]},e.id))}),(0,r.jsx)(eE,{open:k,onOpenChange:C,children:(0,r.jsxs)(eD,{children:[(0,r.jsxs)(eM,{children:[(0,r.jsxs)(eU,{children:["Delete ",(null==E?void 0:E.type)==="project"?"Project":"Conversation"]}),(0,r.jsxs)(eK,{children:["Are you sure you want to delete this ",null==E?void 0:E.type,"? This action cannot be undone.",(null==E?void 0:E.type)==="project"&&" All conversations in this project will be deleted."]})]}),(0,r.jsxs)(eO,{children:[(0,r.jsx)(eq,{onClick:()=>C(!1),children:"Cancel"}),(0,r.jsx)(eF,{onClick:()=>{E&&("project"===E.type?u(E.projectId):E.conversationId&&h(E.projectId,E.conversationId),C(!1),z(null))},autoFocus:!0,children:"Delete"})]})]})}),(0,r.jsx)(N,{open:P,onOpenChange:I,children:(0,r.jsx)(A,{children:(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),T&&M.trim()&&("project"===T.type?f(T.projectId,M.trim()):T.conversationId&&x(T.projectId,T.conversationId,M.trim()),I(!1),D(null),O(""))},children:[(0,r.jsx)(S,{children:(0,r.jsxs)(_,{children:["Rename ",(null==T?void 0:T.type)==="project"?"Project":"Conversation"]})}),(0,r.jsx)(eP,{value:M,onChange:e=>O(e.target.value),placeholder:"Enter new name",className:"my-4"}),(0,r.jsxs)(R,{children:[(0,r.jsx)(g,{type:"button",variant:"outline",onClick:()=>{I(!1),D(null),O("")},children:"Cancel"}),(0,r.jsx)(g,{type:"submit",variant:"default",children:"Save"})]})]})})})]})]})},e6=()=>{let[e,t]=(0,n.useState)(!1),[s,a]=(0,n.useState)("chat"),o=(0,n.useRef)(null);return n.useEffect(()=>{t(window.innerWidth>=768)},[]),(0,r.jsxs)("div",{className:"min-h-screen bg-background text-foreground flex relative overflow-x-hidden",children:[e&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 md:hidden z-40 backdrop-blur-sm transition-opacity duration-200",onClick:()=>t(!1)}),(0,r.jsx)(e3,{onExportConversation:(e,t)=>{console.log("Export",{projectId:e,conversationId:t})},isMobileMenuOpen:e,onMobileMenuToggle:()=>t(!e),onConversationSelect:()=>a("chat")}),(0,r.jsx)(g,{variant:"outline",size:"icon",className:"fixed left-4 top-4 z-50 md:hidden shadow-lg ".concat(e?"hidden":"flex"," w-9 h-9 rounded-full"),onClick:()=>t(!0),children:(0,r.jsx)(p.A,{className:"w-4 h-4"})}),(0,r.jsxs)("div",{className:"flex-1 relative",children:[(0,r.jsx)("div",{className:"absolute right-4 top-4 z-50 flex items-center gap-4 transition-opacity duration-200\n              ".concat(e?"opacity-100":"md:opacity-100 opacity-0 pointer-events-none md:pointer-events-auto"),children:(0,r.jsx)(c,{value:s,onValueChange:e=>{a(e),window.innerWidth<768&&t(!1),"chat"===e&&setTimeout(()=>{var e;null===(e=o.current)||void 0===e||e.focus()},0)},children:(0,r.jsx)("div",{className:"flex items-center gap-4 bg-background/80 backdrop-blur-sm rounded-lg shadow-lg p-1",children:(0,r.jsxs)(d,{className:"bg-transparent",children:[(0,r.jsx)(u,{value:"chat",children:"Chat"}),(0,r.jsx)(u,{value:"settings",children:"Settings"})]})})})}),(0,r.jsx)("div",{className:"flex flex-col h-full",children:(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"settings"===s?"hidden":"",children:(0,r.jsx)(c,{value:s,children:(0,r.jsx)(m,{value:"chat",forceMount:!0,children:(0,r.jsx)(eh,{ref:o})})})}),(0,r.jsx)("div",{className:"chat"===s?"hidden":"",children:(0,r.jsx)(c,{value:s,children:(0,r.jsx)(m,{value:"settings",forceMount:!0,children:(0,r.jsx)(e0,{})})})})]})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[850,950,441,517,358],()=>t(4352)),_N_E=e.O()}]);