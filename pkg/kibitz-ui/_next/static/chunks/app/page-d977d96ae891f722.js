(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4352:(e,t,r)=>{Promise.resolve().then(r.bind(r,4696))},4696:(e,t,r)=>{"use strict";r.d(t,{default:()=>eM});var s=r(5155),a=r(2115),n=r(8629),o=r(3463),l=r(9795);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,l.QP)((0,o.$)(t))}let c=n.bL,d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(n.B8,{ref:t,className:i("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...a})});d.displayName=n.B8.displayName;let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(n.l9,{ref:t,className:i("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...a})});u.displayName=n.l9.displayName;let p=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(n.UC,{ref:t,className:i("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...a})});p.displayName=n.UC.displayName;var m=r(6710),h=r(2317),f=r(1027);let x=(0,f.F)("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background",{variants:{variant:{default:"bg-primary/90 text-primary-foreground hover:bg-primary/60",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"underline-offset-4 hover:underline text-primary"},size:{default:"h-10 py-2 px-4",sm:"h-9 px-3 rounded-md",lg:"h-11 px-8 rounded-md",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),g=a.forwardRef((e,t)=>{let{className:r,variant:a,size:n,asChild:o=!1,...l}=e,c=o?h.DX:"button";return(0,s.jsx)(c,{className:i(x({variant:a,size:n,className:r})),ref:t,...l})});g.displayName="Button";var v=r(5565),y=r(4521),b=r(1719),j=r(767),w=r(1406),N=r(8283),k=r(3608);let A=["image/jpeg","image/png","image/gif","image/webp"],C=["application/pdf"],R=["applications/javascript","application/typescript","application/x-httpd-php","application/x-sh","application/x-powershell","application/json","application/xml","application/yaml","application/toml","application/x-tex","application/sql","application/x-python","application/x-ruby","application/x-diff","application/x-patch","application/typescript","application/x-properties"],_=e=>{let{onFileSelect:t,onUploadComplete:r}=e,n=(0,a.useRef)(null),o=(0,a.useCallback)(async e=>{if(!(A.includes(e.type)||C.includes(e.type)||e.type.startsWith("text/")||R.includes(e.type))){alert("Unsupported file type. Please upload an image (JPEG, PNG, GIF, WebP), a PDF, or a plaintext document.");return}let s=new FileReader;s.onload=async()=>{let a=s.result.split(",")[1];if(e.type.startsWith("text/")||R.includes(e.type)){t({type:"text",text:function(e){try{let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return new TextDecoder("utf-8").decode(r)}catch(e){throw Error("Failed to decode base64 string: "+e.message)}}(a)}),null==r||r();return}A.includes(e.type)?(t({type:"image",source:{type:"base64",media_type:e.type,data:a},fileName:e.name}),null==r||r()):"application/pdf"===e.type&&(t({type:"document",source:{type:"base64",media_type:"application/pdf",data:a},fileName:e.name}),null==r||r())},s.readAsDataURL(e)},[t,r]),l=(0,a.useCallback)(async e=>{for(let t of Array.from(e.target.files||[]))await o(t)},[o]),i=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation()},[]),c=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer&&Array.from(e.dataTransfer.files).forEach(o)},[o]);return a.useEffect(()=>{let e=document.querySelector("textarea");return e&&(e.addEventListener("dragover",i),e.addEventListener("drop",c)),()=>{e&&(e.removeEventListener("dragover",i),e.removeEventListener("drop",c))}},[i,c]),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"file",ref:n,onChange:l,accept:[...A,...C].join(","),className:"hidden",multiple:!0}),(0,s.jsx)(g,{onClick:()=>{var e;null===(e=n.current)||void 0===e||e.click()},variant:"ghost",size:"icon",className:"h-7 w-7",title:"Upload files (Images or PDFs)",children:(0,s.jsx)(k.A,{className:"h-4 w-4"})})]})};var S=r(8867),P=r(7341);let E=e=>{let{text:t,className:r=""}=e,[n,o]=(0,a.useState)(!1),l=async e=>{e.preventDefault(),e.stopPropagation();try{await navigator.clipboard.writeText(t),o(!0),setTimeout(()=>o(!1),2e3)}catch(e){console.error("Failed to copy text:",e)}};return(0,s.jsxs)("button",{onClick:l,className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-sm hover:bg-kinode-orange/10 ".concat(r),children:[n?(0,s.jsx)(S.A,{className:"h-4 w-4"}):(0,s.jsx)(P.A,{className:"h-4 w-4"}),n?"Copied":"Copy"]})},T=a.forwardRef((e,t)=>{let{className:r,maxRows:n=8,onChange:o,...l}=e,c=a.useRef(null),d=a.useCallback(e=>{let t=c.current;if(t&&(t.style.height="2.5em",t.scrollHeight>t.clientHeight)){let e=Math.min(t.scrollHeight,n*parseInt(getComputedStyle(t).lineHeight));t.style.height="".concat(e,"px")}null==o||o(e)},[n,o]);return a.useEffect(()=>{c.current&&(c.current.style.height="2.5em",c.current.style.lineHeight="1em")},[]),(0,s.jsx)("textarea",{className:i("flex h-[2.5em] w-full rounded-md border border-input bg-transparent px-3 py-2 text-[16px] ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 overflow-y-auto resize-none transition-height duration-150",r),ref:e=>{c.current=e,"function"==typeof t?t(e):t&&(t.current=e)},onChange:d,...l})});T.displayName="Textarea";let I=(0,f.F)("relative w-full rounded-lg border p-4 [&>svg]:absolute [&>svg]:text-foreground [&>svg]:left-4 [&>svg]:top-4 [&>svg+div]:translate-y-[-3px] [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"text-destructive border-destructive/50 dark:border-destructive [&>svg]:text-destructive text-destructive"}},defaultVariants:{variant:"default"}}),z=a.forwardRef((e,t)=>{let{className:r,variant:a,...n}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:i(I({variant:a}),r),...n})});z.displayName="Alert",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h5",{ref:t,className:i("mb-1 font-medium leading-none tracking-tight",r),...a})}).displayName="AlertTitle";let D=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:i("text-sm [&_p]:leading-relaxed",r),...a})});D.displayName="AlertDescription";var O=r(3550),K=r(6246);class F{async acquire(){if(this.isSupported)try{this.wakeLock=await navigator.wakeLock.request("screen"),console.log("Screen wake lock acquired")}catch(e){console.warn("Failed to acquire wake lock:",e)}}async release(){if(this.wakeLock)try{await this.wakeLock.release(),this.wakeLock=null,console.log("Screen wake lock released")}catch(e){console.warn("Failed to release wake lock:",e)}}isActive(){return null!==this.wakeLock}constructor(){this.wakeLock=null,this.isSupported=!1,this.isSupported="undefined"!=typeof navigator&&"wakeLock"in navigator&&/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase())}}let q=new F;var L=r(6217);let U=L.bL;L.l9;let M=L.ZL,H=a.forwardRef(function(e,t){return(0,s.jsx)(L.hJ,{ref:t,className:i("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e.className),...e})}),B=a.forwardRef(function(e,t){return(0,s.jsxs)(M,{children:[(0,s.jsx)(H,{}),(0,s.jsxs)(L.UC,{ref:t,className:i("fixed left-[50%] top-[50%] z-50 grid w-full translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg","max-w-[90%] sm:max-w-[85%] md:max-w-[80%] lg:max-w-[75%]","max-h-[85vh] overflow-y-auto",e.className),...e,children:[e.children,(0,s.jsxs)(L.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(j.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}),G=e=>{let{className:t,...r}=e;return(0,s.jsx)("div",{className:i("flex flex-col space-y-1.5 text-center sm:text-left",t),...r})},J=e=>{let{className:t,...r}=e;return(0,s.jsx)("div",{className:i("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r})},Y=a.forwardRef(function(e,t){return(0,s.jsx)(L.hE,{ref:t,className:i("text-lg font-semibold leading-none tracking-tight",e.className),...e})});var V=r(314),Z=r(4504);let Q=e=>{let{toolCall:t,onClose:r}=e,[n,o]=(0,a.useState)(!1);return(0,s.jsx)(U,{open:!0,onOpenChange:r,children:(0,s.jsxs)(B,{children:[(0,s.jsx)(G,{className:"mb-4 shrink-0",children:(0,s.jsxs)("div",{className:"flex justify-between items-center gap-4",children:[(0,s.jsx)(Y,{className:"truncate",children:"Tool Call: ".concat(t.name)}),(0,s.jsx)(g,{variant:"ghost",size:"icon",onClick:()=>o(!n),children:n?(0,s.jsx)(V.A,{className:"h-4 w-4"}):(0,s.jsx)(Z.A,{className:"h-4 w-4"})})]})}),(0,s.jsxs)("div",{className:i("space-y-4 overflow-hidden flex-grow",n?"overflow-y-auto pr-2":"max-h-[240px] sm:max-h-[280px]"),children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium mb-2",children:"Input:"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("pre",{className:i("bg-muted p-2 sm:p-4 rounded-md whitespace-pre-wrap break-all text-sm sm:text-base",!n&&"max-h-[100px] sm:max-h-[120px] overflow-hidden"),children:JSON.stringify(t.input,null,2)}),!n&&(0,s.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-muted to-transparent pointer-events-none"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium mb-2",children:"Result:"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("pre",{className:i("bg-muted p-2 sm:p-4 rounded-md whitespace-pre-wrap break-all text-sm sm:text-base",!n&&"max-h-[100px] sm:max-h-[120px] overflow-hidden"),children:t.result||"No result available"}),!n&&(0,s.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-muted to-transparent pointer-events-none"})]})]})]})]})})};var W=r(9434),X=r(6164);let $=()=>(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-[3px] border-current/30 border-t-current"}),ee=e=>{let{onTranscriptionComplete:t}=e,[r,n]=(0,a.useState)(!1),[o,l]=(0,a.useState)(!1),i=(0,a.useRef)(null),c=(0,a.useRef)([]),{projects:d,activeProjectId:u}=(0,W.P)(),p=d.find(e=>e.id===u),m=(0,a.useRef)(null),h=(0,a.useRef)(null),f=(0,a.useRef)(null),x=(0,a.useRef)(null),v=async e=>{e.preventDefault(),e.stopPropagation(),r?b():await y()},y=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new AudioContext,r=t.createAnalyser();t.createMediaStreamSource(e).connect(r),r.fftSize=128,r.smoothingTimeConstant=.8,f.current=r,x.current=t;let s=new MediaRecorder(e);i.current=s,c.current=[],s.ondataavailable=e=>{e.data.size>0&&c.current.push(e.data)},s.onstop=async()=>{let t=new Blob(c.current,{type:"audio/webm"});l(!0),await N(t),l(!1),e.getTracks().forEach(e=>e.stop())},s.start(),n(!0)}catch(e){console.error("Error accessing microphone:",e),alert("Error accessing microphone. Please ensure microphone permissions are granted.")}},b=()=>{i.current&&r&&(i.current.stop(),n(!1),x.current&&x.current.close(),h.current&&cancelAnimationFrame(h.current))},j=a.useCallback(()=>{if(!m.current)return;let e=m.current,t=window.devicePixelRatio||1,r=e.getBoundingClientRect();e.width=r.width*t,e.height=r.height*t;let s=e.getContext("2d");s&&s.scale(t,t)},[]),w=a.useCallback(()=>{if(!f.current||!m.current)return;let e=m.current,t=e.getContext("2d");if(!t)return;let s=e.getBoundingClientRect(),a=f.current.frequencyBinCount,n=new Uint8Array(a),o=[];for(let e=0;e<=255;e+=8){let t=e/255;o.push("rgba(59, 130, 246, ".concat(t,")"))}let l=0,i=()=>{var c;if(!r)return;let d=performance.now();if(d-l<33.333333333333336){h.current=requestAnimationFrame(i);return}l=d,null===(c=f.current)||void 0===c||c.getByteFrequencyData(n);let u=window.devicePixelRatio||1;t.clearRect(0,0,e.width,e.height);let p=s.width,m=s.height,x=p/32*.8,g=0;for(let e=0;e<32;e++){let r=Math.floor(e/32*(a/4)),s=n[r]/255*m,l=Math.floor(n[r]/255*(o.length-1));t.fillStyle=o[l],t.fillRect(g*u,(m-s)*u,x*u,s*u),g+=x+2}};i()},[r]);(0,a.useEffect)(()=>{let e;return r&&(j(),w(),e=new ResizeObserver(()=>{j()}),m.current&&e.observe(m.current),h.current=requestAnimationFrame(function e(){w(),r&&(h.current=requestAnimationFrame(e))})),()=>{h.current&&cancelAnimationFrame(h.current),e&&e.disconnect()}},[r,w,j]);let N=async e=>{if(!(null==p?void 0:p.settings.groqApiKey)){alert("Please set your GROQ API key in settings first");return}let r=new FormData;r.append("file",e,"recording.webm"),r.append("model","whisper-large-v3");try{let e=await fetch("https://api.groq.com/openai/v1/audio/transcriptions",{method:"POST",headers:{Authorization:"Bearer ".concat(p.settings.groqApiKey)},body:r});if(!e.ok)throw Error("Error transcribing audio: ".concat(e.statusText));let s=await e.json();s.text&&t(s.text)}catch(e){console.error("Error transcribing audio:",e),l(!1),alert("Error transcribing audio. Please check your GROQ API key and try again.")}};return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)(g,{variant:"ghost",size:"icon",className:"h-7 w-7 ".concat(r?"text-red-500":""," hover:bg-accent hover:text-accent-foreground"),onClick:v,disabled:!(null==p?void 0:p.settings.groqApiKey)||o,title:(null==p?void 0:p.settings.groqApiKey)?r?"Stop Recording":"Start Recording":"Set GROQ API key in settings to enable voice recording",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(X.A,{className:"h-4 w-4"}),o&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsx)($,{})})]})}),(0,s.jsx)(U,{open:r,onOpenChange:e=>{!e&&r&&b()},children:(0,s.jsxs)(B,{children:[(0,s.jsxs)(G,{className:"pb-2",children:[(0,s.jsx)(Y,{className:"sr-only",children:"Voice Recording in Progress"}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Listening"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Tap anywhere to transcribe"})]})]}),(0,s.jsx)("div",{className:"mt-2",onClick:b,children:(0,s.jsx)("canvas",{ref:m,className:"w-full h-24 sm:h-32 bg-background border rounded-md",style:{touchAction:"none"}})})]})})]})})},et=()=>{let{projects:e,activeProjectId:t,createConversation:r,setActiveConversation:s,activeConversationId:n}=(0,W.P)(),o=e.find(e=>e.id===t),l=(0,a.useCallback)(t=>{let a=e.find(e=>e.id===t);if(!a)return;if(0===a.conversations.length){r(t);return}let n=a.conversations[a.conversations.length-1];if(0===n.messages.length){s(n.id);return}r(t)},[e,r,s]);return(0,a.useEffect)(()=>{if(t&&!n){let a=e.find(e=>e.id===t);if(a){if(0===a.conversations.length)r(t);else{let e=a.conversations[a.conversations.length-1];0===e.messages.length?s(e.id):r(t)}}}},[t,n,e,r,s]),{handleProjectFocus:l,activeProject:o}};var er=r(8640),es=r.n(er);let ea="claude-3-5-sonnet-20241022",en=a.forwardRef((e,t)=>{var r,n,o;let[l,i]=(0,a.useState)([]),[c,d]=(0,a.useState)(!0),{projects:u,activeProjectId:p,activeConversationId:m,updateProjectSettings:h,renameConversation:f,servers:x,executeTool:k}=(0,W.P)(),A=u.find(e=>e.id===p),C=null==A?void 0:A.conversations.find(e=>e.id===m),[R,S]=(0,a.useState)(""),[P,I]=(0,a.useState)(!1),[F,L]=(0,a.useState)(null),U=(0,a.useRef)(!1),M=(0,a.useRef)(null),H=(0,a.useRef)(null),B=(0,a.useRef)(null),[G,J]=(0,a.useState)(null);et(),(0,a.useImperativeHandle)(t,()=>({focus:()=>{B.current&&B.current.focus()}}),[]),(0,a.useEffect)(()=>{B.current&&C&&B.current.focus()},[C]);let Y=e=>new Promise(t=>setTimeout(t,e));(0,a.useEffect)(()=>{(async()=>{for(;!H.current;)console.log("no chatContainerRef"),await Y(250);console.log("got chatContainerRef");let e=H.current;0===e.scrollTop&&(e.scrollTop=e.scrollHeight);let t=es()(()=>{let{scrollTop:t,scrollHeight:r,clientHeight:s}=e;d(e.scrollHeight<e.clientHeight||50>Math.abs(r-s-t))},100);return t(),e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)})()},[]),(0,a.useEffect)(()=>{if(!H.current||!(null==C?void 0:C.messages.length))return;let e=C.messages[C.messages.length-1],t=C.messages.length<=1;("assistant"===e.role||"user"===e.role)&&(c||t)&&requestAnimationFrame(()=>{let e=H.current;e&&(e.scrollTop=e.scrollHeight)})},[null==C?void 0:C.messages,null==C?void 0:C.lastUpdated,c]);let V=(0,a.useCallback)(()=>{let e=H.current;e&&(e.scrollTop=e.scrollHeight)},[]),Z=e=>{var t;if(!(null==A?void 0:null===(t=A.settings.mcpServerIds)||void 0===t?void 0:t.length))return[];let r=new Map;x.filter(e=>A.settings.mcpServerIds.includes(e.id)).flatMap(e=>e.tools||[]).forEach(e=>{r.has(e.name)||r.set(e.name,{name:e.name,description:e.description,input_schema:e.input_schema})});let s=Array.from(r.values());return e?s.map((e,t,r)=>t!=r.length-1?e:{...e,cache_control:{type:"ephemeral"}}):s},X=(e,t,r)=>{let s=null==A?void 0:A.conversations.find(e=>e.id===t);s&&h(e,{conversations:A.conversations.map(e=>e.id===t?{...s,messages:r,lastUpdated:new Date}:e)})},er=(0,a.useCallback)(()=>{U.current=!0,M.current&&M.current.abort(),I(!1),L("Operation cancelled")},[]),en=async()=>{var e,t;if(U.current=!1,!R.trim()&&0===l.length||!A||!m)return;L(null),I(!0);let r="openrouter"===A.settings.provider?A.settings.openRouterApiKey:A.settings.anthropicApiKey||A.settings.apiKey;if(!(null==r?void 0:r.trim())){L("API key not found. Please set your ".concat("openrouter"===A.settings.provider?"OpenRouter":"Anthropic"," API key in the Settings panel.")),I(!1);return}B.current&&(B.current.style.height="2.5em"),await q.acquire();try{let t=l.map(e=>(e.type,{...e,fileName:void 0}));R.trim()&&t.push({type:"text",text:R});let r={role:"user",content:t,timestamp:new Date},s=[...(null==C?void 0:C.messages)||[],r];X(A.id,m,s),S(""),i([]);let a=new y.NB({apiKey:A.settings.anthropicApiKey||A.settings.apiKey||"",dangerouslyAllowBrowser:!0,maxRetries:12}),n=new Set,o=Z(!0),c=Z(!1),d=null===(e=A.settings.systemPrompt)||void 0===e?void 0:e.trim(),u=d?[{type:"text",text:d}]:void 0;for(;;){let e=s.filter((e,t,r)=>{if("string"==typeof e.content)return!0;let s=e.content;if(!s.some(e=>"tool_use"===e.type))return!0;let a=r[t+1];if(!a||"string"==typeof a.content)return!1;let n=a.content;return s.every(e=>{if("tool_use"!==e.type||!("id"in e))return!0;let t=e.id;return n.some(e=>"tool_result"===e.type&&"tool_use_id"in e&&e.tool_use_id===t)})}).map((e,t,r)=>t<r.length-3?{role:e.role,content:e.content,toolInput:e.toolInput?e.toolInput:void 0}:{role:e.role,content:"string"==typeof e.content?[{type:"text",text:e.content,cache_control:{type:"ephemeral"}}]:e.content.map((e,t,r)=>t!=r.length-1?e:{...e,cache_control:{type:"ephemeral"}}),toolInput:e.toolInput?e.toolInput:void 0}),t=s.filter(e=>Array.isArray(e.content)).flatMap(e=>e.content).filter(e=>"tool_use_id"in e&&"tool_result"===e.type).map(e=>e.tool_use_id).pop();if(A.settings.elideToolResults&&"tool_result"===e[e.length-1].content[0].type){let t=await a.messages.create({model:ea,max_tokens:8192,messages:[...e.filter(e=>!!Array.isArray(e.content)&&e.content.find(e=>"tool_use"===e.type||"tool_result"===e.type)).map(e=>e.content.find(e=>"tool_result"===e.type)?{...e,content:[{type:"text",text:"".concat(JSON.stringify({...e.content[0],content:"elided"}))}]}:{...e,content:[e.content[0],{type:"text",text:"".concat(JSON.stringify(e.content[1]))}]}),{role:"user",content:[{type:"text",text:"Rate each `message`: will the `type: tool_result` be required by `assistant` to serve the next response? Reply ONLY with `<tool_use_id>: Yes` or `<tool_use_id>: No` for each tool_result. DO NOT reply with code, prose, or commentary of any kind.\nExample output:\ntoolu_014huykAonadokihkrboFfqn: Yes\ntoolu_01APhxfkQZ1nT7Ayt8Vtyuz8: Yes\ntoolu_01PcgSwHbHinNrn3kdFaD82w: No\ntoolu_018Qosa8PHAZjUa312TXRwou: Yes",cache_control:{type:"ephemeral"}}]}],system:[{type:"text",text:"Rate each `message`: will the `type: tool_result` be required by `assistant` to serve the next response? Reply ONLY with `<tool_use_id>: Yes` or `<tool_use_id>: No` for each tool_result. DO NOT reply with code, prose, or commentary of any kind.\nExample output:\ntoolu_014huykAonadokihkrboFfqn: Yes\ntoolu_01APhxfkQZ1nT7Ayt8Vtyuz8: Yes\ntoolu_01PcgSwHbHinNrn3kdFaD82w: No\ntoolu_018Qosa8PHAZjUa312TXRwou: Yes",cache_control:{type:"ephemeral"}}]});if("text"===t.content[0].type)for(let e of(console.log("a"),t.content[0].text.split("\n"))){let[t,r]=e.split(": ");"Yes"===r.trim()?(console.log("b"),n.add(t)):"No"===r.trim()&&(console.log("c"),n.delete(t))}console.log("keepToolResponse: ".concat(JSON.stringify(t),"\n").concat(JSON.stringify(n)))}let r=A.settings.elideToolResults?e.map(e=>{if(!Array.isArray(e.content))return e;let r=e.content.find(e=>"tool_result"===e.type);if(!r)return e;let s=r.tool_use_id;return s===t||n.has(s)?e:{...e,content:[{...e.content[0],content:"elided"}]}}):e,l={role:"assistant",content:[],timestamp:new Date},i={type:"text",text:""};l.content.push(i);let d=async e=>{let t;for(let s=0;s<12;s++)try{return await a.messages.stream(e)}catch(e){if(t=e,"object"==typeof e&&null!==e){var r;if(((null===(r=e.error)||void 0===r?void 0:r.type)==="overloaded_error"||429===e.status)&&s<11){await new Promise(e=>setTimeout(e,5e3));continue}}throw e}throw t},p=await d({model:A.settings.model||ea,max_tokens:8192,messages:r,...u&&u.length>0&&{system:u},...c.length>0&&{tools:o}});if(M.current=p,U.current)break;p.on("text",e=>{i.text+=e;let t=[...s,l];X(A.id,m,t)});let h=await p.finalMessage(),g=h.content.map(e=>e.type&&"text"===e.type&&0===e.text.trim().length&&1===h.content.length?{...e,text:"empty"}:e).filter(e=>{if(!e.type||"text"!==e.type)return!0;let t=0===e.text.trim().length;return t&&1===h.content.length?(console.log("got unexpected whitespace case from assistant: ".concat(JSON.stringify(h))),e.text="empty",!0):!t}),v={...h,content:g};s.push(v),X(A.id,m,s);let y=null==A?void 0:A.conversations.find(e=>e.id===m);if(y&&2===s.length&&"(New Chat)"===y.name){let e=null==A?void 0:A.conversations.find(e=>e.id===m);if((null==e?void 0:e.name)!=="(New Chat)"){console.log("Title already changed, skipping generation");return}let t=s[0].content,r=s[1].content,n=await a.messages.create({model:A.settings.model||ea,max_tokens:20,messages:[{role:"user",content:"Generate a concise, specific title (3-4 words max) that accurately captures the main topic or purpose of this conversation. Use key technical terms when relevant. Avoid generic words like 'conversation', 'chat', or 'help'.\n\nUser message: ".concat(JSON.stringify(t),"\nAssistant response: ").concat(Array.isArray(r)?r.filter(e=>"text"===e.type).map(e=>"text"===e.type?e.text:"").join(" "):r,"\n\nFormat: Only output the title, no quotes or explanation\nExample good titles:\n- React Router Setup\n- Python Script Optimization\n- Database Schema Design\n- ML Model Training\n- Docker Container Networking")}]}),o=n.content[0].type;if("text"==o){let e=n.content[0].text.replace(/["']/g,"").replace("title:","").replace("Title:","").replace("title","").replace("Title","").trim();e&&f(A.id,m,e)}}let b=h.content.find(e=>"tool_use"===e.type);if(b&&"tool_use"===b.type)try{if(U.current)break;let e=x.find(e=>{var t;return null===(t=e.tools)||void 0===t?void 0:t.some(e=>e.name===b.name)});if(!e)throw Error("No server found for tool ".concat(b.name));let t=await k(e.id,b.name,b.input);if(U.current)break;let r={role:"user",content:[{type:"tool_result",tool_use_id:b.id,content:t}],timestamp:new Date};if(s.push(r),X(A.id,m,s),!U.current)continue;break}catch(t){let e={role:"user",content:[{type:"tool_result",tool_use_id:b.id,content:"Error: ".concat(t instanceof Error?t.message:"Unknown error"),is_error:!0}],timestamp:new Date};s.push(e),X(A.id,m,s)}if(U.current||!b)break}}catch(e){e&&"object"==typeof e&&"message"in e&&"Request was aborted."===e.message?console.log("Request was cancelled by user"):"object"==typeof e&&null!==e&&((null===(t=e.error)||void 0===t?void 0:t.type)==="overloaded_error"||429===e.status)?(console.error("Server overloaded, all retries failed:",e),U.current||L("Server is currently overloaded. Message sending failed after multiple retries. Please try again later.")):(console.error("Failed to send message:",e),U.current||L(e instanceof Error?e.message:"An error occurred"))}finally{U.current=!1,I(!1),M.current=null,await q.release(),B.current&&(B.current.focus(),B.current.style.height="2.5em")}},eo=(e,t)=>Array.isArray(e.content)?e.content.map((r,a)=>{if("text"===r.type)return(0,s.jsx)("div",{className:"flex max-w-full pt-6",children:(0,s.jsxs)("div",{className:"relative group w-full max-w-full overflow-x-auto",children:[!r.text.match(/```[\s\S]*```/)&&(0,s.jsx)("div",{className:"absolute right-2 top-0 z-10",children:(0,s.jsx)(E,{text:r.text.trim(),className:"opacity-0 group-hover:opacity-100 transition-opacity"})}),(0,s.jsx)("div",{className:"w-full max-w-full rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-accent !text-accent-foreground":"bg-muted text-foreground"),children:(0,s.jsx)(O.o,{className:"prose dark:prose-invert break-words max-w-full ".concat("user"===e.role?"[&_p]:!text-accent-foreground [&_code]:!text-accent-foreground":""),components:{p:e=>{let{children:t}=e;return(0,s.jsx)("p",{className:"break-words whitespace-pre-wrap overflow-hidden",children:t})},pre(e){let{children:t,...r}=e,a=e=>{if("string"==typeof e)return e;if(!e)return"";if(Array.isArray(e))return e.map(a).join("\n");if("object"==typeof e&&null!==e&&"props"in e){var t,r,s;if((null===(r=e.props)||void 0===r?void 0:null===(t=r.className)||void 0===t?void 0:t.includes("language-"))||(null===(s=e.props)||void 0===s?void 0:s.children))return a(e.props.children)}return""},n=a(t).trim();return(0,s.jsxs)("div",{className:"group/code relative max-w-full",children:[(0,s.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,s.jsx)(E,{text:n,className:"opacity-0 group-hover/code:opacity-100 transition-opacity"})}),(0,s.jsx)("pre",{className:"overflow-x-auto max-w-full whitespace-pre",...r,children:t})]})},code(e){let{inline:t,children:r,...a}=e;return t?(0,s.jsx)("code",{className:"text-inherit whitespace-nowrap inline",...a,children:r}):(0,s.jsx)("code",{className:"block overflow-x-auto whitespace-pre-wrap",...a,children:r})},a:e=>{let{href:t,children:r}=e;return(0,s.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:r})}},remarkPlugins:[K.A],children:r.text})})]})},"text-".concat(t,"-").concat(a));if("image"===r.type)return(0,s.jsx)("div",{className:"flex",children:(0,s.jsx)("div",{className:"w-full rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,s.jsx)(v.default,{src:"data:".concat(r.source.media_type,";base64,").concat(r.source.data),alt:"User uploaded image",className:"max-h-[150px] max-w-[300px] w-auto h-auto rounded object-contain",width:300,height:150})})},"image-".concat(t,"-").concat(a));if("document"===r.type)return(0,s.jsx)("div",{className:"flex",children:(0,s.jsx)("div",{className:"w-full rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,s.jsx)("embed",{src:"data:".concat(r.source.media_type,";base64,").concat(r.source.data),type:r.source.media_type,width:"100%",height:"600px",className:"rounded"})})},"document-".concat(t,"-").concat(a));if("tool_use"===r.type){let n=null==C?void 0:C.messages[t+1],o=null;if(n&&Array.isArray(n.content)){let e=n.content.find(e=>"tool_result"===e.type&&e.tool_use_id===r.id);e&&"tool_result"===e.type&&(o=e.content)}return(0,s.jsx)("div",{className:"flex",children:(0,s.jsx)("div",{className:"w-full rounded-lg px-4 py-2 relative group ".concat("user"===e.role?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,s.jsxs)("button",{onClick:()=>J({name:r.name,input:r.input,result:o}),className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 underline",children:["Use tool: ",r.name]})},"message-".concat(t,"-content-").concat(a))},"tool_use-".concat(t,"-").concat(a))}return null}):(0,s.jsx)("div",{className:"flex",children:(0,s.jsx)("div",{className:"w-full rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,s.jsx)(O.o,{className:"prose dark:prose-invert break-words overflow-hidden whitespace-pre-wrap max-w-full",components:{a:e=>{let{href:t,children:r}=e;return(0,s.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:r})}},remarkPlugins:[K.A],children:e.content})})},"string-".concat(t));return C?(0,s.jsxs)("div",{className:"flex flex-col h-full relative",children:[(0,s.jsx)("div",{ref:H,className:"h-[calc(100vh-4rem)] overflow-y-auto p-4",children:(0,s.jsx)("div",{className:"space-y-4 mb-4",children:C.messages.map((e,t)=>eo(e,t))})}),!c&&(0,s.jsx)("button",{onClick:V,className:"fixed bottom-[60px] right-2 md:right-8 z-[100] bg-primary/70 text-primary-foreground rounded-full p-3 shadow-lg hover:bg-primary/90 transition-all hover:scale-110 animate-in fade-in slide-in-from-right-2","aria-label":"Scroll to bottom",children:(0,s.jsx)(b.A,{className:"w-6 h-6"})}),F&&(0,s.jsx)("div",{className:"px-4 py-2 text-sm text-red-500",children:F}),(null==A?void 0:A.settings.provider)==="openrouter"&&(0,s.jsx)("div",{className:"px-4",children:(0,s.jsx)(z,{children:(0,s.jsx)(D,{children:"OpenRouter support is coming soon. Please switch to Anthropic provider in settings to chat."})})}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 p-2 bg-background fixed bottom-0 left-0 right-0 z-50 md:left-[280px] md:w-[calc(100%-280px)]",children:[l.length>0&&(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:l.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-muted rounded px-2 py-1",children:[(0,s.jsx)("span",{className:"text-sm",children:"text"===e.type?"Text file":e.fileName||"Untitled"}),(0,s.jsx)("button",{onClick:()=>{i(e=>e.filter((e,r)=>r!==t))},className:"hover:text-destructive",children:(0,s.jsx)(j.A,{className:"h-4 w-4"})})]},t))}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)("div",{className:"relative flex-1",children:[(0,s.jsx)(T,{value:R,onChange:e=>S(e.target.value),placeholder:(null==A?void 0:A.settings.provider)==="openrouter"?"⚠️ OpenRouter support coming soon":(null==A?void 0:null===(r=A.settings.apiKey)||void 0===r?void 0:r.trim())?P?"Processing response...":"Type your message":"⚠️ Set your API key in Settings to start chatting",onKeyDown:e=>{let t=window.matchMedia("(max-width: 768px)").matches;"Enter"!==e.key||e.shiftKey||P||t||(e.preventDefault(),en())},ref:B,className:"pr-20 ".concat((null==A?void 0:null===(n=A.settings.apiKey)||void 0===n?void 0:n.trim())?"":"placeholder:text-red-500/90 dark:placeholder:text-red-400/90 placeholder:font-medium"),maxRows:8,disabled:P||!(null==A?void 0:null===(o=A.settings.apiKey)||void 0===o?void 0:o.trim())||(null==A?void 0:A.settings.provider)==="openrouter"}),(0,s.jsxs)("div",{className:"absolute right-2 bottom-2 flex gap-1",children:[(0,s.jsx)(_,{onFileSelect:e=>{i(t=>[...t,{...e}])},onUploadComplete:()=>{B.current&&B.current.focus()}}),(0,s.jsx)(ee,{onTranscriptionComplete:e=>{S(t=>t.trim()?"".concat(t,"\n").concat(e):e)}})]})]}),(0,s.jsx)(g,{onClick:P?er:en,disabled:!p||!m||(null==A?void 0:A.settings.provider)==="openrouter",className:"self-end relative",children:P?(0,s.jsx)(w.A,{className:"w-4 h-4"}):(0,s.jsx)(N.A,{className:"w-4 h-4"})})]})]}),G&&(0,s.jsx)(Q,{toolCall:G,onClose:()=>J(null)})]}):(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,s.jsx)($,{})})});en.displayName="ChatView";let eo=a.memo(en),el=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:i("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});el.displayName="Card",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:i("flex flex-col space-y-1.5 p-6",r),...a})}).displayName="CardHeader",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h3",{ref:t,className:i("text-lg font-semibold leading-none tracking-tight",r),...a})}).displayName="CardTitle",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("p",{ref:t,className:i("text-sm text-muted-foreground",r),...a})}).displayName="CardDescription";let ei=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:i("p-6 pt-0",r),...a})});ei.displayName="CardContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:i(" flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter";let ec=a.forwardRef((e,t)=>{let{className:r,type:a,...n}=e;return(0,s.jsx)("input",{type:a,className:i("flex h-10 w-full rounded-md border border-input bg-transparent px-3 py-2 text-[16px] ring-offset-background file:border-0 file:bg-transparent file:text-[16px] file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...n})});ec.displayName="Input";var ed=r(3572);let eu=ed.bL;ed.l9;let ep=ed.ZL,em=a.forwardRef(function(e,t){return(0,s.jsx)(ed.hJ,{className:i("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e.className),...e,ref:t})}),eh=a.forwardRef(function(e,t){return(0,s.jsxs)(ep,{children:[(0,s.jsx)(em,{}),(0,s.jsx)(ed.UC,{ref:t,className:i("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e.className),...e})]})}),ef=e=>{let{className:t,...r}=e;return(0,s.jsx)("div",{className:i("flex flex-col space-y-2 text-center sm:text-left",t),...r})},ex=e=>{let{className:t,...r}=e;return(0,s.jsx)("div",{className:i("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r})},eg=a.forwardRef(function(e,t){return(0,s.jsx)(ed.hE,{ref:t,className:i("text-lg font-semibold",e.className),...e})}),ev=a.forwardRef(function(e,t){return(0,s.jsx)(ed.VY,{ref:t,className:i("text-sm text-muted-foreground",e.className),...e})}),ey=a.forwardRef(function(e,t){return(0,s.jsx)(ed.rc,{ref:t,className:i(x(),e.className),autoFocus:e.autoFocus,...e})}),eb=a.forwardRef(function(e,t){return(0,s.jsx)(ed.ZD,{ref:t,className:i(x({variant:"outline"}),"mt-2 sm:mt-0",e.className),...e})});var ej=r(6714),ew=r(1773),eN=r(5686);let ek=e=>{let{serverIds:t=[],onServerIdsChange:r}=e,[n,o]=(0,a.useState)({name:"",uri:""}),{addServer:l,removeServer:i,reconnectServer:c,servers:d}=(0,W.P)(),u=async()=>{let e={id:Math.random().toString(36).substring(7),name:n.name,uri:n.uri,status:"connecting"};try{if(await l(e)){let s=Array.isArray(t)?[...t,e.id]:[e.id];r(s)}}catch(e){console.error("Failed to connect to server:",e)}o({name:"",uri:""})},p=e=>{i(e),r(t.filter(t=>t!==e))},m=e=>{switch(e){case"connected":return"text-green-500";case"connecting":return"text-yellow-500";case"error":return"text-red-500";default:return"text-gray-500"}};return(0,s.jsx)(el,{children:(0,s.jsxs)(ei,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-4",children:"WebSocket MCP Servers"}),(0,s.jsx)("div",{className:"space-y-3 mb-4",children:Array.isArray(t)&&t.map(e=>{let t=d.find(t=>t.id===e);return t?(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-medium",children:t.name}),(0,s.jsxs)("span",{className:"text-sm ".concat(m(t.status)),children:["(",t.status,")"]})]}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:t.uri}),t.error&&(0,s.jsx)("div",{className:"text-sm text-red-500 mt-1",children:t.error})]}),(0,s.jsxs)("div",{className:"flex gap-2 ml-2",children:["connected"!==t.status&&(0,s.jsx)(g,{variant:"ghost",size:"sm",onClick:()=>c(t.id),children:(0,s.jsx)(ew.A,{className:"h-4 w-4"})}),(0,s.jsx)(g,{variant:"ghost",size:"sm",onClick:()=>p(t.id),children:(0,s.jsx)(eN.A,{className:"h-4 w-4"})})]})]},t.id):null})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(ec,{placeholder:"Server name",value:n.name,onChange:e=>o({...n,name:e.target.value}),className:"mb-2"}),(0,s.jsx)(ec,{placeholder:"WebSocket URI (e.g. ws://localhost:3000)",value:n.uri,onChange:e=>o({...n,uri:e.target.value})})]}),(0,s.jsx)(g,{onClick:u,disabled:!n.name||!n.uri,className:"w-full",children:"Add Server"})]}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(z,{children:(0,s.jsx)(D,{children:"Connect to WebSocket MCP servers to extend Claude's capabilities with custom tools. Each server should implement the MCP protocol."})})})]})})};var eA=r(7725),eC=r(2104),eR=r(8321),e_=r(6967),eS=r(3565);let eP=eR.bL,eE=eR.l9;eR.YJ,eR.ZL,eR.Pb,eR.z6,a.forwardRef((e,t)=>{let{className:r,inset:a,children:n,...o}=e;return(0,s.jsxs)(eR.ZP,{ref:t,className:i("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",a&&"pl-8",r),...o,children:[n,(0,s.jsx)(e_.A,{className:"ml-auto h-4 w-4"})]})}).displayName=eR.ZP.displayName,a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(eR.G5,{ref:t,className:i("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in data-[side=bottom]:slide-in-from-top-1 data-[side=left]:slide-in-from-right-1 data-[side=right]:slide-in-from-left-1 data-[side=top]:slide-in-from-bottom-1",r),...a})}).displayName=eR.G5.displayName;let eT=a.forwardRef((e,t)=>{let{className:r,sideOffset:a=4,...n}=e;return(0,s.jsx)(eR.ZL,{children:(0,s.jsx)(eR.UC,{ref:t,sideOffset:a,className:i("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...n})})});eT.displayName=eR.UC.displayName;let eI=a.forwardRef((e,t)=>{let{className:r,inset:a,...n}=e;return(0,s.jsx)(eR.q7,{ref:t,className:i("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",r),...n})});eI.displayName=eR.q7.displayName,a.forwardRef((e,t)=>{let{className:r,children:a,checked:n,...o}=e;return(0,s.jsxs)(eR.H_,{ref:t,className:i("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),checked:n,...o,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(eR.VF,{children:(0,s.jsx)(S.A,{className:"h-4 w-4"})})}),a]})}).displayName=eR.H_.displayName,a.forwardRef((e,t)=>{let{className:r,children:a,...n}=e;return(0,s.jsxs)(eR.hN,{ref:t,className:i("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(eR.VF,{children:(0,s.jsx)(eS.A,{className:"h-2 w-2 fill-current"})})}),a]})}).displayName=eR.hN.displayName,a.forwardRef((e,t)=>{let{className:r,inset:a,...n}=e;return(0,s.jsx)(eR.JU,{ref:t,className:i("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",r),...n})}).displayName=eR.JU.displayName,a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(eR.wv,{ref:t,className:i("-mx-1 my-1 h-px bg-muted",r),...a})}).displayName=eR.wv.displayName;var ez=r(7113);function eD(){let{setTheme:e}=(0,ez.D)();return(0,s.jsxs)(eP,{children:[(0,s.jsx)(eE,{asChild:!0,children:(0,s.jsxs)(g,{variant:"outline",size:"icon",className:"h-10 w-10 rounded-full shadow-lg bg-background/80 backdrop-blur-sm hover:bg-background/90",children:[(0,s.jsx)(eA.A,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),(0,s.jsx)(eC.A,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),(0,s.jsx)("span",{className:"sr-only",children:"Toggle theme"})]})}),(0,s.jsxs)(eT,{align:"end",children:[(0,s.jsx)(eI,{onClick:()=>e("light"),children:"Light"}),(0,s.jsx)(eI,{onClick:()=>e("dark"),children:"Dark"}),(0,s.jsx)(eI,{onClick:()=>e("system"),children:"System"})]})]})}let eO=()=>{var e,t,r;let{projects:n,activeProjectId:o,updateProjectSettings:l,servers:i}=(0,W.P)(),[c,d]=(0,a.useState)(!1),u=n.find(e=>e.id===o);if((0,a.useEffect)(()=>{if(!u)return;let e=u.settings.mcpServerIds||[],t=i.filter(e=>"connected"===e.status).map(e=>e.id);e.every(e=>t.includes(e))&&t.every(t=>e.includes(t))||p({mcpServerIds:t})},[o,i]),!u)return(0,s.jsx)("div",{className:"text-center text-muted-foreground",children:"Select a project to configure settings"});let p=e=>{void 0!==e.provider&&e.provider!==u.settings.provider?l(u.id,{settings:{...u.settings,...e,anthropicApiKey:u.settings.anthropicApiKey||u.settings.apiKey,openRouterApiKey:u.settings.openRouterApiKey||"",apiKey:"anthropic"===e.provider&&u.settings.anthropicApiKey||u.settings.apiKey}}):l(u.id,{settings:{...u.settings,...e}})};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"fixed right-4 bottom-4 z-50",children:(0,s.jsx)(eD,{})}),(0,s.jsx)(el,{children:(0,s.jsxs)(ei,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-4",children:"API Settings"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Provider"}),(0,s.jsxs)("select",{value:u.settings.provider||"anthropic",onChange:e=>p({provider:e.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[(0,s.jsx)("option",{value:"anthropic",children:"Anthropic (Claude)"}),(0,s.jsx)("option",{value:"openrouter",children:"OpenRouter (Coming Soon)"}),(0,s.jsx)("option",{value:"openai",children:"OpenAI"})]})]}),("openrouter"===u.settings.provider||"openai"===u.settings.provider)&&(0,s.jsx)(z,{children:(0,s.jsx)(D,{children:"openrouter"===u.settings.provider?"OpenRouter support is coming soon. Please use Anthropic for now.":"OpenAI support is coming soon. Please use Anthropic for now."})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["API Key ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Required to chat. Get yours at"," ",(()=>{switch(u.settings.provider){case"openrouter":return(0,s.jsx)("a",{href:"https://openrouter.ai/keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"openrouter.ai"});case"openai":return(0,s.jsx)("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"platform.openai.com"});default:return(0,s.jsx)("a",{href:"https://console.anthropic.com/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"console.anthropic.com"})}})()]}),(0,s.jsx)(ec,{type:"password",value:"openrouter"===u.settings.provider?u.settings.openRouterApiKey||"":"openai"===u.settings.provider?u.settings.openaiApiKey||"":u.settings.anthropicApiKey||u.settings.apiKey||"",onChange:e=>{let t=e.target.value.trim();switch(u.settings.provider){case"openrouter":p({openRouterApiKey:t});break;case"openai":p({openaiApiKey:t});break;default:p({anthropicApiKey:t,apiKey:t})}},placeholder:"openrouter"===u.settings.provider?"⚠️ OpenRouter support coming soon":"openai"===u.settings.provider?"⚠️ OpenAI support coming soon":"⚠️ Enter your Anthropic API key to use the chat",className:"openrouter"===u.settings.provider?"":(null===(e=u.settings.anthropicApiKey)||void 0===e?void 0:e.trim())||(null===(t=u.settings.apiKey)||void 0===t?void 0:t.trim())?"":"border-red-500 dark:border-red-400 placeholder:text-red-500/90 dark:placeholder:text-red-400/90 placeholder:font-medium",disabled:"openrouter"===u.settings.provider||"openai"===u.settings.provider})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"GROQ API Key"}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Required for voice transcription. Get yours at"," ",(0,s.jsx)("a",{href:"https://console.groq.com/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"console.groq.com"})]}),(0,s.jsx)(ec,{type:"password",value:u.settings.groqApiKey||"",onChange:e=>{p({groqApiKey:e.target.value.trim()})},placeholder:"Enter your GROQ API key for voice transcription"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Model"}),(0,s.jsx)("select",{value:u.settings.model,onChange:e=>p({model:e.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:(0,ej.SM)(u.settings.provider||"anthropic").map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"System Prompt"}),(0,s.jsx)(T,{value:u.settings.systemPrompt,onChange:e=>p({systemPrompt:e.target.value}),placeholder:"Enter a system prompt...",className:"min-h-[100px]"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",id:"elideToolResults",checked:null!==(r=u.settings.elideToolResults)&&void 0!==r&&r,onChange:e=>p({elideToolResults:e.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),(0,s.jsx)("label",{htmlFor:"elideToolResults",className:"text-sm font-medium",children:"Use Claude to elide tool results from previous messages"})]})]})]})}),(0,s.jsx)(ek,{serverIds:u.settings.mcpServerIds||[],onServerIdsChange:e=>p({mcpServerIds:e})}),(0,s.jsx)(el,{className:"mt-6",children:(0,s.jsxs)(ei,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Advanced Settings"}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground mb-4",children:"Database Version: 5"}),(0,s.jsx)(g,{variant:"destructive",onClick:()=>d(!0),children:"Reset state"}),(0,s.jsx)(eu,{open:c,onOpenChange:d,children:(0,s.jsxs)(eh,{children:[(0,s.jsxs)(ef,{children:[(0,s.jsx)(eg,{children:"Reset Application State"}),(0,s.jsx)(ev,{children:"Are you sure you want to reset the application state? This will delete all projects, conversations, and settings. This action cannot be undone."})]}),(0,s.jsxs)(ex,{children:[(0,s.jsx)(eb,{children:"Cancel"}),(0,s.jsx)(ey,{onClick:async()=>{let e=async()=>Promise.all((await window.indexedDB.databases()).map(e=>new Promise((t,r)=>{let s=window.indexedDB.deleteDatabase(e.name);s.onsuccess=()=>t(),s.onerror=()=>r(s.error)})));try{await e(),window.location.reload()}catch(e){console.error("Error clearing databases:",e)}},children:"Reset"})]})]})})]})})]})};var eK=r(4024),eF=r(4857),eq=r(2060),eL=r(872);let eU=e=>{let{onExportConversation:t,isMobileMenuOpen:r=!0,onMobileMenuToggle:n,onConversationSelect:o}=e,{projects:l,activeProjectId:i,activeConversationId:c,createProject:d,deleteProject:u,createConversation:p,deleteConversation:h,renameConversation:f,renameProject:x,setActiveProject:v,setActiveConversation:y}=(0,W.P)(),[j,w]=(0,a.useState)(new Set),[N,k]=(0,a.useState)(!1);(0,a.useEffect)(()=>{i&&w(e=>{let t=new Set(e);return t.add(i),t})},[i]);let[A,C]=(0,a.useState)(!1),[R,_]=(0,a.useState)(null),[S,P]=(0,a.useState)(null),[E,T]=(0,a.useState)(""),I=e=>{w(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},[z]=(0,a.useState)({}),D=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=l.find(t=>t.id===e);if(null==r?void 0:r.conversations){if(t&&0===r.conversations.length)p(e);else if(r.conversations.length>0){let t=z[e];t&&r.conversations.some(e=>e.id===t)?y(t):y(r.conversations[0].id)}v(e)}};(0,a.useEffect)(()=>{i&&c&&(z[i]=c)},[i,c]);let O=[...l].sort((e,t)=>(e.order||0)-(t.order||0));return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g,{variant:"secondary",size:"icon",className:"fixed left-4 top-4 z-[100] md:hidden rounded-full shadow-lg hover:shadow-xl bg-background",onClick:n,"aria-label":"Toggle mobile menu",children:(0,s.jsx)(m.A,{className:"h-5 w-5"})}),(0,s.jsxs)("div",{className:"\n        fixed inset-y-0 left-0\n        md:sticky md:top-0 md:left-auto\n        w-[280px] max-w-[85vw]\n        bg-background border-r\n        transition-transform duration-200 ease-in-out\n        ".concat(r?"translate-x-0":"-translate-x-full","\n        md:translate-x-0\n        z-40\n        flex flex-col\n        h-screen\n      "),children:[(0,s.jsxs)("div",{className:"flex gap-2 mb-2 p-4 pt-16 md:pt-4",children:[(0,s.jsxs)(g,{onClick:()=>{d("New Project")},className:"flex-1",variant:"outline",children:[(0,s.jsx)(eK.A,{className:"w-4 h-4 mr-2"}),"New Project"]}),(0,s.jsx)(g,{onClick:()=>i&&t(i),variant:"outline",disabled:!i,children:(0,s.jsx)(eF.A,{className:"w-4 h-4"})})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0 px-4",children:O.map((e,t)=>(0,s.jsxs)("div",{className:"mb-2 ".concat(t>0?"mt-2 pt-2 border-t border-accent/35":""),children:[(0,s.jsxs)("div",{className:"p-2 rounded-lg flex items-center gap-2 transition-colors cursor-pointer\n                ".concat(e.id===i?"bg-accent text-accent-foreground":"hover:bg-muted","\n                text-base font-medium"),onClick:t=>{t.stopPropagation(),I(e.id),e.id!==i&&(D(e.id,!0),null==n||n())},children:[(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),t.preventDefault(),I(e.id)},className:"p-1 hover:bg-muted-foreground/10 rounded",children:j.has(e.id)?(0,s.jsx)(b.A,{className:"w-4 h-4"}):(0,s.jsx)(e_.A,{className:"w-4 h-4"})}),(0,s.jsx)("span",{className:"truncate flex-1",title:e.name,children:e.name}),(0,s.jsx)(g,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:t=>{t.stopPropagation(),v(e.id),p(e.id),w(t=>{let r=new Set(t);return r.add(e.id),r}),null==o||o(),null==n||n()},title:"New chat",children:(0,s.jsx)(eq.A,{className:"w-4 h-4 opacity-100 transition-all duration-200 hover:scale-125 hover:opacity-75"})}),(0,s.jsx)(g,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:t=>{t.stopPropagation(),P({type:"project",projectId:e.id,currentName:e.name}),T(e.name),C(!0)},children:(0,s.jsx)(eL.A,{className:"w-4 h-4 opacity-100 transition-all duration-200 hover:scale-125 hover:opacity-75"})}),(0,s.jsx)(g,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:t=>{t.stopPropagation(),_({type:"project",projectId:e.id}),k(!0)},children:(0,s.jsx)(eN.A,{className:"w-4 h-4 text-destructive opacity-100 transition-all duration-200 hover:scale-125 hover:opacity-75"})})]}),j.has(e.id)&&(0,s.jsx)("div",{className:"ml-4 mt-1 space-y-1",children:e.conversations.sort((e,t)=>{let r=e=>e?e instanceof Date?e.getTime():new Date(e).getTime():Date.now(),s=r(e.createdAt||e.lastUpdated);return r(t.createdAt||t.lastUpdated)-s}).map(t=>(0,s.jsxs)("div",{className:"p-2 rounded-lg cursor-pointer flex items-center gap-2 transition-colors\n                      ".concat(t.id===c?"bg-accent text-accent-foreground":"hover:bg-muted","\n                      text-sm truncate max-w-[250px]"),onClick:()=>{D(e.id),y(t.id),null==o||o(),null==n||n()},children:[(0,s.jsx)("span",{className:"truncate flex-1",title:t.name,children:t.name}),(0,s.jsx)(g,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:r=>{r.stopPropagation(),P({type:"conversation",projectId:e.id,conversationId:t.id,currentName:t.name}),T(t.name),C(!0)},children:(0,s.jsx)(eL.A,{className:"w-4 h-4 opacity-100 transition-opacity duration-200 hover:opacity-75"})}),(0,s.jsx)(g,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:r=>{r.stopPropagation(),_({type:"conversation",projectId:e.id,conversationId:t.id}),k(!0)},children:(0,s.jsx)(eN.A,{className:"w-4 h-4 text-destructive opacity-100 transition-opacity duration-200 hover:opacity-75"})})]},t.id))})]},e.id))}),(0,s.jsx)(eu,{open:N,onOpenChange:k,children:(0,s.jsxs)(eh,{children:[(0,s.jsxs)(ef,{children:[(0,s.jsxs)(eg,{children:["Delete ",(null==R?void 0:R.type)==="project"?"Project":"Conversation"]}),(0,s.jsxs)(ev,{children:["Are you sure you want to delete this ",null==R?void 0:R.type,"? This action cannot be undone.",(null==R?void 0:R.type)==="project"&&" All conversations in this project will be deleted."]})]}),(0,s.jsxs)(ex,{children:[(0,s.jsx)(eb,{onClick:()=>k(!1),children:"Cancel"}),(0,s.jsx)(ey,{onClick:()=>{R&&("project"===R.type?u(R.projectId):R.conversationId&&h(R.projectId,R.conversationId),k(!1),_(null))},autoFocus:!0,children:"Delete"})]})]})}),(0,s.jsx)(U,{open:A,onOpenChange:C,children:(0,s.jsx)(B,{children:(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),S&&E.trim()&&("project"===S.type?x(S.projectId,E.trim()):S.conversationId&&f(S.projectId,S.conversationId,E.trim()),C(!1),P(null),T(""))},children:[(0,s.jsx)(G,{children:(0,s.jsxs)(Y,{children:["Rename ",(null==S?void 0:S.type)==="project"?"Project":"Conversation"]})}),(0,s.jsx)(ec,{value:E,onChange:e=>T(e.target.value),placeholder:"Enter new name",className:"my-4"}),(0,s.jsxs)(J,{children:[(0,s.jsx)(g,{type:"button",variant:"outline",onClick:()=>{C(!1),P(null),T("")},children:"Cancel"}),(0,s.jsx)(g,{type:"submit",variant:"default",children:"Save"})]})]})})})]})]})},eM=()=>{let[e,t]=(0,a.useState)(!1),[r,n]=(0,a.useState)("chat"),o=(0,a.useRef)(null);return a.useEffect(()=>{t(window.innerWidth>=768)},[]),(0,s.jsxs)("div",{className:"min-h-screen bg-background text-foreground flex relative overflow-x-hidden",children:[e&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 md:hidden z-40 backdrop-blur-sm transition-opacity duration-200",onClick:()=>t(!1)}),(0,s.jsx)(eU,{onExportConversation:(e,t)=>{console.log("Export",{projectId:e,conversationId:t})},isMobileMenuOpen:e,onMobileMenuToggle:()=>t(!e),onConversationSelect:()=>n("chat")}),(0,s.jsx)(g,{variant:"outline",size:"icon",className:"fixed left-4 top-4 z-50 md:hidden shadow-lg ".concat(e?"hidden":"flex"," w-9 h-9 rounded-full"),onClick:()=>t(!0),children:(0,s.jsx)(m.A,{className:"w-4 h-4"})}),(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)("div",{className:"absolute right-4 top-4 z-50 flex items-center gap-4 transition-opacity duration-200\n              ".concat(e?"opacity-100":"md:opacity-100 opacity-0 pointer-events-none md:pointer-events-auto"),children:(0,s.jsx)(c,{value:r,onValueChange:e=>{n(e),window.innerWidth<768&&t(!1),"chat"===e&&setTimeout(()=>{var e;null===(e=o.current)||void 0===e||e.focus()},0)},children:(0,s.jsx)("div",{className:"flex items-center gap-4 bg-background/80 backdrop-blur-sm rounded-lg shadow-lg p-1",children:(0,s.jsxs)(d,{className:"bg-transparent",children:[(0,s.jsx)(u,{value:"chat",children:"Chat"}),(0,s.jsx)(u,{value:"settings",children:"Settings"})]})})})}),(0,s.jsx)("div",{className:"flex flex-col h-full",children:(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"settings"===r?"hidden":"",children:(0,s.jsx)(c,{value:r,children:(0,s.jsx)(p,{value:"chat",forceMount:!0,children:(0,s.jsx)(eo,{ref:o})})})}),(0,s.jsx)("div",{className:"chat"===r?"hidden":"",children:(0,s.jsx)(c,{value:r,children:(0,s.jsx)(p,{value:"settings",forceMount:!0,children:(0,s.jsx)(eO,{})})})})]})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[694,434,441,517,358],()=>t(4352)),_N_E=e.O()}]);