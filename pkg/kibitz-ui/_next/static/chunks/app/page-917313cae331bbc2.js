(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4352:(e,t,r)=>{Promise.resolve().then(r.bind(r,3625))},3625:(e,t,r)=>{"use strict";r.d(t,{default:()=>eX});var s=r(5155),n=r(2115);function a(e,t){if(!e||"anthropic"===e)return{type:"anthropic",settings:{apiKey:t.anthropicApiKey||t.apiKey||""}};if("openrouter"===e)return{type:"openrouter",settings:{apiKey:t.openRouterApiKey||"",baseUrl:t.openRouterBaseUrl||""}};if("openai"===e)return{type:"openai",settings:{apiKey:t.openaiApiKey||"",baseUrl:t.openaiBaseUrl||"https://api.openai.com/v1",organizationId:t.openaiOrgId||""}};throw Error("Unknown provider type: ".concat(e))}let o=async()=>new Promise((e,t)=>{let r=indexedDB.open("kibitz_db",5);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=e=>{let t=e.target.result;if(e.oldVersion<1){let e=t.createObjectStore("projects",{keyPath:"id"});e.createIndex("createdAt","createdAt"),e.createIndex("updatedAt","updatedAt"),e.createIndex("name","name"),e.createIndex("order","order"),t.createObjectStore("appState",{keyPath:"id"}),t.createObjectStore("mcpServers",{keyPath:"id"}).createIndex("name","name"),e.createIndex("settings.systemPrompt","settings.systemPrompt"),e.createIndex("conversations.name","conversations.name",{multiEntry:!0}),e.createIndex("conversations.messages.content","conversations.messages.content",{multiEntry:!0})}else if(e.oldVersion<2){let t=e.target.transaction;if(!t){console.error("No transaction available during upgrade");return}let r=t.objectStore("projects");r.indexNames.contains("order")||r.createIndex("order","order"),r.openCursor().onsuccess=e=>{let t=e.target.result;if(t){let e=t.value;"number"!=typeof e.order&&(e.order=t.key,t.update(e)),t.continue()}}}else if(e.oldVersion<3)t.createObjectStore("mcpServers",{keyPath:"id"}).createIndex("name","name");else if(e.oldVersion<4){let t=e.target.transaction;if(!t){console.error("No transaction available during upgrade");return}let r=t.objectStore("projects");r.openCursor().onsuccess=e=>{let t=e.target.result;if(t){let e=t.value;e.settings||(e.settings={mcpServers:[],model:"claude-3-5-sonnet-20241022",systemPrompt:"",elideToolResults:!1}),e.settings&&((["claude-2.0","claude-2.1","claude-2","claude-instant"].includes(e.settings.model)||!e.settings.model)&&(e.settings.model="claude-3-5-sonnet-20241022"),e.settings.provider="anthropic",e.settings.apiKey&&(e.settings.anthropicApiKey=e.settings.apiKey),e.settings.openRouterApiKey="",e.settings.openRouterBaseUrl="");try{t.update(e)}catch(r){console.error("Error updating project during migration:",r);try{t.update({...e,settings:{...e.settings,provider:"anthropic"}})}catch(e){console.error("Critical error during migration fallback:",e)}}t.continue()}},r.openCursor().onerror=e=>{console.error("Error during v4 migration:",e)}}else if(e.oldVersion<5){let t=e.target.transaction;if(!t){console.error("No transaction available during upgrade");return}let r=t.objectStore("projects");r.openCursor().onsuccess=e=>{let t=e.target.result;if(t){let e=t.value;try{e.settings&&(e.settings.providerConfig=a(e.settings.provider,e.settings),t.update(e))}catch(e){console.error("Error updating project during v5 migration:",e)}t.continue()}},r.openCursor().onerror=e=>{console.error("Error during v5 migration:",e)}}}}),i=async()=>{let e=await o();return new Promise((t,r)=>{let s=e.transaction(["projects","appState"],"readonly"),n=s.objectStore("projects"),a=s.objectStore("appState"),o=[],i={};n.index("order").openCursor().onsuccess=e=>{let t=e.target.result;t&&(o.push(t.value),t.continue())},a.get("activeIds").onsuccess=e=>{let t=e.target.result;t&&(i.activeProjectId=t.activeProjectId,i.activeConversationId=t.activeConversationId)},s.oncomplete=()=>{t({projects:o,activeProjectId:i.activeProjectId||null,activeConversationId:i.activeConversationId||null})},s.onerror=()=>r(s.error)})},l=e=>{if(e instanceof Date)return isNaN(e.getTime())?new Date().toISOString():e.toISOString();if("string"==typeof e){let t=new Date(e);return isNaN(t.getTime())?e:t.toISOString()}if("number"==typeof e){let t=new Date(e);if(!isNaN(t.getTime()))return t.toISOString()}return new Date().toISOString()},c=e=>{if(e instanceof Date&&!isNaN(e.getTime()))return e;let t=new Date(e||Date.now());return isNaN(t.getTime())?new Date:t},d=e=>{var t;let r=JSON.parse(JSON.stringify({...e,settings:{...e.settings,mcpServers:(null===(t=e.settings.mcpServers)||void 0===t?void 0:t.map(e=>({...e,ws:void 0,status:"disconnected"})))||[],providerConfig:e.settings.providerConfig||a(e.settings.provider,e.settings)},conversations:e.conversations.map(e=>({...e,lastUpdated:l(e.lastUpdated),messages:e.messages.map(e=>({...e,timestamp:l(e.timestamp)}))}))}));return r.conversations=r.conversations.map(e=>({...e,lastUpdated:c(e.lastUpdated),messages:e.messages.map(e=>({...e,timestamp:c(e.timestamp)}))})),r.createdAt=c(e.createdAt),r.updatedAt=c(e.updatedAt),"number"!=typeof r.order&&(r.order=Date.now()),r},u=async e=>{let t=await o();return new Promise((r,s)=>{let n=t.transaction(["projects","appState"],"readwrite");n.objectStore("projects").clear(),e.projects.forEach(e=>{let t=d(e);n.objectStore("projects").add(t)}),n.objectStore("appState").put({id:"activeIds",activeProjectId:e.activeProjectId,activeConversationId:e.activeConversationId}),n.oncomplete=()=>r(),n.onerror=()=>s(n.error)})},p=e=>JSON.parse(JSON.stringify({...e,ws:void 0,status:"disconnected"})),m=async e=>{let t=await o();return new Promise((r,s)=>{let n=t.transaction(["mcpServers"],"readwrite"),a=n.objectStore("mcpServers");a.clear(),e.forEach(e=>{let t=p(e);a.add(t)}),n.oncomplete=()=>r(),n.onerror=()=>s(n.error)})},f=async()=>{let e=await o();return new Promise((t,r)=>{let s=[],n=e.transaction(["mcpServers"],"readonly");n.objectStore("mcpServers").openCursor().onsuccess=e=>{let t=e.target.result;t&&(s.push(t.value),t.continue())},n.oncomplete=()=>t(s),n.onerror=()=>r(n.error)})},h=(0,n.createContext)(null),g=()=>Math.random().toString(36).substring(7),x={apiKey:"",model:function(e){switch(e){case"openai":return"gpt-4o";case"openrouter":return"openai/gpt-4-turbo-preview";default:return"claude-3-5-sonnet-20241022"}}("anthropic"),systemPrompt:"",mcpServers:[],elideToolResults:!1},v=()=>{let e=(0,n.useContext)(h);if(!e)throw Error("useProjects must be used within a ProjectProvider");return e},y=e=>{let{children:t}=e,[r,a]=(0,n.useState)([]),[o,l]=(0,n.useState)(null),[c,d]=(0,n.useState)(null),p=(0,n.useRef)(!1),m=(0,n.useCallback)(()=>{let e={id:g(),name:"Default Project",settings:{...x,mcpServers:[]},conversations:[],createdAt:new Date,updatedAt:new Date,order:Date.now()};a([e]),l(e.id)},[]);(0,n.useEffect)(()=>{p.current||(p.current=!0,(async()=>{try{let e=await i();if(e.projects.length>0){if(a(e.projects),l(e.activeProjectId),e.activeProjectId&&e.activeConversationId){let t=e.projects.find(t=>t.id===e.activeProjectId);(null==t?void 0:t.conversations.some(t=>t.id===e.activeConversationId))&&d(e.activeConversationId)}}else{let e={id:g(),name:"(New Chat)",lastUpdated:new Date,messages:[],createdAt:new Date},t={id:g(),name:"Default Project",settings:{...x,mcpServers:[]},conversations:[e],createdAt:new Date,updatedAt:new Date,order:Date.now()};a([t]),l(t.id),d(e.id)}}catch(e){console.error("Error initializing data:",e),m()}})())},[]),(0,n.useEffect)(()=>{if(0===r.length)return;let e=setTimeout(()=>{u({projects:r,activeProjectId:o,activeConversationId:c}).catch(e=>{console.error("Error saving state:",e)})},1e3);return()=>clearTimeout(e)},[r,o,c]);let f=(0,n.useCallback)((e,t)=>{a(r=>{let s=r.find(t=>t.id===e);return s?r.map(r=>{if(r.id!==e)return r;let n=r.conversations;return t.conversations&&(n=t.conversations.map(e=>{let t=s.conversations.find(t=>t.id===e.id);return t&&"(New Chat)"!==t.name?{...e,name:t.name}:e})),{...r,settings:t.settings?{...r.settings,...t.settings,mcpServers:void 0!==t.settings.mcpServers?t.settings.mcpServers:r.settings.mcpServers}:r.settings,conversations:n,updatedAt:new Date}}):r})},[]),v=(0,n.useCallback)(e=>{let t=g(),r={id:t,name:"(New Chat)",lastUpdated:new Date,messages:[],createdAt:new Date};return a(t=>t.map(t=>t.id!==e?t:{...t,conversations:[r],updatedAt:new Date})),d(t),t},[]),y=(0,n.useCallback)((e,t)=>{let s=r.find(e=>e.id===o),n=g(),i={id:n,name:e,settings:{...x,...s&&{apiKey:s.settings.apiKey,systemPrompt:"",mcpServers:[]},...t},conversations:[],createdAt:new Date,updatedAt:new Date,order:Date.now()};return a(e=>{let t=e.reduce((e,t)=>Math.max(e,t.order||0),0);return i.order=t+1,[...e,i]}),l(n),v(n),n},[o,r,v]),b=(0,n.useCallback)(e=>{let t=r.find(t=>t.id!==e);if(a(t=>t.filter(t=>t.id!==e)),o===e&&t){var s,n;let e=null!==(n=null===(s=t.conversations[0])||void 0===s?void 0:s.id)&&void 0!==n?n:null;l(t.id),d(e)}},[o,r]),j=(0,n.useCallback)((e,t)=>{let r=g();a(s=>s.map(s=>s.id!==e?s:{...s,conversations:[{id:r,name:t||"(New Chat)",lastUpdated:new Date,createdAt:new Date,messages:[]},...s.conversations],updatedAt:new Date})),d(r)},[]),w=(0,n.useCallback)((e,t)=>{let s=g();a(r=>r.map(r=>{if(r.id!==e)return r;let n=r.conversations.filter(e=>e.id!==t);if(0===n.length){let e={id:s,name:"(New Chat)",lastUpdated:new Date,messages:[],createdAt:new Date};return{...r,conversations:[e],updatedAt:new Date}}return{...r,conversations:n,updatedAt:new Date}}));let n=r.find(t=>t.id===e);if(n){if(1===n.conversations.length)d(s);else if(c===t){var o,i;d(null!==(i=null===(o=n.conversations.find(e=>e.id!==t))||void 0===o?void 0:o.id)&&void 0!==i?i:null)}}},[c,r]),N=(0,n.useCallback)((e,t,r)=>{if("(New Chat)"===r){console.log("Prevented rename to (New Chat)");return}console.log("Renaming conversation ".concat(t,' to "').concat(r,'"')),a(s=>s.map(s=>s.id!==e?s:{...s,conversations:s.conversations.map(e=>e.id===t?{...e,name:r}:e),updatedAt:new Date}))},[]),k=(0,n.useCallback)((e,t)=>{a(r=>r.map(r=>r.id===e?{...r,name:t,updatedAt:new Date}:r))},[]),C=(0,n.useCallback)(e=>{if(l(e),!e){d(null);return}let t=r.find(t=>t.id===e);t&&t.conversations.length>0&&!c&&d(t.conversations[0].id)},[r,c]);return(0,s.jsx)(h.Provider,{value:{projects:r,activeProjectId:o,activeConversationId:c,createProject:y,deleteProject:b,updateProjectSettings:f,createConversation:j,deleteConversation:w,renameConversation:N,setActiveProject:C,setActiveConversation:d,renameProject:k},children:t})},b="/fwd-ws:kibitz:nick.kino",j=(0,n.createContext)(null),w=()=>{let e=(0,n.useContext)(j);if(!e)throw Error("useMcp must be used within a McpProvider");return e},N=e=>{let{children:t,initialServers:r=[]}=e,{projects:a,updateProjectSettings:o}=v(),[i,l]=(0,n.useState)(()=>r.map(e=>({...e,status:"disconnected"}))),c=(0,n.useRef)(new Map),d=(0,n.useRef)(new Map),u=(0,n.useCallback)(e=>{let t=d.current.get(e);t&&(clearTimeout(t),d.current.delete(e));let r=c.current.get(e);r&&(r.close(),c.current.delete(e))},[]),p=(0,n.useRef)(null),h=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,r=d.current.get(e.id);r&&clearTimeout(r);let s=setTimeout(()=>{var r;null==p.current&&console.log("{server.name}: scheduleReconnect can't reconnect because connectToServerRef is null"),null===(r=p.current)||void 0===r||r.call(p,e).catch(r=>{console.error("Reconnection failed for ".concat(e.name,":"),r),h(e,Math.min(2*t,3e4))})},t);d.current.set(e.id,s)},[]),g=(0,n.useCallback)(async e=>{try{l(t=>t.map(t=>t.id===e.id?{...t,status:"connecting",error:void 0}:t));let t=new WebSocket(e.uri);return new Promise((r,s)=>{let n=setTimeout(()=>{t.close(),s(Error("Connection timeout"))},1e4);t.onopen=()=>{clearTimeout(n),c.current.set(e.id,t),t.send(JSON.stringify({jsonrpc:"2.0",method:"initialize",params:{protocolVersion:"0.1.0",clientInfo:{name:"llm-chat",version:"1.0.0"},capabilities:{tools:{}}},id:1}))},t.onclose=()=>{clearTimeout(n),u(e.id),l(t=>t.map(t=>t.id===e.id?{...t,status:"disconnected",error:"Connection closed"}:t)),h(e)},t.onerror=t=>{clearTimeout(n),console.log("WebSocket error (trying to reconnect...): ".concat(t)),u(e.id),l(t=>t.map(t=>t.id===e.id?{...t,status:"error",error:"Connection error"}:t)),h(e,0),s(t)},t.onmessage=s=>{try{let n=JSON.parse(s.data);if(1===n.id)t.send(JSON.stringify({jsonrpc:"2.0",method:"notifications/initialized"})),t.send(JSON.stringify({jsonrpc:"2.0",method:"tools/list",id:2}));else if(2===n.id){if(n.error)return console.log("Received unexpected WS-MCP message: ".concat(n.results)),e;let s=n.result.tools.map(e=>({...e,input_schema:e.inputSchema})),a={...e,status:"connected",error:void 0,tools:s,connection:t};l(t=>t.map(t=>t.id===e.id?a:t)),r(a)}}catch(t){return console.error("Error parsing WebSocket message:",t),{...e,status:"error",error:t instanceof Error?t.message:"Error parsing WebSocket message"}}}})}catch(t){return console.error("Failed to connect to server ".concat(e.name,":"),t),{...e,status:"error",error:t instanceof Error?t.message:"Failed to connect"}}},[u,h]);p.current=g;let x=(0,n.useCallback)(async e=>{l(t=>[...t,{...e,status:"connecting",error:void 0}]);try{let t=await g(e);return l(r=>r.map(r=>r.id===e.id?t:r)),t}catch(t){return l(t=>t.map(t=>t.id===e.id?{...t,status:"error",error:"Connection failed"}:t)),i.find(t=>t.id===e.id)}},[g,i]);(0,n.useEffect)(()=>{(async()=>{try{let e=await f();for(let t of(console.log("loading servers from IndexedDB: ".concat(JSON.stringify(e))),e))try{let e=await x(t);e&&a.forEach(t=>{o(t.id,{settings:{...t.settings,mcpServers:t.settings.mcpServers.map(t=>t.id===e.id?{...t,status:e.status,error:void 0}:t)}})})}catch(e){console.error("Initial connection failed for ".concat(t.name,":"),e)}}catch(e){console.error("Error initializing MCP servers:",e)}})()},[]),(0,n.useEffect)(()=>{m(i).catch(e=>{console.error("Error saving MCP servers:",e)})},[i]);let y=(0,n.useCallback)(e=>{u(e),l(t=>t.filter(t=>t.id!==e))},[u]),w=(0,n.useCallback)(async e=>{let t=i.find(t=>t.id===e);if(!t)throw Error("Server not found");try{let r=await g(t);return l(t=>t.map(t=>t.id===e?r:t)),r}catch(t){throw l(t=>t.map(t=>t.id===e?{...t,status:"error",error:"Reconnection failed"}:t)),t}},[g,i]),N=(0,n.useCallback)(async()=>{let e="localhost-mcp",t=window.location.protocol.endsWith("s:")?"wss":"ws",r=b?"".concat(t,"://").concat(window.location.host).concat(b):"ws://localhost:10125",s=i.find(t=>t.id===e);if(s)return s;try{let t=await g({id:e,name:"Local MCP",uri:r,status:"disconnected"});if("connected"===t.status)return l(e=>[...e,t]),t;return null}catch(e){return console.log("Local MCP not available"),null}},[g,i]);return(0,n.useEffect)(()=>{if(0==a.length)return;let e=a[a.length-1];if(e.settings.mcpServers.length>0)return;let t=e.createdAt,r=e.updatedAt,s=new Date;t>=new Date(s.getTime()-6e4)&&t<=s&&!(r>t)&&N().then(t=>{t&&o(e.id,{settings:{...e.settings,mcpServers:[...e.settings.mcpServers,t]}})})},[a,N,o]),(0,s.jsx)(j.Provider,{value:{servers:i,addServer:x,removeServer:y,reconnectServer:w,attemptLocalMcpConnection:N,executeTool:async(e,t,r)=>{let s=c.current.get(e);if(!s||s.readyState!==WebSocket.OPEN)throw Error("Server not connected");return new Promise((e,n)=>{let a=Math.random().toString(36).substring(7),o=t=>{try{let r=JSON.parse(t.data);r.id===a&&(s.removeEventListener("message",o),r.error?n(Error(r.error.message)):e(r.result.content[0].text))}catch(e){console.error("Error parsing tool response:",e),n(Error("Failed to parse tool response"))}};s.addEventListener("message",o),s.send(JSON.stringify({jsonrpc:"2.0",method:"tools/call",params:{name:t,arguments:r},id:a}))})}},children:t})};var k=r(8629),C=r(3463),S=r(9795);function A(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,S.QP)((0,C.$)(t))}let R=k.bL,P=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(k.B8,{ref:t,className:A("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...n})});P.displayName=k.B8.displayName;let _=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(k.l9,{ref:t,className:A("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...n})});_.displayName=k.l9.displayName;let D=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(k.UC,{ref:t,className:A("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...n})});D.displayName=k.UC.displayName;var I=r(6710),E=r(2317),O=r(1027);let T=(0,O.F)("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background",{variants:{variant:{default:"bg-primary/90 text-primary-foreground hover:bg-primary/60",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"underline-offset-4 hover:underline text-primary"},size:{default:"h-10 py-2 px-4",sm:"h-9 px-3 rounded-md",lg:"h-11 px-8 rounded-md",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),z=n.forwardRef((e,t)=>{let{className:r,variant:n,size:a,asChild:o=!1,...i}=e,l=o?E.DX:"button";return(0,s.jsx)(l,{className:A(T({variant:n,size:a,className:r})),ref:t,...i})});z.displayName="Button";var K=r(5565),U=r(4521),M=r(767),F=r(1406),J=r(8283),L=r(3608);let V=["image/jpeg","image/png","image/gif","image/webp"],W=["application/pdf"],H=["applications/javascript","application/typescript","application/x-httpd-php","application/x-sh","application/x-powershell","application/json","application/xml","application/yaml","application/toml","application/x-tex","application/sql","application/x-python","application/x-ruby","application/x-diff","application/x-patch","application/typescript","application/x-properties"],Y=e=>{let{onFileSelect:t,onUploadComplete:r}=e,a=(0,n.useRef)(null),o=(0,n.useCallback)(async e=>{if(!(V.includes(e.type)||W.includes(e.type)||e.type.startsWith("text/")||H.includes(e.type))){alert("Unsupported file type. Please upload an image (JPEG, PNG, GIF, WebP), a PDF, or a plaintext document.");return}let s=new FileReader;s.onload=async()=>{let n=s.result.split(",")[1];if(e.type.startsWith("text/")||H.includes(e.type)){t({type:"text",text:function(e){try{let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return new TextDecoder("utf-8").decode(r)}catch(e){throw Error("Failed to decode base64 string: "+e.message)}}(n)}),null==r||r();return}V.includes(e.type)?(t({type:"image",source:{type:"base64",media_type:e.type,data:n},fileName:e.name}),null==r||r()):"application/pdf"===e.type&&(t({type:"document",source:{type:"base64",media_type:"application/pdf",data:n},fileName:e.name}),null==r||r())},s.readAsDataURL(e)},[t,r]),i=(0,n.useCallback)(async e=>{for(let t of(e.preventDefault(),Array.from(e.dataTransfer.files)))await o(t)},[o]),l=(0,n.useCallback)(async e=>{for(let t of Array.from(e.target.files||[]))await o(t)},[o]);return(0,s.jsxs)("div",{onDrop:i,onDragOver:e=>{e.preventDefault()},className:"relative",children:[(0,s.jsx)("input",{type:"file",ref:a,onChange:l,accept:[...V,...W].join(","),className:"hidden",multiple:!0}),(0,s.jsx)(z,{onClick:()=>{var e;null===(e=a.current)||void 0===e||e.click()},variant:"ghost",size:"icon",className:"h-8 w-8",title:"Upload files (Images or PDFs)",children:(0,s.jsx)(L.A,{className:"h-5 w-5"})})]})};var q=r(8867),B=r(7341);let Z=e=>{let{text:t,className:r=""}=e,[a,o]=(0,n.useState)(!1),i=async e=>{e.preventDefault(),e.stopPropagation();try{await navigator.clipboard.writeText(t),o(!0),setTimeout(()=>o(!1),2e3)}catch(e){console.error("Failed to copy text:",e)}};return(0,s.jsxs)("button",{onClick:i,className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-sm hover:bg-kinode-orange/10 ".concat(r),children:[a?(0,s.jsx)(q.A,{className:"h-4 w-4"}):(0,s.jsx)(B.A,{className:"h-4 w-4"}),a?"Copied":"Copy"]})},G=n.forwardRef((e,t)=>{let{className:r,maxRows:a=8,onChange:o,...i}=e,l=n.useRef(null),c=n.useCallback(e=>{let t=l.current;if(t){t.style.height="auto";let e=Math.min(t.scrollHeight,a*parseInt(getComputedStyle(t).lineHeight));t.style.height=t.value?"".concat(e,"px"):"2.5em"}null==o||o(e)},[a,o]);return n.useEffect(()=>{l.current&&(l.current.style.height="2.5em")},[]),(0,s.jsx)("textarea",{className:A("flex h-[2.5em] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 overflow-y-auto resize-none transition-height duration-150",r),ref:e=>{l.current=e,"function"==typeof t?t(e):t&&(t.current=e)},onChange:c,...i})});G.displayName="Textarea";let Q=(0,O.F)("relative w-full rounded-lg border p-4 [&>svg]:absolute [&>svg]:text-foreground [&>svg]:left-4 [&>svg]:top-4 [&>svg+div]:translate-y-[-3px] [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"text-destructive border-destructive/50 dark:border-destructive [&>svg]:text-destructive text-destructive"}},defaultVariants:{variant:"default"}}),X=n.forwardRef((e,t)=>{let{className:r,variant:n,...a}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:A(Q({variant:n}),r),...a})});X.displayName="Alert",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("h5",{ref:t,className:A("mb-1 font-medium leading-none tracking-tight",r),...n})}).displayName="AlertTitle";let $=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:A("text-sm [&_p]:leading-relaxed",r),...n})});$.displayName="AlertDescription";var ee=r(3550),et=r(6246),er=r(6217);let es=er.bL;er.l9;let en=er.ZL,ea=n.forwardRef(function(e,t){return(0,s.jsx)(er.hJ,{ref:t,className:A("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e.className),...e})}),eo=n.forwardRef(function(e,t){return(0,s.jsxs)(en,{children:[(0,s.jsx)(ea,{}),(0,s.jsxs)(er.UC,{ref:t,className:A("fixed left-[50%] top-[50%] z-50 grid w-full translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg","max-w-[90%] sm:max-w-[85%] md:max-w-[80%] lg:max-w-[75%]","max-h-[85vh] overflow-y-auto",e.className),...e,children:[e.children,(0,s.jsxs)(er.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(M.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}),ei=e=>{let{className:t,...r}=e;return(0,s.jsx)("div",{className:A("flex flex-col space-y-1.5 text-center sm:text-left",t),...r})},el=e=>{let{className:t,...r}=e;return(0,s.jsx)("div",{className:A("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r})},ec=n.forwardRef(function(e,t){return(0,s.jsx)(er.hE,{ref:t,className:A("text-lg font-semibold leading-none tracking-tight",e.className),...e})});var ed=r(314),eu=r(4504);let ep=e=>{let{toolCall:t,onClose:r}=e,[a,o]=(0,n.useState)(!1);return(0,s.jsx)(es,{open:!0,onOpenChange:r,children:(0,s.jsxs)(eo,{children:[(0,s.jsx)(ei,{className:"mb-4 shrink-0",children:(0,s.jsxs)("div",{className:"flex justify-between items-center gap-4",children:[(0,s.jsx)(ec,{className:"truncate",children:"Tool Call: ".concat(t.name)}),(0,s.jsx)(z,{variant:"ghost",size:"icon",onClick:()=>o(!a),children:a?(0,s.jsx)(ed.A,{className:"h-4 w-4"}):(0,s.jsx)(eu.A,{className:"h-4 w-4"})})]})}),(0,s.jsxs)("div",{className:A("space-y-4 overflow-hidden flex-grow",a?"overflow-y-auto pr-2":"max-h-[240px] sm:max-h-[280px]"),children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium mb-2",children:"Input:"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("pre",{className:A("bg-muted p-2 sm:p-4 rounded-md whitespace-pre-wrap break-all text-sm sm:text-base",!a&&"max-h-[100px] sm:max-h-[120px] overflow-hidden"),children:JSON.stringify(t.input,null,2)}),!a&&(0,s.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-muted to-transparent pointer-events-none"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium mb-2",children:"Result:"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("pre",{className:A("bg-muted p-2 sm:p-4 rounded-md whitespace-pre-wrap break-all text-sm sm:text-base",!a&&"max-h-[100px] sm:max-h-[120px] overflow-hidden"),children:t.result||"No result available"}),!a&&(0,s.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-muted to-transparent pointer-events-none"})]})]})]})]})})},em=()=>{let{projects:e,activeProjectId:t,createConversation:r,setActiveConversation:s,activeConversationId:a}=v(),o=e.find(e=>e.id===t),i=(0,n.useCallback)(t=>{let n=e.find(e=>e.id===t);if(!n)return;if(0===n.conversations.length){r(t);return}let a=n.conversations[n.conversations.length-1];if(0===a.messages.length){s(a.id);return}r(t)},[e,r,s]);return(0,n.useEffect)(()=>{if(t&&!a){let n=e.find(e=>e.id===t);if(n){if(0===n.conversations.length)r(t);else{let e=n.conversations[n.conversations.length-1];0===e.messages.length?s(e.id):r(t)}}}},[t,a,e,r,s]),{handleProjectFocus:i,activeProject:o}},ef="claude-3-5-sonnet-20241022",eh=n.forwardRef((e,t)=>{var r,a,o;let[i,l]=(0,n.useState)([]),{projects:c,activeProjectId:d,activeConversationId:u,updateProjectSettings:p,renameConversation:m}=v(),f=c.find(e=>e.id===d),h=null==f?void 0:f.conversations.find(e=>e.id===u),[g,x]=(0,n.useState)(""),[y,b]=(0,n.useState)(!1),[j,N]=(0,n.useState)(null),k=(0,n.useRef)(!1),C=(0,n.useRef)(null),{servers:S,executeTool:A}=w(),R=(0,n.useRef)(null),P=(0,n.useRef)(null),_=(0,n.useRef)(null),[D,I]=(0,n.useState)(null);em(),(0,n.useImperativeHandle)(t,()=>({focus:()=>{_.current&&_.current.focus()}}),[]),(0,n.useEffect)(()=>{_.current&&h&&_.current.focus()},[h]),(0,n.useEffect)(()=>{if(!P.current)return;let e=P.current;e.scrollTop=e.scrollHeight},[]),(0,n.useEffect)(()=>{if(!P.current||!(null==h?void 0:h.messages.length))return;let e=h.messages[h.messages.length-1];("assistant"===e.role||"user"===e.role)&&requestAnimationFrame(()=>{var e;null===(e=R.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})},[null==h?void 0:h.messages,null==h?void 0:h.lastUpdated]);let E=e=>{var t;if(!(null==f?void 0:null===(t=f.settings.mcpServers)||void 0===t?void 0:t.length))return[];let r=new Map;S.filter(e=>f.settings.mcpServers.some(t=>t.id===e.id)).flatMap(e=>e.tools||[]).forEach(e=>{r.has(e.name)||r.set(e.name,{name:e.name,description:e.description,input_schema:e.input_schema})});let s=Array.from(r.values());return e?s.map((e,t,r)=>t!=r.length-1?e:{...e,cache_control:{type:"ephemeral"}}):s},O=(e,t,r)=>{let s=null==f?void 0:f.conversations.find(e=>e.id===t);s&&p(e,{conversations:f.conversations.map(e=>e.id===t?{...s,messages:r,lastUpdated:new Date}:e)})},T=(0,n.useCallback)(()=>{k.current=!0,C.current&&C.current.abort(),b(!1),N("Operation cancelled")},[]),L=async()=>{if(k.current=!1,!g.trim()&&0===i.length||!f||!u)return;N(null),b(!0);let e="openrouter"===f.settings.provider?f.settings.openRouterApiKey:f.settings.anthropicApiKey||f.settings.apiKey;if(!(null==e?void 0:e.trim())){N("API key not found. Please set your ".concat("openrouter"===f.settings.provider?"OpenRouter":"Anthropic"," API key in the Settings panel.")),b(!1);return}_.current&&(_.current.style.height="2.5em");try{var t;let e=i.map(e=>(e.type,{...e,fileName:void 0}));g.trim()&&e.push({type:"text",text:g});let r={role:"user",content:e,timestamp:new Date},s=[...(null==h?void 0:h.messages)||[],r];O(f.id,u,s),x(""),l([]);let n=new U.NB({apiKey:f.settings.anthropicApiKey||f.settings.apiKey||"",dangerouslyAllowBrowser:!0,maxRetries:12}),a=new Set,o=E(!0),c=E(!1),d=null===(t=f.settings.systemPrompt)||void 0===t?void 0:t.trim(),p=d?[{type:"text",text:d}]:void 0;for(;;){let e=s.filter((e,t,r)=>{if("string"==typeof e.content)return!0;let s=e.content;if(!s.some(e=>"tool_use"===e.type))return!0;let n=r[t+1];if(!n||"string"==typeof n.content)return!1;let a=n.content;return s.every(e=>{if("tool_use"!==e.type||!("id"in e))return!0;let t=e.id;return a.some(e=>"tool_result"===e.type&&"tool_use_id"in e&&e.tool_use_id===t)})}).map((e,t,r)=>t<r.length-3?{role:e.role,content:e.content,toolInput:e.toolInput?e.toolInput:void 0}:{role:e.role,content:"string"==typeof e.content?[{type:"text",text:e.content,cache_control:{type:"ephemeral"}}]:e.content.map((e,t,r)=>t!=r.length-1?e:{...e,cache_control:{type:"ephemeral"}}),toolInput:e.toolInput?e.toolInput:void 0}),t=s.filter(e=>Array.isArray(e.content)).flatMap(e=>e.content).filter(e=>"tool_use_id"in e&&"tool_result"===e.type).map(e=>e.tool_use_id).pop();if(f.settings.elideToolResults&&"tool_result"===e[e.length-1].content[0].type){let t=await n.messages.create({model:ef,max_tokens:8192,messages:[...e.filter(e=>!!Array.isArray(e.content)&&e.content.find(e=>"tool_use"===e.type||"tool_result"===e.type)).map(e=>e.content.find(e=>"tool_result"===e.type)?{...e,content:[{type:"text",text:"".concat(JSON.stringify({...e.content[0],content:"elided"}))}]}:{...e,content:[e.content[0],{type:"text",text:"".concat(JSON.stringify(e.content[1]))}]}),{role:"user",content:[{type:"text",text:"Rate each `message`: will the `type: tool_result` be required by `assistant` to serve the next response? Reply ONLY with `<tool_use_id>: Yes` or `<tool_use_id>: No` for each tool_result. DO NOT reply with code, prose, or commentary of any kind.\nExample output:\ntoolu_014huykAonadokihkrboFfqn: Yes\ntoolu_01APhxfkQZ1nT7Ayt8Vtyuz8: Yes\ntoolu_01PcgSwHbHinNrn3kdFaD82w: No\ntoolu_018Qosa8PHAZjUa312TXRwou: Yes",cache_control:{type:"ephemeral"}}]}],system:[{type:"text",text:"Rate each `message`: will the `type: tool_result` be required by `assistant` to serve the next response? Reply ONLY with `<tool_use_id>: Yes` or `<tool_use_id>: No` for each tool_result. DO NOT reply with code, prose, or commentary of any kind.\nExample output:\ntoolu_014huykAonadokihkrboFfqn: Yes\ntoolu_01APhxfkQZ1nT7Ayt8Vtyuz8: Yes\ntoolu_01PcgSwHbHinNrn3kdFaD82w: No\ntoolu_018Qosa8PHAZjUa312TXRwou: Yes",cache_control:{type:"ephemeral"}}]});if("text"===t.content[0].type)for(let e of(console.log("a"),t.content[0].text.split("\n"))){let[t,r]=e.split(": ");"Yes"===r.trim()?(console.log("b"),a.add(t)):"No"===r.trim()&&(console.log("c"),a.delete(t))}console.log("keepToolResponse: ".concat(JSON.stringify(t),"\n").concat(JSON.stringify(a)))}let r=f.settings.elideToolResults?e.map(e=>{if(!Array.isArray(e.content))return e;let r=e.content.find(e=>"tool_result"===e.type);if(!r)return e;let s=r.tool_use_id;return s===t||a.has(s)?e:{...e,content:[{...e.content[0],content:"elided"}]}}):e,i={role:"assistant",content:[],timestamp:new Date},l={type:"text",text:""};i.content.push(l);let d=await n.messages.stream({model:f.settings.model||ef,max_tokens:8192,messages:r,...p&&p.length>0&&{system:p},...c.length>0&&{tools:o}});if(C.current=d,k.current)break;d.on("text",e=>{l.text+=e;let t=[...s,i];O(f.id,u,t)});let h=await d.finalMessage(),g=h.content.map(e=>e.type&&"text"===e.type&&0===e.text.trim().length&&1===h.content.length?{...e,text:"empty"}:e).filter(e=>{if(!e.type||"text"!==e.type)return!0;let t=0===e.text.trim().length;return t&&1===h.content.length?(console.log("got unexpected whitespace case from assistant: ".concat(JSON.stringify(h))),e.text="empty",!0):!t}),x={...h,content:g};s.push(x),O(f.id,u,s);let v=null==f?void 0:f.conversations.find(e=>e.id===u);if(v&&2===s.length&&"(New Chat)"===v.name){let e=null==f?void 0:f.conversations.find(e=>e.id===u);if((null==e?void 0:e.name)!=="(New Chat)"){console.log("Title already changed, skipping generation");return}let t=s[0].content,r=s[1].content,a=await n.messages.create({model:f.settings.model||ef,max_tokens:20,messages:[{role:"user",content:"Generate a concise, specific title (3-4 words max) that accurately captures the main topic or purpose of this conversation. Use key technical terms when relevant. Avoid generic words like 'conversation', 'chat', or 'help'.\n\nUser message: ".concat(JSON.stringify(t),"\nAssistant response: ").concat(Array.isArray(r)?r.filter(e=>"text"===e.type).map(e=>"text"===e.type?e.text:"").join(" "):r,"\n\nFormat: Only output the title, no quotes or explanation\nExample good titles:\n- React Router Setup\n- Python Script Optimization\n- Database Schema Design\n- ML Model Training\n- Docker Container Networking")}]}),o=a.content[0].type;if("text"==o){let e=a.content[0].text.replace(/["']/g,"").replace("title:","").replace("Title:","").replace("title","").replace("Title","").trim();e&&m(f.id,u,e)}}let y=h.content.find(e=>"tool_use"===e.type);if(y&&"tool_use"===y.type)try{if(k.current)break;let e=S.find(e=>{var t;return null===(t=e.tools)||void 0===t?void 0:t.some(e=>e.name===y.name)});if(!e)throw Error("No server found for tool ".concat(y.name));let t=await A(e.id,y.name,y.input);if(k.current)break;let r={role:"user",content:[{type:"tool_result",tool_use_id:y.id,content:t}],timestamp:new Date};if(s.push(r),O(f.id,u,s),!k.current)continue;break}catch(t){let e={role:"user",content:[{type:"tool_result",tool_use_id:y.id,content:"Error: ".concat(t instanceof Error?t.message:"Unknown error"),is_error:!0}],timestamp:new Date};s.push(e),O(f.id,u,s)}if(k.current||!y)break}}catch(e){e&&"object"==typeof e&&"message"in e&&"Request was aborted."===e.message?console.log("Request was cancelled by user"):(console.error("Failed to send message:",e),k.current||N(e instanceof Error?e.message:"An error occurred"))}finally{k.current=!1,b(!1),C.current=null,_.current&&(_.current.focus(),_.current.style.height="2.5em")}},V=(e,t)=>Array.isArray(e.content)?e.content.map((r,n)=>{if("text"===r.type)return(0,s.jsx)("div",{className:"flex max-w-full pt-6",children:(0,s.jsxs)("div",{className:"relative group w-full max-w-full overflow-x-auto",children:[!r.text.match(/```[\s\S]*```/)&&(0,s.jsx)("div",{className:"absolute right-2 top-0 z-10",children:(0,s.jsx)(Z,{text:r.text.trim(),className:"opacity-0 group-hover:opacity-100 transition-opacity"})}),(0,s.jsx)("div",{className:"w-full max-w-full rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-accent !text-accent-foreground":"bg-muted text-foreground"),children:(0,s.jsx)(ee.o,{className:"prose dark:prose-invert break-words max-w-full ".concat("user"===e.role?"[&_p]:!text-accent-foreground [&_code]:!text-accent-foreground":""),components:{p:e=>{let{children:t}=e;return(0,s.jsx)("p",{className:"break-words whitespace-pre-wrap overflow-hidden",children:t})},pre(e){let{children:t,...r}=e,n=e=>{if("string"==typeof e)return e;if(!e)return"";if(Array.isArray(e))return e.map(n).join("\n");if("object"==typeof e&&null!==e&&"props"in e){var t,r,s;if((null===(r=e.props)||void 0===r?void 0:null===(t=r.className)||void 0===t?void 0:t.includes("language-"))||(null===(s=e.props)||void 0===s?void 0:s.children))return n(e.props.children)}return""},a=n(t).trim();return(0,s.jsxs)("div",{className:"group/code relative max-w-full",children:[(0,s.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,s.jsx)(Z,{text:a,className:"opacity-0 group-hover/code:opacity-100 transition-opacity"})}),(0,s.jsx)("pre",{className:"overflow-x-auto max-w-full whitespace-pre",...r,children:t})]})},code(e){let{inline:t,children:r,...n}=e;return t?(0,s.jsx)("code",{className:"text-inherit whitespace-nowrap inline",...n,children:r}):(0,s.jsx)("code",{className:"block overflow-x-auto whitespace-pre-wrap",...n,children:r})},a:e=>{let{href:t,children:r}=e;return(0,s.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:r})}},remarkPlugins:[et.A],children:r.text})})]})},"text-".concat(t,"-").concat(n));if("image"===r.type)return(0,s.jsx)("div",{className:"flex",children:(0,s.jsx)("div",{className:"w-full rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,s.jsx)(K.default,{src:"data:".concat(r.source.media_type,";base64,").concat(r.source.data),alt:"User uploaded image",className:"max-h-[150px] max-w-[300px] w-auto h-auto rounded object-contain",width:300,height:150})})},"image-".concat(t,"-").concat(n));if("document"===r.type)return(0,s.jsx)("div",{className:"flex",children:(0,s.jsx)("div",{className:"w-full rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,s.jsx)("embed",{src:"data:".concat(r.source.media_type,";base64,").concat(r.source.data),type:r.source.media_type,width:"100%",height:"600px",className:"rounded"})})},"document-".concat(t,"-").concat(n));if("tool_use"===r.type){let a=null==h?void 0:h.messages[t+1],o=null;if(a&&Array.isArray(a.content)){let e=a.content.find(e=>"tool_result"===e.type&&e.tool_use_id===r.id);e&&"tool_result"===e.type&&(o=e.content)}return(0,s.jsx)("div",{className:"flex",children:(0,s.jsx)("div",{className:"w-full rounded-lg px-4 py-2 relative group ".concat("user"===e.role?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,s.jsxs)("button",{onClick:()=>I({name:r.name,input:r.input,result:o}),className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 underline",children:["Use tool: ",r.name]})},"message-".concat(t,"-content-").concat(n))},"tool_use-".concat(t,"-").concat(n))}return null}):(0,s.jsx)("div",{className:"flex",children:(0,s.jsx)("div",{className:"w-full rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,s.jsx)(ee.o,{className:"prose dark:prose-invert break-words overflow-hidden whitespace-pre-wrap max-w-full",components:{a:e=>{let{href:t,children:r}=e;return(0,s.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:r})}},remarkPlugins:[et.A],children:e.content})})},"string-".concat(t));return h?(0,s.jsxs)("div",{className:"flex flex-col h-full relative",children:[(0,s.jsx)("div",{ref:P,className:"h-[calc(100vh-4rem)] overflow-y-auto p-4",children:(0,s.jsxs)("div",{className:"space-y-4 mb-4",children:[h.messages.map((e,t)=>V(e,t)),(0,s.jsx)("div",{ref:R})]})}),j&&(0,s.jsx)("div",{className:"px-4 py-2 text-sm text-red-500",children:j}),(null==f?void 0:f.settings.provider)==="openrouter"&&(0,s.jsx)("div",{className:"px-4",children:(0,s.jsx)(X,{children:(0,s.jsx)($,{children:"OpenRouter support is coming soon. Please switch to Anthropic provider in settings to chat."})})}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 p-2 bg-background fixed bottom-0 left-0 right-0 z-50 md:left-[280px] md:w-[calc(100%-280px)]",children:[i.length>0&&(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:i.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-muted rounded px-2 py-1",children:[(0,s.jsx)("span",{className:"text-sm",children:"text"===e.type?"Text file":e.fileName||"Untitled"}),(0,s.jsx)("button",{onClick:()=>{l(e=>e.filter((e,r)=>r!==t))},className:"hover:text-destructive",children:(0,s.jsx)(M.A,{className:"h-4 w-4"})})]},t))}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("div",{className:"flex items-end",children:(0,s.jsx)(Y,{onFileSelect:e=>{l(t=>[...t,{...e}])},onUploadComplete:()=>{_.current&&_.current.focus()}})}),(0,s.jsx)(G,{value:g,onChange:e=>x(e.target.value),placeholder:(null==f?void 0:f.settings.provider)==="openrouter"?"⚠️ OpenRouter support coming soon":(null==f?void 0:null===(r=f.settings.apiKey)||void 0===r?void 0:r.trim())?y?"Processing response...":"Type your message":"⚠️ Set your API key in Settings to start chatting",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||y||(e.preventDefault(),L())},ref:_,className:"flex-1 ".concat((null==f?void 0:null===(a=f.settings.apiKey)||void 0===a?void 0:a.trim())?"":"placeholder:text-red-500/90 dark:placeholder:text-red-400/90 placeholder:font-medium"),maxRows:8,disabled:y||!(null==f?void 0:null===(o=f.settings.apiKey)||void 0===o?void 0:o.trim())||(null==f?void 0:f.settings.provider)==="openrouter"}),(0,s.jsx)(z,{onClick:y?T:L,disabled:!d||!u||(null==f?void 0:f.settings.provider)==="openrouter",className:"self-end relative",children:y?(0,s.jsx)(F.A,{className:"w-4 h-4"}):(0,s.jsx)(J.A,{className:"w-4 h-4"})})]})]}),D&&(0,s.jsx)(ep,{toolCall:D,onClose:()=>I(null)})]}):(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("p",{className:"mb-4 text-muted-foreground",children:"Select a conversation or start a new chat"})})})});eh.displayName="ChatView";let eg=n.memo(eh),ex=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:A("rounded-lg border bg-card text-card-foreground shadow-sm",r),...n})});ex.displayName="Card",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:A("flex flex-col space-y-1.5 p-6",r),...n})}).displayName="CardHeader",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("h3",{ref:t,className:A("text-lg font-semibold leading-none tracking-tight",r),...n})}).displayName="CardTitle",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("p",{ref:t,className:A("text-sm text-muted-foreground",r),...n})}).displayName="CardDescription";let ev=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:A("p-6 pt-0",r),...n})});ev.displayName="CardContent",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:A(" flex items-center p-6 pt-0",r),...n})}).displayName="CardFooter";let ey=n.forwardRef((e,t)=>{let{className:r,type:n,...a}=e;return(0,s.jsx)("input",{type:n,className:A("flex h-10 w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...a})});ey.displayName="Input";var eb=r(3572);let ej=eb.bL;eb.l9;let ew=eb.ZL,eN=n.forwardRef(function(e,t){return(0,s.jsx)(eb.hJ,{className:A("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e.className),...e,ref:t})}),ek=n.forwardRef(function(e,t){return(0,s.jsxs)(ew,{children:[(0,s.jsx)(eN,{}),(0,s.jsx)(eb.UC,{ref:t,className:A("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e.className),...e})]})}),eC=e=>{let{className:t,...r}=e;return(0,s.jsx)("div",{className:A("flex flex-col space-y-2 text-center sm:text-left",t),...r})},eS=e=>{let{className:t,...r}=e;return(0,s.jsx)("div",{className:A("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r})},eA=n.forwardRef(function(e,t){return(0,s.jsx)(eb.hE,{ref:t,className:A("text-lg font-semibold",e.className),...e})}),eR=n.forwardRef(function(e,t){return(0,s.jsx)(eb.VY,{ref:t,className:A("text-sm text-muted-foreground",e.className),...e})}),eP=n.forwardRef(function(e,t){return(0,s.jsx)(eb.rc,{ref:t,className:A(T(),e.className),autoFocus:e.autoFocus,...e})}),e_=n.forwardRef(function(e,t){return(0,s.jsx)(eb.ZD,{ref:t,className:A(T({variant:"outline"}),"mt-2 sm:mt-0",e.className),...e})});var eD=r(1773),eI=r(5686);let eE=e=>{let{servers:t=[],onServersChange:r}=e,[a,o]=(0,n.useState)({name:"",uri:""}),{addServer:i,removeServer:l,reconnectServer:c}=w(),d=async()=>{let e={id:Math.random().toString(36).substring(7),name:a.name,uri:a.uri,status:"connecting"},s=Array.isArray(t)?[...t,e]:[e];r(s);try{await i(e),r(s.map(t=>t.id===e.id?{...t,status:"connected"}:t))}catch(t){console.error("Failed to connect to server:",t),r(s.map(r=>r.id===e.id?{...r,status:"error",error:t instanceof Error?t.message:"Failed to connect"}:r))}o({name:"",uri:""})},u=e=>{l(e),r(t.filter(t=>t.id!==e))},p=e=>{switch(e){case"connected":return"text-green-500";case"connecting":return"text-yellow-500";case"error":return"text-red-500";default:return"text-gray-500"}};return(0,s.jsx)(ex,{children:(0,s.jsxs)(ev,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-4",children:"WebSocket MCP Servers"}),(0,s.jsx)("div",{className:"space-y-3 mb-4",children:Array.isArray(t)&&t.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-medium",children:e.name}),(0,s.jsxs)("span",{className:"text-sm ".concat(p(e.status)),children:["(",e.status,")"]})]}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:e.uri}),e.error&&(0,s.jsx)("div",{className:"text-sm text-red-500 mt-1",children:e.error})]}),(0,s.jsxs)("div",{className:"flex gap-2 ml-2",children:["connected"!==e.status&&(0,s.jsx)(z,{variant:"ghost",size:"sm",onClick:()=>c(e.id),children:(0,s.jsx)(eD.A,{className:"h-4 w-4"})}),(0,s.jsx)(z,{variant:"ghost",size:"sm",onClick:()=>u(e.id),children:(0,s.jsx)(eI.A,{className:"h-4 w-4"})})]})]},e.id))}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(ey,{placeholder:"Server name",value:a.name,onChange:e=>o({...a,name:e.target.value}),className:"mb-2"}),(0,s.jsx)(ey,{placeholder:"WebSocket URI (e.g. ws://localhost:3000)",value:a.uri,onChange:e=>o({...a,uri:e.target.value})})]}),(0,s.jsx)(z,{onClick:d,disabled:!a.name||!a.uri,className:"w-full",children:"Add Server"})]}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(X,{children:(0,s.jsx)($,{children:"Connect to WebSocket MCP servers to extend Claude's capabilities with custom tools. Each server should implement the MCP protocol."})})})]})})};var eO=r(7725),eT=r(2104),ez=r(8321),eK=r(6967),eU=r(3565);let eM=ez.bL,eF=ez.l9;ez.YJ,ez.ZL,ez.Pb,ez.z6,n.forwardRef((e,t)=>{let{className:r,inset:n,children:a,...o}=e;return(0,s.jsxs)(ez.ZP,{ref:t,className:A("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",n&&"pl-8",r),...o,children:[a,(0,s.jsx)(eK.A,{className:"ml-auto h-4 w-4"})]})}).displayName=ez.ZP.displayName,n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(ez.G5,{ref:t,className:A("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in data-[side=bottom]:slide-in-from-top-1 data-[side=left]:slide-in-from-right-1 data-[side=right]:slide-in-from-left-1 data-[side=top]:slide-in-from-bottom-1",r),...n})}).displayName=ez.G5.displayName;let eJ=n.forwardRef((e,t)=>{let{className:r,sideOffset:n=4,...a}=e;return(0,s.jsx)(ez.ZL,{children:(0,s.jsx)(ez.UC,{ref:t,sideOffset:n,className:A("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...a})})});eJ.displayName=ez.UC.displayName;let eL=n.forwardRef((e,t)=>{let{className:r,inset:n,...a}=e;return(0,s.jsx)(ez.q7,{ref:t,className:A("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n&&"pl-8",r),...a})});eL.displayName=ez.q7.displayName,n.forwardRef((e,t)=>{let{className:r,children:n,checked:a,...o}=e;return(0,s.jsxs)(ez.H_,{ref:t,className:A("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),checked:a,...o,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(ez.VF,{children:(0,s.jsx)(q.A,{className:"h-4 w-4"})})}),n]})}).displayName=ez.H_.displayName,n.forwardRef((e,t)=>{let{className:r,children:n,...a}=e;return(0,s.jsxs)(ez.hN,{ref:t,className:A("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...a,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(ez.VF,{children:(0,s.jsx)(eU.A,{className:"h-2 w-2 fill-current"})})}),n]})}).displayName=ez.hN.displayName,n.forwardRef((e,t)=>{let{className:r,inset:n,...a}=e;return(0,s.jsx)(ez.JU,{ref:t,className:A("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",r),...a})}).displayName=ez.JU.displayName,n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(ez.wv,{ref:t,className:A("-mx-1 my-1 h-px bg-muted",r),...n})}).displayName=ez.wv.displayName;var eV=r(7113);function eW(){let{setTheme:e}=(0,eV.D)();return(0,s.jsxs)(eM,{children:[(0,s.jsx)(eF,{asChild:!0,children:(0,s.jsxs)(z,{variant:"outline",size:"icon",className:"h-10 w-10 rounded-full shadow-lg bg-background/80 backdrop-blur-sm hover:bg-background/90",children:[(0,s.jsx)(eO.A,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),(0,s.jsx)(eT.A,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),(0,s.jsx)("span",{className:"sr-only",children:"Toggle theme"})]})}),(0,s.jsxs)(eJ,{align:"end",children:[(0,s.jsx)(eL,{onClick:()=>e("light"),children:"Light"}),(0,s.jsx)(eL,{onClick:()=>e("dark"),children:"Dark"}),(0,s.jsx)(eL,{onClick:()=>e("system"),children:"System"})]})]})}let eH=()=>{var e,t,r;let{projects:a,activeProjectId:o,updateProjectSettings:i}=v(),{servers:l}=w(),[c,d]=(0,n.useState)(!1),u=a.find(e=>e.id===o);if((0,n.useEffect)(()=>{u&&p({mcpServers:l.filter(e=>u.settings.mcpServers.find(t=>t.id===e.id))})},[o,l]),!u)return(0,s.jsx)("div",{className:"text-center text-muted-foreground",children:"Select a project to configure settings"});let p=e=>{void 0!==e.provider&&e.provider!==u.settings.provider?i(u.id,{settings:{...u.settings,...e,anthropicApiKey:u.settings.anthropicApiKey||u.settings.apiKey,openRouterApiKey:u.settings.openRouterApiKey||"",apiKey:"anthropic"===e.provider&&u.settings.anthropicApiKey||u.settings.apiKey}}):i(u.id,{settings:{...u.settings,...e}})};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"fixed right-4 bottom-4 z-50",children:(0,s.jsx)(eW,{})}),(0,s.jsx)(ex,{children:(0,s.jsxs)(ev,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-4",children:"API Settings"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Provider"}),(0,s.jsxs)("select",{value:u.settings.provider||"anthropic",onChange:e=>p({provider:e.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[(0,s.jsx)("option",{value:"anthropic",children:"Anthropic (Claude)"}),(0,s.jsx)("option",{value:"openrouter",children:"OpenRouter (Coming Soon)"}),(0,s.jsx)("option",{value:"openai",children:"OpenAI"})]})]}),("openrouter"===u.settings.provider||"openai"===u.settings.provider)&&(0,s.jsx)(X,{children:(0,s.jsx)($,{children:"openrouter"===u.settings.provider?"OpenRouter support is coming soon. Please use Anthropic for now.":"OpenAI support is coming soon. Please use Anthropic for now."})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["API Key ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Required to chat. Get yours at"," ",(()=>{switch(u.settings.provider){case"openrouter":return(0,s.jsx)("a",{href:"https://openrouter.ai/keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"openrouter.ai"});case"openai":return(0,s.jsx)("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"platform.openai.com"});default:return(0,s.jsx)("a",{href:"https://console.anthropic.com/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"console.anthropic.com"})}})()]}),(0,s.jsx)(ey,{type:"password",value:"openrouter"===u.settings.provider?u.settings.openRouterApiKey||"":"openai"===u.settings.provider?u.settings.openaiApiKey||"":u.settings.anthropicApiKey||u.settings.apiKey||"",onChange:e=>{let t=e.target.value.trim();switch(u.settings.provider){case"openrouter":p({openRouterApiKey:t});break;case"openai":p({openaiApiKey:t});break;default:p({anthropicApiKey:t,apiKey:t})}},placeholder:"openrouter"===u.settings.provider?"⚠️ OpenRouter support coming soon":"openai"===u.settings.provider?"⚠️ OpenAI support coming soon":"⚠️ Enter your Anthropic API key to use the chat",className:"openrouter"===u.settings.provider?"":(null===(e=u.settings.anthropicApiKey)||void 0===e?void 0:e.trim())||(null===(t=u.settings.apiKey)||void 0===t?void 0:t.trim())?"":"border-red-500 dark:border-red-400 placeholder:text-red-500/90 dark:placeholder:text-red-400/90 placeholder:font-medium",disabled:"openrouter"===u.settings.provider||"openai"===u.settings.provider})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Model"}),(0,s.jsx)("select",{value:u.settings.model,onChange:e=>p({model:e.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:(function(e){switch(e){case"anthropic":return["claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307","claude-3-5-sonnet-20241022","claude-3-5-haiku-20241022"];case"openai":return["gpt-4o","gpt-4-turbo","gpt-4o-mini","gpt-4","gpt-3.5-turbo","gpt-3.5-turbo-16k"];case"openrouter":return["openai/gpt-4-turbo-preview","anthropic/claude-3-opus-20240229","anthropic/claude-3-sonnet-20240229","meta-llama/llama-2-70b-chat","google/gemini-pro"];default:return[]}})(u.settings.provider||"anthropic").map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"System Prompt"}),(0,s.jsx)(G,{value:u.settings.systemPrompt,onChange:e=>p({systemPrompt:e.target.value}),placeholder:"Enter a system prompt...",className:"min-h-[100px]"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",id:"elideToolResults",checked:null!==(r=u.settings.elideToolResults)&&void 0!==r&&r,onChange:e=>p({elideToolResults:e.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),(0,s.jsx)("label",{htmlFor:"elideToolResults",className:"text-sm font-medium",children:"Use Claude to elide tool results from previous messages"})]})]})]})}),(0,s.jsx)(eE,{servers:u.settings.mcpServers,onServersChange:e=>p({mcpServers:e})}),(0,s.jsx)(ex,{className:"mt-6",children:(0,s.jsxs)(ev,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Advanced Settings"}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground mb-4",children:"Database Version: 5"}),(0,s.jsx)(z,{variant:"destructive",onClick:()=>d(!0),children:"Reset state"}),(0,s.jsx)(ej,{open:c,onOpenChange:d,children:(0,s.jsxs)(ek,{children:[(0,s.jsxs)(eC,{children:[(0,s.jsx)(eA,{children:"Reset Application State"}),(0,s.jsx)(eR,{children:"Are you sure you want to reset the application state? This will delete all projects, conversations, and settings. This action cannot be undone."})]}),(0,s.jsxs)(eS,{children:[(0,s.jsx)(e_,{children:"Cancel"}),(0,s.jsx)(eP,{onClick:async()=>{let e=async()=>Promise.all((await window.indexedDB.databases()).map(e=>new Promise((t,r)=>{let s=window.indexedDB.deleteDatabase(e.name);s.onsuccess=()=>t(),s.onerror=()=>r(s.error)})));try{await e(),window.location.reload()}catch(e){console.error("Error clearing databases:",e)}},children:"Reset"})]})]})})]})})]})};var eY=r(4024),eq=r(4857),eB=r(1719),eZ=r(2060),eG=r(872);let eQ=e=>{let{onExportConversation:t,isMobileMenuOpen:r=!0,onMobileMenuToggle:a,onConversationSelect:o}=e,{projects:i,activeProjectId:l,activeConversationId:c,createProject:d,deleteProject:u,createConversation:p,deleteConversation:m,renameConversation:f,renameProject:h,setActiveProject:g,setActiveConversation:x}=v(),[y,b]=(0,n.useState)(new Set),[j,w]=(0,n.useState)(!1);(0,n.useEffect)(()=>{l&&b(e=>{let t=new Set(e);return t.add(l),t})},[l]);let[N,k]=(0,n.useState)(!1),[C,S]=(0,n.useState)(null),[A,R]=(0,n.useState)(null),[P,_]=(0,n.useState)(""),D=e=>{b(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},[E]=(0,n.useState)({}),O=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=i.find(t=>t.id===e);if(null==r?void 0:r.conversations){if(t&&0===r.conversations.length)p(e);else if(r.conversations.length>0){let t=E[e];t&&r.conversations.some(e=>e.id===t)?x(t):x(r.conversations[0].id)}g(e)}};(0,n.useEffect)(()=>{l&&c&&(E[l]=c)},[l,c]);let T=[...i].sort((e,t)=>(e.order||0)-(t.order||0));return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(z,{variant:"secondary",size:"icon",className:"fixed left-4 top-4 z-[100] md:hidden rounded-full shadow-lg hover:shadow-xl bg-background",onClick:a,"aria-label":"Toggle mobile menu",children:(0,s.jsx)(I.A,{className:"h-5 w-5"})}),(0,s.jsxs)("div",{className:"\n        fixed inset-y-0 left-0\n        md:sticky md:top-0 md:left-auto\n        w-[280px] max-w-[85vw]\n        bg-background border-r\n        transition-transform duration-200 ease-in-out\n        ".concat(r?"translate-x-0":"-translate-x-full","\n        md:translate-x-0\n        z-40\n        flex flex-col\n        h-screen\n      "),children:[(0,s.jsxs)("div",{className:"flex gap-2 mb-2 p-4 pt-16 md:pt-4",children:[(0,s.jsxs)(z,{onClick:()=>{d("New Project")},className:"flex-1",variant:"outline",children:[(0,s.jsx)(eY.A,{className:"w-4 h-4 mr-2"}),"New Project"]}),(0,s.jsx)(z,{onClick:()=>l&&t(l),variant:"outline",disabled:!l,children:(0,s.jsx)(eq.A,{className:"w-4 h-4"})})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0 px-4",children:T.map((e,t)=>(0,s.jsxs)("div",{className:"mb-2 ".concat(t>0?"mt-2 pt-2 border-t border-accent/35":""),children:[(0,s.jsxs)("div",{className:"p-2 rounded-lg flex items-center gap-2 transition-colors cursor-pointer\n                ".concat(e.id===l?"bg-accent text-accent-foreground":"hover:bg-muted","\n                text-base font-medium"),onClick:t=>{t.stopPropagation(),D(e.id),e.id!==l&&O(e.id,!0)},children:[(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),t.preventDefault(),D(e.id)},className:"p-1 hover:bg-muted-foreground/10 rounded",children:y.has(e.id)?(0,s.jsx)(eB.A,{className:"w-4 h-4"}):(0,s.jsx)(eK.A,{className:"w-4 h-4"})}),(0,s.jsx)("span",{className:"truncate flex-1",children:e.name}),(0,s.jsx)(z,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:t=>{t.stopPropagation(),g(e.id),p(e.id),b(t=>{let r=new Set(t);return r.add(e.id),r}),null==o||o()},title:"New chat",children:(0,s.jsx)(eZ.A,{className:"w-4 h-4 opacity-100 transition-all duration-200 hover:scale-125 hover:opacity-75"})}),(0,s.jsx)(z,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:t=>{t.stopPropagation(),R({type:"project",projectId:e.id,currentName:e.name}),_(e.name),k(!0)},children:(0,s.jsx)(eG.A,{className:"w-4 h-4 opacity-100 transition-all duration-200 hover:scale-125 hover:opacity-75"})}),(0,s.jsx)(z,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:t=>{t.stopPropagation(),S({type:"project",projectId:e.id}),w(!0)},children:(0,s.jsx)(eI.A,{className:"w-4 h-4 text-destructive opacity-100 transition-all duration-200 hover:scale-125 hover:opacity-75"})})]}),y.has(e.id)&&(0,s.jsx)("div",{className:"ml-4 mt-1 space-y-1",children:e.conversations.sort((e,t)=>{let r=e=>e?e instanceof Date?e.getTime():new Date(e).getTime():Date.now(),s=r(e.createdAt||e.lastUpdated);return r(t.createdAt||t.lastUpdated)-s}).map(t=>(0,s.jsxs)("div",{className:"p-2 rounded-lg cursor-pointer flex items-center gap-2 transition-colors\n                      ".concat(t.id===c?"bg-accent text-accent-foreground":"hover:bg-muted","\n                      text-sm truncate max-w-[250px]"),onClick:()=>{O(e.id),x(t.id),null==o||o()},children:[(0,s.jsx)("span",{className:"truncate flex-1",title:t.name,children:t.name}),(0,s.jsx)(z,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:r=>{r.stopPropagation(),R({type:"conversation",projectId:e.id,conversationId:t.id,currentName:t.name}),_(t.name),k(!0)},children:(0,s.jsx)(eG.A,{className:"w-4 h-4 opacity-100 transition-opacity duration-200 hover:opacity-75"})}),(0,s.jsx)(z,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:r=>{r.stopPropagation(),S({type:"conversation",projectId:e.id,conversationId:t.id}),w(!0)},children:(0,s.jsx)(eI.A,{className:"w-4 h-4 text-destructive opacity-100 transition-opacity duration-200 hover:opacity-75"})})]},t.id))})]},e.id))}),(0,s.jsx)(ej,{open:j,onOpenChange:w,children:(0,s.jsxs)(ek,{children:[(0,s.jsxs)(eC,{children:[(0,s.jsxs)(eA,{children:["Delete ",(null==C?void 0:C.type)==="project"?"Project":"Conversation"]}),(0,s.jsxs)(eR,{children:["Are you sure you want to delete this ",null==C?void 0:C.type,"? This action cannot be undone.",(null==C?void 0:C.type)==="project"&&" All conversations in this project will be deleted."]})]}),(0,s.jsxs)(eS,{children:[(0,s.jsx)(e_,{onClick:()=>w(!1),children:"Cancel"}),(0,s.jsx)(eP,{onClick:()=>{C&&("project"===C.type?u(C.projectId):C.conversationId&&m(C.projectId,C.conversationId),w(!1),S(null))},autoFocus:!0,children:"Delete"})]})]})}),(0,s.jsx)(es,{open:N,onOpenChange:k,children:(0,s.jsx)(eo,{children:(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),A&&P.trim()&&("project"===A.type?h(A.projectId,P.trim()):A.conversationId&&f(A.projectId,A.conversationId,P.trim()),k(!1),R(null),_(""))},children:[(0,s.jsx)(ei,{children:(0,s.jsxs)(ec,{children:["Rename ",(null==A?void 0:A.type)==="project"?"Project":"Conversation"]})}),(0,s.jsx)(ey,{value:P,onChange:e=>_(e.target.value),placeholder:"Enter new name",className:"my-4"}),(0,s.jsxs)(el,{children:[(0,s.jsx)(z,{type:"button",variant:"outline",onClick:()=>{k(!1),R(null),_("")},children:"Cancel"}),(0,s.jsx)(z,{type:"submit",variant:"default",children:"Save"})]})]})})})]})]})},eX=()=>{let[e,t]=(0,n.useState)(!1),[r,a]=(0,n.useState)("chat"),o=(0,n.useRef)(null);return n.useEffect(()=>{t(window.innerWidth>=768)},[]),(0,s.jsx)(y,{children:(0,s.jsx)(N,{children:(0,s.jsxs)("div",{className:"min-h-screen bg-background text-foreground flex relative overflow-x-hidden",children:[e&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 md:hidden z-40 backdrop-blur-sm transition-opacity duration-200",onClick:()=>t(!1)}),(0,s.jsx)(eQ,{onExportConversation:(e,t)=>{console.log("Export",{projectId:e,conversationId:t})},isMobileMenuOpen:e,onMobileMenuToggle:()=>t(!e),onConversationSelect:()=>a("chat")}),(0,s.jsx)(z,{variant:"outline",size:"icon",className:"fixed left-4 top-4 z-50 md:hidden shadow-lg ".concat(e?"hidden":"flex"," w-9 h-9 rounded-full"),onClick:()=>t(!0),children:(0,s.jsx)(I.A,{className:"w-4 h-4"})}),(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)("div",{className:"absolute right-4 top-4 z-50 flex items-center gap-4 transition-opacity duration-200\n              ".concat(e?"opacity-100":"md:opacity-100 opacity-0 pointer-events-none md:pointer-events-auto"),children:(0,s.jsx)(R,{value:r,onValueChange:e=>{a(e),"chat"===e&&setTimeout(()=>{var e;null===(e=o.current)||void 0===e||e.focus()},0)},children:(0,s.jsx)("div",{className:"flex items-center gap-4 bg-background/80 backdrop-blur-sm rounded-lg shadow-lg p-1",children:(0,s.jsxs)(P,{className:"bg-transparent",children:[(0,s.jsx)(_,{value:"chat",children:"Chat"}),(0,s.jsx)(_,{value:"settings",children:"Settings"})]})})})}),(0,s.jsx)("div",{className:"flex flex-col h-full",children:(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"settings"===r?"hidden":"",children:(0,s.jsx)(R,{value:r,children:(0,s.jsx)(D,{value:"chat",forceMount:!0,children:(0,s.jsx)(eg,{ref:o})})})}),(0,s.jsx)("div",{className:"chat"===r?"hidden":"",children:(0,s.jsx)(R,{value:r,children:(0,s.jsx)(D,{value:"settings",forceMount:!0,children:(0,s.jsx)(eH,{})})})})]})})]})]})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[870,441,517,358],()=>t(4352)),_N_E=e.O()}]);